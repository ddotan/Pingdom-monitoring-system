/*!CK:2924325660!*//*1431039493,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ixTcX"]); }

__d("BlackbirdUpsellConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={ACTION_EDUCATE:"educate",ACTION_UPSELL:"upsell",CLICK_TYPE_DISMISS_PROMO:"dismiss_promo",CLICK_TYPE_ENABLE_CHAT:"enable_chat",CLICK_TYPE_OPEN_SETTINGS:"open_settings"};},null);
__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};},null);
__d("MessagingEvent",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag"};},null);
__d("PUWErrorCodes",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={BAD_JPEG:9901,WORKER_TERMINATED:9902,UNKNOWN_RESIZE_ERROR:9903,WORKER_ABORT:9904};},null);
__d("AdsPagerConstants",["keyMirror"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=g({ADD_PAGE:null,PAGE_TRANSITION:null,REQUEST_PAGE:null}),i=g({VIEW_ACTION:null,SERVER_ACTION:null});e.exports={ActionTypes:h,PayloadSources:i};},null);
__d("AdsPagerDispatcher",["AdsPagerConstants","Dispatcher","copyProperties"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=g.PayloadSources;function k(m){return function(n){this.dispatch({payloadSource:m,action:n});};}var l=i(new h(),{handleUpdateFromViewAction:k(j.VIEW_ACTION),handleUpdateFromServerAction:k(j.SERVER_ACTION)});e.exports=l;},null);
__d("mergeObjects",["copyProperties"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(){var i={};for(var j=0;j<arguments.length;j++)g(i,arguments[j]);return i;}e.exports=h;},null);
__d("AdsRefreshHandler",["AdsMouseStateStore","AdsPagerDispatcher","AdsPagerConstants","Arbiter","Animation","DOM","Event","SubscriptionsHandler","UIPagelet","csx","debounceAcrossTransitions","mergeObjects"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=g.STATES,t=600;function u(v,w,x){"use strict";if(!x.data||!x.pid)return;this.$AdsRefreshHandler0=v;this.$AdsRefreshHandler1=Date.now();this.$AdsRefreshHandler2=w;this.$AdsRefreshHandler3=x;this.$AdsRefreshHandler4=0;this.$AdsRefreshHandler5=false;this.$AdsRefreshHandler6=true;this.$AdsRefreshHandler7=q(this.reloadAdsIfNeeded.bind(this),this.$AdsRefreshHandler2.delay);this.$AdsRefreshHandler8=new n();this.$AdsRefreshHandler8.addSubscriptions(m.listen(this.$AdsRefreshHandler0,'mouseenter',this.setMouseOver.bind(this,true)),m.listen(this.$AdsRefreshHandler0,'mouseleave',this.setMouseOver.bind(this,false)),g.subscribe('change',this.onMouseStateStoreChange.bind(this)),j.subscribe('AdsPreferencesDialog/opened',this.stopRefreshingRHC.bind(this)),j.subscribe('AdsPreferencesDialog/closed',this.startRefreshingRHC.bind(this)));h.register(this.handlePageDispatch.bind(this));}u.prototype.handlePageDispatch=function(v){"use strict";var w=v.action||{};if(w.actionType===i.ActionTypes.REQUEST_PAGE)this.reloadAds();};u.prototype.setMouseOver=function(v){"use strict";this.$AdsRefreshHandler9=v;};u.prototype.subscribeDefaultEventsForRefresh=function(){"use strict";this.$AdsRefreshHandler8.addSubscriptions(m.listen(window,'scroll',this.$AdsRefreshHandler7),m.listen(window,'resize',this.$AdsRefreshHandler7));return this;};u.prototype.reloadWithDebounce=function(){"use strict";this.$AdsRefreshHandler7();};u.prototype.reloadWithoutDebounce=function(){"use strict";this.reloadAdsIfNeeded();};u.prototype.stopRefreshingRHC=function(v,w){"use strict";this.$AdsRefreshHandler6=false;};u.prototype.startRefreshingRHC=function(v,w){"use strict";this.$AdsRefreshHandler1=Date.now();this.$AdsRefreshHandler6=true;};u.prototype.forceLoadIfEnoughTimePassed=function(v){"use strict";if(Date.now()-this.$AdsRefreshHandler1>v)this.reloadAds();};u.prototype.containsPremium=function(){"use strict";var v=l.scry(this.$AdsRefreshHandler0,"div._4u8");return !!v.filter(function(w){return JSON.parse(w.getAttribute('data-ad')).segment==='premium';}).length;};u.prototype.reloadAdsIfNeeded=function(){"use strict";if(!this.$AdsRefreshHandler0)return;j.inform('AdsRefreshHandler/CheckingReload');if(this.$AdsRefreshHandler2.stateRefresh){this.reloadAdsIfNeededStateBased();return;}if(this.containsPremium()||this.$AdsRefreshHandler9||!this.$AdsRefreshHandler2.interval)return;if(Date.now()-this.$AdsRefreshHandler1>=this.$AdsRefreshHandler2.interval)this.reloadAds();};u.prototype.reloadAdsIfNeededStateBased=function(){"use strict";if(Date.now()-this.$AdsRefreshHandler1<this.$AdsRefreshHandler2.interval)return;if(this.containsPremium())return;if(!this.$AdsRefreshHandler2.interval)return;this.$AdsRefreshHandler5=true;j.inform('AdsRefreshHandler/RefreshScheduled');this.checkScheduledRefresh();};u.prototype.getRefreshScheduled=function(){"use strict";return this.$AdsRefreshHandler5;};u.prototype.onMouseStateStoreChange=function(){"use strict";this.checkScheduledRefresh();};u.prototype.checkScheduledRefresh=function(){"use strict";if(!this.$AdsRefreshHandler5)return;if(this.$AdsRefreshHandler9)return;var v=g.getState(),w=false;switch(v){case s.HOVER:case s.NO_INTENT:w=true;break;default:break;}if(!w)return;this.$AdsRefreshHandler5=false;this.reloadAds();};u.prototype.reloadAds=function(){"use strict";if(!this.$AdsRefreshHandler0)return;this.$AdsRefreshHandler1=Date.now();if(!this.$AdsRefreshHandler6)return;var v=this.$AdsRefreshHandler3&&this.$AdsRefreshHandler3.data,w=r(v,{refresh_num:++this.$AdsRefreshHandler4});o.loadFromEndpoint('WebEgoPane',this.$AdsRefreshHandler0,{dom_id:l.getID(this.$AdsRefreshHandler0),pid:this.$AdsRefreshHandler3.pid,data:w},{bundle:false,handler:this.onLoadHandler.bind(this)});j.inform('AdsRefreshHandler/AdsLoading');};u.prototype.onLoadHandler=function(){"use strict";j.inform('AdsRefreshHandler/AdsLoaded');if(!this.$AdsRefreshHandler2.fade)return;(new k(this.$AdsRefreshHandler0)).from('opacity',0).to('opacity',1).duration(t).go();};u.prototype.cleanup=function(){"use strict";this.$AdsRefreshHandler0=null;this.$AdsRefreshHandler8.release();this.$AdsRefreshHandler7.reset();};e.exports=u;},null);
__d("HomeRHCAdsBasicRefresh",["AdsRefreshHandler","Arbiter","NavigationMessage","Run","SubscriptionsHandler","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m,n,o,p;function q(){if(m){m.cleanup();m=null;}if(n){n.release();n=null;}o=null;}function r(){var u=l(p);if(u&&o){u.appendChild(o);o=null;}}function s(u,v){o=v;m&&m.forceLoadIfEnoughTimePassed(0);}var t={init:function(u,v,w){p=u;m=new g(l(u),v,w).subscribeDefaultEventsForRefresh();n=new k();n.addSubscriptions(h.subscribe(i.NAVIGATION_BEGIN,q),h.subscribe('ProfileQuestionAnswered',s),h.subscribe('AdsRefreshHandler/AdsLoaded',r));j.onLeave(q);}};e.exports=t;},null);
__d("XdArbiterBuffer",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();if(!a.XdArbiter)a.XdArbiter={_m:[],_p:[],register:function(g,h,i){h=h||((/^apps\./).test(location.hostname)?'canvas':'tab');this._p.push([g,h,i]);return h;},handleMessage:function(g,h){this._m.push([g,h]);}};},null);
__d("CanvasIFrameLoader",["$","XdArbiterBuffer"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();b('XdArbiterBuffer');var h={loadFromForm:function(i){i.submit();}};e.exports=h;},null);
__d("ChannelSubdomain",["Event","JSLogger","Run","setTimeoutAcrossTransitions","LogHistory","WebStorage"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('LogHistory').getInstance('channel'),l=b('WebStorage').getLocalStorage(),m=h.create('channel'),n='channel_sub:',o=7,p=100*1000,q=null,r;function s(){if(r){clearTimeout(r);r=null;}if(l&&q!=null)l.removeItem(n+q);q=null;}function t(u,v,w){var x=(u-1)*o;if(w){if(r)clearTimeout(r);q=r=null;}if(v==null)v=Math.floor(Math.random()*x);if(q==null)if(l){var y=[];for(var z=0;z<l.length;z++){var aa=l.key(z);if(aa.indexOf(n)===0){var ba=parseInt(aa.substr(n.length),10);y[ba]=parseInt(l.getItem(aa),10);}}var ca=Date.now()-p;for(z=0;z<x;z++){var da=(z+v)%x;if(!y[da]||y[da]<ca){q=da;break;}}if(q!=null){var ea=function(){try{l.setItem(n+q,Date.now());}catch(fa){k.warn('subdomain set failed',fa.message);}r=j(ea,p/2);};ea();}else{k.warn('no channel subdomain',y);m.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){g.listen(window,'pagehide',s);}else i.onUnload(s);}else q=v;return q==null?null:q%o;}e.exports={allocate:t,clear:s};},null);
__d("DocRPC",["ErrorUtils"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={_apis:{},_dispatch:function(i){var j;try{i=JSON.parse(i);}catch(k){throw new Error('DocRPC unparsable dispatch: "'+i+'"');}if(h._apis.hasOwnProperty(i.api)){var l=h._apis[i.api];if(l[i.method])j=g.applyWithGuard(l[i.method],l,i.args);}if(j===(void 0))j=null;return JSON.stringify(j);},publish:function(i,j){h._apis[j]=i;},proxy:function(i,j,k){var l={};k.forEach(function(m){l[m]=function(){var n={api:j,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(i.closed)throw new Error('DocRPC window closed');o=i.DocRPC._dispatch(JSON.stringify(n));}catch(p){g.reportError(p);return;}if(typeof(o)=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+j+'.'+m+' unparsable return: "'+o+'"');}return o;};});return l;}};e.exports=a.DocRPC=h;},null);
__d("ChannelTransport",["AjaxRequest","ChannelConstants","DocRPC","LogHistory","URI","copyProperties","bind","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=j.getInstance('channel');function p(){return (1048576*Math.random()|0).toString(36);}function q(z,aa){var ba=z.subdomain;ba=ba===null?'':(ba+'-');var ca=new k(aa).setDomain(ba+z.host+'.'+z.domain).setPort(z.port).setSecure(k().isSecure());return ca;}function r(z){var aa={partition:z.partition,cb:p()};if(z.sticky_token)aa.sticky_token=z.sticky_token;var ba=q(z,'/p').setQueryData(aa);o.log('start_p',{uri:ba.toString()});var ca=new g('GET',ba);if(g.supportsCORS())ca.xhr.withCredentials=true;var da=function(ea){o.log('finish_p',{xhr:ea.toJSON?ea.toJSON():ea});};ca.timeout=z.P_TIMEOUT;ca.onError=ca.onSuccess=da;ca.send();}function s(z,aa,ba){var ca=new Image(),da=0,ea=function(ha){ca.abort();return ha?aa():ba();};ca.onload=function(){o.log('ping_ok',{duration:Date.now()-da});ea(true);};ca.onerror=function(){r(z);ea(false);};var fa=n(ca.onerror,10000);ca.abort=function(){if(fa){clearTimeout(fa);fa=null;}ca.onload=ca.onerror=null;};var ga={partition:z.partition,cb:p()};if(z.sticky_token)ga.sticky_token=z.sticky_token;if(z.sticky_pool)ga.sticky_pool=z.sticky_pool;if(z.lastRequestErrorReason){ga.reason=z.lastRequestErrorReason;z.lastRequestErrorReason=null;}if(z.uid&&z.viewerUid){ga.uid=z.uid;ga.viewer_uid=z.viewerUid;}if(z.watchdog&&z.watchdog.enabled)ga.wtc=z.watchdog.doSerialize();da=Date.now();ca.src=q(z,'/ping').setQueryData(ga);return ca;}function t(z){var aa={channel:z.user_channel,partition:z.partition,clientid:z.sessionID,cb:p(),cap:0,uid:z.uid,viewer_uid:z.viewerUid};if(z.sticky_token)aa.sticky_token=z.sticky_token;if(z.sticky_pool)aa.sticky_pool=z.sticky_pool;if(z.is_offline||z.shouldSuppressPresence){aa.state='offline';}else aa.state='active';if(aa.state===z.lastPresenceState)return;z.lastPresenceState=aa.state;if(z.profile)aa.profile=z.profile;if(z.capabilities)aa.cap=z.capabilities;var ba=q(z,'/active_ping').setQueryData(aa),ca=new g('GET',ba);if(g.supportsCORS())ca.xhr.withCredentials=true;ca.onError=function(da){o.warn('active_ping_error');};ca.onSuccess=function(da){o.log('active_ping_ok');};ca.timeout=z.P_TIMEOUT;ca.send();}function u(z,aa,ba,ca){var da=new Date(),ea=-1;if(z.userActive>0){ea=(da-z.userActive)/1000|0;if(ea<0)o.warn('idle_regression',{idleTime:ea,now:da.getTime(),userActive:z.userActive});}var fa={channel:z.user_channel,seq:z.seq,partition:z.partition,clientid:z.sessionID,cb:p(),idle:ea,cap:0};if(!!z.watchdog&&z.watchdog.enabled)fa.wtc=z.watchdog.doSerialize();fa.msgs_recv=z.estimatedReceived;if(z.uid&&z.viewerUid){fa.uid=z.uid;fa.viewer_uid=z.viewerUid;}if(z.stableDeviceId)fa.sdi=1;if(z.sticky_token)fa.sticky_token=z.sticky_token;if(z.sticky_pool)fa.sticky_pool=z.sticky_pool;if('trace_id' in z)fa.traceid=z.trace_id;if(z.is_offline||z.shouldSuppressPresence){fa.state='offline';}else if(z.userActive>0&&ea<60)fa.state='active';z.lastPresenceState=fa.state;if(z.streamingCapable){fa.mode='stream';fa.format='json';}if(z.profile)fa.profile=z.profile;if(z.capabilities)fa.cap=z.capabilities;var ga=q(z,'/pull').setQueryData(fa),ha=z.fantail_enabled?'POST':'GET',ia=new g(ha,ga);if(g.supportsCORS())ia.xhr.withCredentials=true;ia.timeout=z.streamingCapable?z.STREAMING_TIMEOUT:z.LONGPOLL_TIMEOUT;ia.onJSON=aa;ia.onSuccess=ba;ia.onError=function(){var la=(this.status==12002&&this._time>=z.MIN_12002_TIMEOUT)||(this.status==504&&this._time>=z.MIN_504_TIMEOUT),ma=la?ba:ca;return ma&&ma.apply(this,arguments);};if(z.fantail_logs&&z.fantail_logs.length>0){var ja={};for(var ka=0;ka<z.fantail_logs.length;ka++)l(ja,z.fantail_logs[ka]);ia.send(ja);z.fantail_logs=[];}else ia.send();z.inStreaming=z.streamingCapable;return ia;}function v(z){this.manager=z;(this.init&&this.init());}function w(z){v.apply(this,arguments);}l(w.prototype,{logName:'CORS',enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='init')n(m(this.manager,'exitState',{status:h.OK,stateId:aa.stateId}),3000);if(!/pull|ping/.test(z))return;var ba=this.manager;if(z=='ping'){this._request=s(aa,m(ba,'exitState',{status:h.OK,stateId:aa.stateId}),m(ba,'exitState',{status:h.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,m(ba,'_processTransportData',aa.stateId),m(ba,'exitState',{status:h.OK,stateId:aa.stateId}),m(ba,'exitState',{status:h.ERROR,stateId:aa.stateId}));}});function x(z){o.log('iframe_init_constructor');v.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);i.publish(this,'outerTransport');}l(x.prototype,{logName:'iframe',_initIframe:function(z){o.log('iframe_init_start');window.onchanneliframeready=function(){o.log('iframe_resources');return z.resources;};window.onchanneliframeloaded=function(){o.log('iframe_loaded');};if(z){this._iframeURI=q(z,z.path);if(z.resources){var aa=this._iframeURI.getDomain();z.resources=z.resources.map(function(da){var ea=k(da);if(ea.getPath().startsWith('/intern/rsrc.php')&&ea.getQueryData().origin!==(void 0))return ea.addQueryData('origin',aa).toString();return da;});}if(z.bustIframe){var ba={partition:z.partition,cb:p()};this._iframeURI.setQueryData(ba);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);o.log('iframe_uri_set');}catch(ca){o.error('iframe_uri_set_error',ca);this.exitState({status:h.ERROR,stateId:z.stateId},ca+'');}},enterState:function(z,aa){if(z=='init'){this._initIframe(aa);}else if(/idle|ping|pull/.test(z)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(z!='idle')this.exitState({status:h.ERROR,stateId:aa.stateId},'iframe not yet loaded');}else if(z=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(z){if(this.manager.state=='init'&&z.status==h.OK)this._iframeProxy=i.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function y(){this.init=this.init.bind(this);v.apply(this,arguments);}l(y.prototype,{logName:'iframe(inner)',init:function(){i.publish(this,'innerTransport');try{var aa=i.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);l(this,aa);this.exitState({status:h.OK,stateId:1e+06});}catch(z){o.error('iframe_inner_init_error',z);}},enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='ping'){this._request=s(aa,m(this,'exitState',{status:h.OK,stateId:aa.stateId}),m(this,'exitState',{status:h.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,m(this,'_processTransportData',aa.stateId),m(this,'exitState',{status:h.OK,stateId:aa.stateId}),m(this,'exitState',{status:h.ERROR,stateId:aa.stateId}));}});e.exports={getURI:q,Transport:v,CORSTransport:w,IframeTransport:x,IframeInnerTransport:y,sendActivePing:t};},null);
__d("MovingStat",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;},null);
__d("Dcode",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;},null);
__d("PresenceCookieManager",["Cookie","CurrentUser","Dcode","ErrorUtils","JSLogger","PresenceInitialData","PresenceUtil","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=l.cookieVersion,p=l.dictEncode,q='presence',r={},s=null,t=null,u=k.create('presence_cookie');function v(){try{var z=g.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=i.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t&&(!t.user||t.user===h.getID()))return t;}catch(y){u.warn('getcookie_error',y);}return null;}function w(){return parseInt(Date.now()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&o<y.v){u.debug('stale_cookie',o);return;}var z={v:o,time:w(),user:h.getID()};for(var aa in r)z[aa]=j.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba=JSON.stringify(z);if(p)ba='E'+i.encode(ba);if(m.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=n.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(q,ba,null,null,da);}},clear:function(){g.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};e.exports=x;},null);
__d("PresenceState",["Arbiter","ErrorUtils","JSLogger","PresenceCookieManager","copyProperties","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=n.cookiePollInterval||2000,p=n.shouldSuppress||false,q=[],r=[],s=null,t=null,u=0,v=null,w=0,x=['sb2','t2','lm2','uct2','tr','tw','at','wml'],y=i.create('presence_state');function z(){return j.getSubCookie('state');}function aa(){u=Date.now();j.store();ea(t);}var ba=l(aa,0);function ca(ja){if(typeof ja=='undefined'||isNaN(ja)||ja==Number.POSITIVE_INFINITY||ja==Number.NEGATIVE_INFINITY)ja=0;return ja;}function da(ja){var ka={};if(ja){x.forEach(function(na){ka[na]=ja[na];});if(u<ja.ut)y.error('new_cookie',{cookie_time:ja.ut,local_time:u});}ka.ut=u;for(var la=0,ma=q.length;la<ma;la++)h.applyWithGuard(q[la],null,[ka]);t=ka;return t;}function ea(ja){w++;u=ca(ja.ut);if(!s)s=m(ha,o);t=ja;if(v===null)v=ja;for(var ka=0,la=r.length;ka<la;ka++)h.applyWithGuard(r[ka],null,[ja]);w--;}function fa(ja){if(ja&&ja.ut)if(u<ja.ut){return true;}else if(ja.ut<u)y.error('old_cookie',{cookie_time:ja.ut,local_time:u});return false;}function ga(){var ja=z();if(fa(ja))t=ja;return t;}function ha(){var ja=z();if(fa(ja))ea(ja);}j.register('state',da);g.subscribe(i.DUMP_EVENT,function(ja,ka){ka.presence_state={initial:k({},v),state:k({},t),update_time:u,sync_paused:w,poll_time:o};});(function(){var ja=ga();if(ja){ea(ja);}else{y.debug('no_cookie_initial');ea(da());return;}})();var ia={doSync:function(ja){if(w)return;if(ja){aa();}else ba();},registerStateStorer:function(ja){q.push(ja);},registerStateLoader:function(ja){r.push(ja);},get:function(){return ga();},getInitial:function(){return v;},shouldSuppress:function(){return p;},verifyNumber:ca};e.exports=ia;},null);
__d("VideoCallSupport",["ChannelConstants","ChatVisibility","CurrentEnvironment","RTCConfig","UserAgent"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l={isSendWebrtcSupported:function(){return j.SendNewVCGK;},isReceiveWebrtcSupported:function(){return j.ReceiveNewVCGK;},isVideoInteropSupported:function(){return j.VideoInteropGK;},isVideoCallSupported:function(){return l.isSendWebrtcSupported();},isWebrtcSupported:function(){return (k.isBrowser('Chrome >= 28')||k.isBrowser('Firefox >= 25')||k.isBrowser('Opera >= 20'));},isOSSupported:function(){return !k.isPlatform('Android')&&!k.isPlatform('iOS');},getCapabilities:function(){var m=0;if(this.isReceiveWebrtcSupported()&&(h.isOnline()||i.messengerdotcom))m=g.CAPABILITY_VOIP_INTEROP;return m;}};e.exports=l;},null);
__d("RTISession",["URI","AjaxRequest","copyProperties","invariant","ErrorUtils"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';var l='.facebook.com';function m(n,o,p,q,r,s,t,u,v){j(n);j(q);j(r);this.domain=n;this.port=o;this.edgePoolName=p;this.stickyToken=q;this.loggedInId=r;this.accountId=s;this.clientProfile=t||'desktop';this.clientId=u;this.capabilities=v;}m.prototype.issueRequest=function(n,o,p,q,r){j(n);j(o);j(q);var s=this.domain.length-l.length,t=s>0&&this.domain.indexOf(l,s)!==-1,u=t?this.domain:this.domain+l,v=(1048576*Math.random()|0).toString(36),w={cb:v,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var x in w)j(!o[x]);i(w,o);var y=new g(n).setDomain(u).setPort(this.port).setSecure(g().isSecure()).setQueryData(w),z=p?'POST':'GET',aa=new h(z,y);aa.timeout=r?r*1000:30000;if(aa.xhr)aa.xhr.withCredentials=true;var ba={};aa.onSuccess=function(){};aa.onJSON=(function(){ba.data=aa.json;ba.error=null;k.applyWithGuard(q,this,[ba]);}).bind(this);aa.onError=(function(){ba.data=null;ba.error=aa.errorType||'error';k.applyWithGuard(q,this,[ba]);}).bind(this);aa.send(JSON.stringify(p));};e.exports=m;},null);
__d("ChannelManager",["AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelInitialData","ChannelSubdomain","ChannelTransport","ChatVisibility","DTSG","Env","FBAjaxRequest","ISB","JSLogger","MessagingRealtimeConstants","ModulePerformanceGating","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Run","SystemEvents","URI","UserActivity","VideoCallSupport","RTISession","copyProperties","createArrayFromMixed","errorCode","setIntervalAcrossTransitions","setTimeoutAcrossTransitions","WebStorage"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja){b.__markCompiled&&b.__markCompiled();var ka=b('WebStorage').getSessionStorage(),la='chproxy_base_sess',ma,na=s.create('channel'),oa=null;function pa(cb){oa=cb;}var qa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ra={reconnectOverrideTimeMillis:Date.now(),userActive:Date.now(),lastPresenceState:null,lastRequestErrorReason:null,estimatedReceived:0,fantail_logs:[],sessionID:(Math.random()*2147483648|0).toString(16),stableDeviceId:false,capabilities:da.getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:x.shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false,FANTAIL_QUEUE_CAPACITY:50},sa={MAX_CONTINUOUS_PULL_FAILS:3,enabled:false,uptimeMillis:Date.now(),timeInGoodStatesStartMillis:Date.now(),timeInGoodStatesMillis:0,initialized:false,firstPullSentTimeMillis:Date.now(),accumulatedPullTimeMillis:0,pullStartTimeMillis:0,pingCount:0,pullCount:0,continuousPullFails:0,getTimeSinceFirstPullSentSeconds:function(){return (Date.now()-this.firstPullSentTimeMillis)/1000;},getUptimeSeconds:function(){return (Date.now()-this.uptimeMillis)/1000;},getAccumulatedPullTimeSeconds:function(){var cb=this.accumulatedPullTimeMillis,db=Date.now();if(this.pullStartTimeMillis>0&&db-this.pullStartTimeMillis<=ra.LONGPOLL_TIMEOUT)cb+=(db-this.pullStartTimeMillis);var eb=cb/1000;if(eb>=this.getTimeSinceFirstPullSentSeconds())this.initialize();return eb;},getPingToPullRatio:function(){return this.pullCount===0?0:this.pingCount/this.pullCount;},reportPullSent:function(){if(!this.enabled)return;if(!this.initialized)this.initialize();this.pullStartTimeMillis=Date.now();},initialize:function(){this.initialized=true;this.firstPullSentTimeMillis=Date.now();this.pullStartTimeMillis=0;this.accumulatedPullTimeMillis=0;this.pingCount=0;this.pullCount=0;this.timeInGoodStatesStartMillis=Date.now();this.timeInGoodStatesMillis=0;this.uptimeMillis=Date.now();},reportPullReturned:function(cb,db){if(!this.enabled)return;if(this.pullStartTimeMillis>0){this.accumulatedPullTimeMillis+=(Date.now()-this.pullStartTimeMillis);if(cb){this.pullCount++;this.continuousPullFails=0;}else this.continuousPullFails++;}this.pullStartTimeMillis=0;},reportPingSent:function(){if(!this.enabled)return;this.pingCount++;},isGoodState:function(cb){return cb.indexOf('pull')===0||cb.indexOf('init')===0||cb.indexOf('idle')===0;},getTotalTimeInGoodStatesSeconds:function(){var cb=this.timeInGoodStatesMillis;if(this.timeInGoodStatesStartMillis>0)cb+=(Date.now()-this.timeInGoodStatesStartMillis);return cb/1000;},clientEnteredState:function(cb){if(!this.enabled)return;var db=this.isGoodState(cb);if(db&&this.timeInGoodStatesStartMillis===0){this.timeInGoodStatesStartMillis=Date.now();}else if(!db&&this.timeInGoodStatesStartMillis>0){this.timeInGoodStatesMillis=Date.now()-this.timeInGoodStatesStartMillis;this.timeInGoodStatesStartMillis=0;}},transportEnteredState:function(cb){if(!this.enabled)return;if(cb.indexOf('pull')===0){this.reportPullSent();}else if(cb.indexOf('ping')===0&&ra.lastRequestErrorReason!==j.SYS_TIMETRAVEL&&ra.lastRequestErrorReason!==j.SYS_ONLINE&&ra.lastRequestErrorReason!==j.SYS_OWNER&&ra.lastRequestErrorReason!==j.SYS_NONOWNER)this.reportPingSent();},doSerialize:function(){if(!this.enabled)return "";return (this.getTimeSinceFirstPullSentSeconds()).toFixed(0)+','+(this.getAccumulatedPullTimeSeconds()).toFixed(0)+','+(this.getPingToPullRatio()).toFixed(3)+','+(this.getUptimeSeconds()).toFixed(0)+','+(this.getTotalTimeInGoodStatesSeconds()).toFixed(0);}},ta=1,ua={},va=0;function wa(){return i.lastSuccessTime?Math.round((Date.now()-i.lastSuccessTime)/1000):-1;}function xa(){var cb={};if(ma.getConfig('host'))cb[ma.getConfig('user_channel')]=ma.getConfig('seq',0);return cb;}function ya(){var cb=Date.now(),db=Date.now(),eb={total:0},fb='idle',gb=false;aa.subscribe([aa.USER,aa.ONLINE,aa.TIME_TRAVEL],function(jb,kb){ab(true);db=null;ma.lastPullTime=Date.now();var lb;switch(jb){case aa.USER:lb=aa.isPageOwner()?j.SYS_OWNER:j.SYS_NONOWNER;break;case aa.ONLINE:lb=kb?j.SYS_ONLINE:j.SYS_OFFLINE;break;case aa.TIME_TRAVEL:lb=j.SYS_TIMETRAVEL;break;}ma.exitState({status:lb,stateId:ta});});var hb=function(jb,kb){var lb=Date.now(),mb;if(kb){cb=lb;mb=kb.nextState||kb.state;}else mb=fb;aa.checkTimeTravel();if(db){var nb=Math.round((lb-db)/1000);if(nb>0){eb[fb]=(eb[fb]||0)+nb;eb.total+=nb;}}fb=mb;db=lb;if(!jb){eb.lastSuccessTime=wa();eb.online=aa.isOnline();na.log('rollup',eb);}};h.subscribe(j.ON_ENTER_STATE,hb);ia(hb,60000);h.subscribe(s.DUMP_EVENT,function(jb,kb){kb.channelRollup=eb;});var ib=function(){if(ma.isShutdown()||ma.shouldIdle())return;aa.checkTimeTravel();var jb=Date.now()-(ma.lastPullTime||p.start);if(!gb&&jb>ra.STALL_THRESHOLD){var kb=wa();na.error('stall',{lastSuccessTime:kb,rollupState:fb});gb=true;}var lb=Date.now()-cb;if(ma.state=='pull'&&lb>ra.JUMPSTART_THRESHOLD){cb=null;na.warn('jumpstart',{state:ma.state,dormant:lb});ma.enterState('init');}};ia(ib,10000);}function za(){var cb=Date.now(),db=1;function eb(){ja(eb,db*1000);var jb=ma.state;if(jb=='idle'&&ma.shouldIdle())return;na.bump('conn_t',db);if(jb=='pull')na.bump('conn_t_pull',db);}eb();var fb=[15,30,60,120,240],gb=false,hb=false;function ib(jb){ja(function(){na.rate('pullenter_'+jb,gb);na.rate('pullexit_'+jb,hb);},jb*1000);}while(fb.length)ib(fb.shift());h.subscribe(j.ON_ENTER_STATE,function(jb,kb){if(kb.state=='pull')gb=true;cb=Date.now();});h.subscribe(j.ON_EXIT_STATE,function(jb,kb){if(kb.state!='pull'||!cb)return;var lb='other';if(kb.status==j.OK){hb=true;lb='ok';}else if(kb.xhr&&kb.xhr.errorType){lb=/ar:(\w+)/.test(kb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(kb.status))return;var mb=(Date.now()-cb)/1000;if(mb<0){return;}else if(mb>3600)mb=3600;na.bump('conn_num');na.bump('conn_exit',mb);na.bump('conn_num_'+lb);na.bump('conn_exit_'+lb,mb);});}function ab(cb){if(cb){va=0;ua={};}else va++;}ma={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:pa,backoff:false,init:function(cb){this.init=function(){};this._logFantail('client initialized',j.FANTAIL_INFO);var db=!!ra.use_sticky_session,eb=null;if(db&&ka){for(var fb=0;fb<ka.length;fb++){var gb=ka.key(fb);if(gb.indexOf(la)===0){eb=ka.getItem(gb);break;}}if(!eb){eb=ra.sessionID;ka.setItem(la,eb);}}sa.enabled=!!ra.watchdog_enabled;ra.watchdog=sa;if(typeof(ca)!='undefined'){ca.subscribe(function(){ra.userActive=Date.now();m.sendActivePing(ra);}.bind(this));}else na.error('user_activity_undefined');w.register('ch',xa);var hb=this.getConfig('max_conn',2);ra.subdomain=l.allocate(hb);ra.stableDeviceId=false;if(eb&&eb.length&&eb.trim()){ra.sessionID=eb;ra.stableDeviceId=true;}this._logFantail('using session id: '+ra.sessionID,j.FANTAIL_INFO);this._transportRate=new v(30000);var ib=(g.supportsCORS()&&!ra.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new m[ib](this);if(cb)this.enterState.apply(this,arguments);h.subscribe(s.DUMP_EVENT,function(event,kb){kb.transportRate=this._transportRate.tally();kb.transportType=ib;kb.transportVersion=2;}.bind(this));ya();za();if(ma.getConfig('tryStreaming')&&ma.getConfig('host')&&g.supportsCORS()&&!ra.forceIframe){var jb=ra.MIN_INIT_PROBE_DELAY+Math.random()*ra.INIT_PROBE_DELAY_RANDOMIZE_RANGE;ja(this._probeTest,jb);}},configure:function(){var cb=ga(arguments);na.log('configure',cb);cb.forEach(fa.bind(null,ra));h.inform(j.ON_CONFIG,this);},getConfig:function(cb,db){return cb in ra?ra[cb]:db;},getCompleteConfig:function(){return ra;},getWatchdog:function(){return sa;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(aa.isPageOwner()&&aa.isOnline());},_sendIframeError:function(cb){var db=new i().setURI('/ajax/presence/reconnect.php').setData({reason:cb,fb_dtsg:o.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);db.specifiesWriteRequiredParams()&&db.send();},_getDelay:function(){var cb=Math.min(ra.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,va-1)),ra.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in ra)cb=ra.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(cb*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)na.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(cb){this._inEnterState=false;throw cb;}},_enterState:function(cb){if((cb.indexOf('pull')===0||cb.indexOf('ping')===0||cb.indexOf('shutdown')===0)&&!!ra.active_config_refresh){var db=Date.now(),eb=(db-ra.reconnectOverrideTimeMillis)/1000;if('config_refresh_seconds' in ra&&ra.config_refresh_seconds>0&&eb>ra.config_refresh_seconds){cb='reconnect';this._logFantail('forcing reconnect to refresh config'+' - this is normal behavior',j.FANTAIL_DEBUG);}}if(cb.indexOf('reconnect')===0)ra.reconnectOverrideTimeMillis=Date.now();var fb=this.backoff?this._getDelay():0;this.backoff=false;var gb=ga(arguments);if(this.isShutdown()){this._logFantail('not executing state due to shutdown mode: '+cb,j.FANTAIL_WARN);return;}if(cb!='idle!'&&this.shouldIdle()){this._logFantail('forced idleness',j.FANTAIL_WARN);return;}ta++;ra.stateId=ta;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(cb)){var hb=this._transportRate.tally().timeAverage,ib=ma.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(hb>=ib){if(!this._throttled){this._throttled=true;na.warn('throttled');}na.bump('throttle');fb=1000/ib;}}else if(!(/#$/.test(cb)))fb=this._getDelay();cb=cb.replace(/\W*$/,'');if(!qa[cb]){this._logFantail('invalid state: '+cb,j.FANTAIL_ERROR);throw new Error('invalid state:'+cb);}var jb;if(fb<=0){jb={state:cb};this._transportRate.add(1);this.state=cb;var kb=this['_enter_'+this.state];if(kb){gb.shift();kb.apply(this,gb);}if(/init|idle|pull|ping/.test(this.state)){if(ra.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];sa.transportEnteredState(cb);sa.clientEnteredState(cb);ra.is_offline=!n.isOnline();ra.capabilities=da.getCapabilities();this._logFantail('entering transport state: '+this.state,j.FANTAIL_INFO);this.transport.enterState(this.state,ra);if(this.state=='ping'){jb.url=m.getURI(ra).toString();jb.port=ra.port||'undefined';}}}else{this.state='idle';this.nextState=cb;jb={state:this.state,delay:fb,nextState:cb};gb[0]=cb+'#';this._deferredTransition=ja((function(){this._deferredTransition=null;this.enterState.apply(this,gb);}).bind(this),fb);}if(/pull/.test(cb)){jb.client_id=ra.sessionID;jb.streaming=ra.inStreaming;}na.log('enter_'+this.state,jb);h.inform(j.ON_ENTER_STATE,jb);},exitState:function(cb,db){var eb=cb.stateId,fb=cb.status;if((fb==j.SYS_TIMETRAVEL||fb==j.SYS_ONLINE||fb==j.SYS_NONOWNER||fb==j.SYS_OWNER)&&sa)sa.initialize();if(this.isShutdown()||eb<ta)return;var gb=ga(arguments),hb=this.state;gb[0]=cb.status;var ib={state:hb,status:fb};if(/pull/.test(hb)){ib.client_id=ra.sessionID;ib.streaming=ra.inStreaming;}if(/ping/.test(hb)&&fb!=j.OK)ib.url=m.getURI(ra).toString();if(this.nextState)ib.nextState=this.nextState;if(db&&db.errorType){ra.lastRequestErrorReason=db.errorType;ib.xhr=db.toJSON?db.toJSON():db;if(db.errorType==g.SERVICE_UNAVAILABLE){this._logFantail('got 5xx http status code, setting long delay',j.FANTAIL_ERROR);this.proxyDown=true;}delete ib.xhr.json;}else if(fb!=j.OK)ra.lastRequestErrorReason=fb;if(db&&db.json){if(db.json.t)ib.t=db.json.t;if(db.json.reason)ib.reason=db.json.reason;if(db.json.seq)ib.seq=db.json.seq;}na.log('exit_'+hb,ib);h.inform(j.ON_EXIT_STATE,ib);var jb=this['_exit_'+hb];if(jb)fb=jb.apply(this,gb)||fb;if(fb!=j.OK){ab();ua[hb]=(ua[hb]||0)+1;}var kb=qa[this.nextState||hb][fb]||qa._all[fb],lb=kb&&kb.replace(/!*$/,'');if(!lb){na.error('terminal_transition',ib);this._shutdownHint=j.HINT_INVALID_STATE;kb='shutdown!';this._logFantail('entering shutdown state',j.FANTAIL_ERROR);}this._lastState=hb;this._lastStatus=fb;this.enterState(kb);},_processTransportData:function(cb,db){var eb=db.json,fb=eb.t;if('s' in eb){eb.seq=eb.s;delete eb.s;}if(eb.u&&ra.user&&eb.u!=ra.user){na.warn('misguided_msg',{user:ra.user,target:eb.u});this._reportProxyMisguidedMsg(eb.u,ra.user);return;}var gb=ra.seq;if('seq' in eb){ra.seq=eb.seq;x.doSync();}switch(fb){case 'continue':if(ra.inStreaming&&this.heartbeats.length<1){ra.streamingCapable=false;na.log('switch_to_longpoll');ja(this._probeTest,ra.PROBE_DELAY);}ab(true);if(!ra.inStreaming||ra.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:j.OK,stateId:cb});break;case 'refresh':case 'refreshDelay':this._logFantail('got refresh with reason: '+eb.reason,j.FANTAIL_INFO);this.exitState({status:'refresh_'+(eb.reason||0),stateId:cb},db);break;case 'backoff':this._logFantail('server told client to back off',j.FANTAIL_WARN);ab();this.backoff=true;break;case 'lb':var hb=eb.lb_info;ra.estimatedReceived=0;if(hb){ra.sticky_token=hb.sticky;if('pool' in hb){ra.sticky_pool=hb.pool;}else ra.host=hb.vip;if(g.supportsCORS()&&!ra.forceIframe){var ib=ra.subdomain===null?ra.host:(ra.subdomain+'-'+ra.host),jb=new ea(ib,ra.port,ra.sticky_pool,ra.sticky_token,ra.uid,ra.viewer_uid,ra.profile,ra.sessionID,ra.capabilities);h.inform(j.RTI_SESSION,jb);}}else na.error('bad lb info');break;case 'test_streaming':ja(this._probeTest,500);break;case 'fullReload':w.clear();na.log('invalid_history');h.inform(j.ON_INVALID_HISTORY);ab(true);this._logFantail('full reload incurred',j.FANTAIL_INFO);this.exitState({status:j.ERROR_MISSING,stateId:cb},db);break;case 'msg':var kb,lb,mb,nb;ab(true);if('tr' in eb)ra.trace_id=eb.tr;lb=eb.ms;mb=ra.seq-lb.length;for(kb=0;kb<lb.length;kb++,mb++){ra.estimatedReceived++;if(mb>=gb){nb=lb[kb];if(nb.type){var ob=j.getArbiterType(nb.type);if(nb.type==='messaging'){var pb={type:'messaging',event:nb.event};if(nb.message){pb.inbox_unread=nb.unread_counts&&nb.unread_counts.inbox;pb.tid=nb.message.tid;pb.mid=nb.message.mid;this._logFantail('got message with id: '+nb.message.mid,j.FANTAIL_INFO);}na.debug('message',pb);}else if(nb.type==='m_messaging'){na.debug('message',{type:'m_messaging',tid:nb.tid,mid:nb.uuid});}else if(nb.type==='pages_messaging'){if(nb.unread_counts&&nb.unread_counts.inbox)h.inform(j.getArbiterType('pages_inbox_count_update'),{page_id:nb[t.VIEWER_FBID],inbox_unread:nb.unread_counts.inbox});}else if(nb.type==='skywalker'){ob=j.SKYWALKER;}else na.debug('message',{type:nb.type});h.inform(ob,{obj:nb});}}else na.warn('seq_regression',{seq:mb,last_seq:gb,messages:lb.length});}break;case 'heartbeat':if(ra.inStreaming){var qb=Date.now();if(this.heartbeats.length>0){var rb=qb-this.heartbeats[this.heartbeats.length-1];na.log('heartbeat_interval',{client_id:ra.sessionID,interval:rb});}this.heartbeats.push(qb);}break;default:this._logFantail('got an unknown protocol message: '+fb,j.FANTAIL_ERROR);na.error('unknown_msg_type',{type:fb});break;}},_enter_init:function(){if(ua.init>=ma.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:j.ERROR_MAX,stateId:ta}),0);this._initTimer=ja(this.exitState.bind(this,{status:j.ERROR,stateId:ta},'timeout'),ra.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(cb){this._logFantail('entered reconnect with reason: '+cb,j.FANTAIL_INFO);var db=ta;if(!y.hasUserCookie()){this._logFantail('user has no cookie???',j.FANTAIL_WARN);na.warn('no_user_cookie');setTimeout(function(){ma._shutdownHint=j.HINT_AUTH;ma.exitState({status:j.ERROR_SHUTDOWN,stateId:db});},0);return;}var eb={reason:cb,fb_dtsg:o.getToken()};if(r.token)eb.fb_isb=r.token;if(oa)oa(eb);var fb=new q('GET','/ajax/presence/reconnect.php',eb);fb.onSuccess=(function(){ma.configure(fb.json);w.store();this.exitState({status:j.OK,stateId:db});}).bind(this);fb.onError=(function(){var gb=fb.json&&fb.json.error;this._logFantail('reconnect error: '+fb.errorType,j.FANTAIL_ERROR);if(fb.errorType==g.TRANSPORT_ERROR||fb.errorType==g.PROXY_ERROR||fb.errorType==g.SERVICE_UNAVAILABLE)this._shutdownHint=j.HINT_CONN;if(gb&&gb==1356007){this._shutdownHint=j.HINT_MAINT;}else if(gb==1357001||gb==1357004||gb==1348009){this._shutdownHint=j.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?j.ERROR_SHUTDOWN:j.ERROR,stateId:db},fb);}).bind(this);fb.send();},_enter_shutdown:function(){h.inform(j.ON_SHUTDOWN,{reason:this._shutdownHint});if(!!ra.shutdown_recovery_enabled&&'shutdown_recovery_interval_seconds' in ra&&ra.shutdown_recovery_interval_seconds>0){var cb=ra.shutdown_recovery_interval_seconds*1000;ja((function(){h.inform(j.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}).bind(this),cb);}},_exit_init:function(cb){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(cb==j.ERROR_MAX)this._sendIframeError(j.reason_IFrameLoadGiveUp);},_exit_pull:function(cb,db){var eb=cb==j.OK;sa.reportPullReturned(eb,this);if(eb){this.lastPullTime=Date.now();}else{var fb="exit status: "+cb;if(db&&db.errorType)fb+=" ajax request error: "+db.errorType;this._logFantail('pull failed with status: '+fb,j.FANTAIL_ERROR);}},_exit_ping:function(cb){if(cb==j.OK){var db=Date.now()-(this.lastPullTime||p.start);if(db>ra.STALL_THRESHOLD){this._logFantail('didnt complete a successful pull for too long',j.FANTAIL_ERROR);return j.ERROR_STALE;}}else this._logFantail('ping failed with status: '+cb,j.FANTAIL_ERROR);},_reportProxyMisguidedMsg:function(cb,db){this._logFantail('misguided message to '+db+' meant for '+cb,j.FANTAIL_ERROR);var eb=Date.now();if(eb-this.lastReportOnMisguidedMsgTime<=ra.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=eb;var fb={received_uid:cb,expected_uid:db};if(ra.sticky_token)fb.sticky_token=ra.sticky_token;var gb=new ba('/err_misguided_msg').setDomain(ra.host+'.'+ra.domain).setPort(ra.port).setSecure(ba().isSecure()).setQueryData(fb),hb=new g('GET',gb);if(g.supportsCORS())hb.xhr.withCredentials=true;hb.onSuccess=function(ib){};hb.onError=function(ib){};hb.onJSON=function(ib,jb){};hb.send();},_probeTest:function(){ra.streamingCapable=false;var cb=[],db={mode:'stream',format:'json'};if(ra.sticky_token)db.sticky_token=ra.sticky_token;var eb=new ba('/probe').setDomain(ra.host+'.'+ra.domain).setPort(ra.port).setSecure(ba().isSecure()).setQueryData(db),fb=new g('GET',eb);fb.onJSON=function(gb,hb){if(gb&&gb.json&&gb.json.t==='heartbeat'){cb.push(Date.now());if(cb.length>=2){var ib=cb[1]-cb[0];if(ib>=ra.PROBE_HEARTBEATS_INTERVAL_LOW&&ib<=ra.PROBE_HEARTBEATS_INTERVAL_HIGH){ra.streamingCapable=true;na.log('switch_to_streaming');}na.log('probe_ok',{time:ib});}}};fb.onSuccess=function(gb){if(cb.length!=2){ra.streamingCapable=false;na.error('probe_error',{error:'beats.length = '+cb.length});}};fb.onError=function(gb){ra.streamingCapable=false;na.error('probe_error',gb);};na.log('probe_request');fb.send();},_logFantail:function(cb,db){var eb=ra.fantail_queue_capacity||ra.FANTAIL_QUEUE_CAPACITY;if(!ra.fantail_enabled||ra.fantail_logs.length>eb)return;var fb='fantail queue size exceeded',gb=j.FANTAIL_WARN;if(ra.fantail_logs.length<eb){fb=cb;gb=db;}var hb=ra.fantail_logs.length,ib={};ib['time'+hb]=Date.now();ib['log'+hb]=fb;ib['severity'+hb]=gb;ra.fantail_logs.push(ib);}};e.exports=ma;function bb(){if(k.channelConfig){ma.configure(k.channelConfig);if(/shutdown/.test(k.state))ma._shutdownHint=j[k.reason];ma.init(k.state,k.reason);}}if(u.js_module_defer_channel_manager_start){z.onAfterLoad(bb);}else bb();},null);
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","ModulePerformanceGating","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=o.create('channel_connection'),r=null,s=null,t=null,u=null,v=0,w=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function x(){if(s){clearTimeout(s);s=null;}}function y(){x();q.log('unmute_warning');w.inform(w.UNMUTE_WARNING);}function z(ea){x();s=p(y,ea);q.log('mute_warning',{time:ea});w.inform(w.MUTE_WARNING);}function aa(){if(t){clearTimeout(t);t=null;}}function ba(ea,fa){aa();if(ea===m.ON_ENTER_STATE&&(fa.nextState||fa.state)==='pull'){if(u!==w.CONNECTED){q.log('connected');var ga=!u;u=w.CONNECTED;v=0;w.inform(w.CONNECTED,{init:ga});}}else if(ea===m.ON_ENTER_STATE&&((fa.nextState||fa.state)==='ping'||(!fa.nextState&&fa.state==='idle'))){t=p(function(){var ha=null;if(!(fa.state==='idle'&&!fa.nextState))ha=(fa.delay||0);q.log('reconnecting',{delay:ha});if(w.disconnected())q.log('reconnecting_ui',{delay:ha});u=w.RECONNECTING;(fa.state==='idle')&&v++;if(v>1){w.inform(w.RECONNECTING,ha);}else if(!fa.nextState&&fa.state==='idle')ba(ea,fa);},500);}else if(ea===m.ON_SHUTDOWN){q.log('shutdown',{reason:fa.reason});u=w.SHUTDOWN;v=0;w.inform(w.SHUTDOWN,fa.reason);}}function ca(){if(n.isShutdown()){ba(m.ON_SHUTDOWN,n._shutdownHint);}else ba(m.ON_ENTER_STATE,{state:n.state,nextState:n.nextState,delay:0});}if(j.js_module_defer_channel_manager_start){k.onAfterLoad(ca);}else ca();h(w,{disconnected:function(){return u===w.SHUTDOWN||(u===w.RECONNECTING&&!s&&v>1);},isShutdown:function(){return u===w.SHUTDOWN;},reconnect:function(ea){if(n.state==='ping'||n.isShutdown())return;q.log('reconnect',{now:ea});w.inform(w.RECONNECTING,0);if(!!ea){if(r!==null){clearTimeout(r);r=null;}n.enterState('ping!');}else if(!r)r=p(function(){n.enterState('ping!');r=null;},i.get('channel_manual_reconnect_defer_msec'));},unmuteWarning:y});function da(){g.subscribe([m.ON_ENTER_STATE,m.ON_SHUTDOWN],ba);g.subscribe(m.ATTEMPT_RECONNECT,function(){if(w.disconnected())w.reconnect();});l.subscribe(l.TIME_TRAVEL,function(){w.reconnect();z(i.get('mute_warning_time_msec'));});k.onBeforeUnload(aa,false);}if(j.js_module_defer_channel_manager_start){k.onAfterLoad(da);}else da();e.exports=w;},null);
__d("ChatContexts",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={};function h(k){var l=k?k.subtext:'';return l;}function i(k,l){g[k]=l;}var j={get:function(k){if(k in g){return g[k];}else return null;},update:function(k){for(var l in k)i(l,k[l]);},getShortDisplay:function(k){return h(j.get(k));}};e.exports=j;},null);
__d("PresencePoller",["AvailableListConstants","AvailableListInitialData","BanzaiODS","ChannelConnection","ChatContexts","ChatVisibility","CurrentUser","JSLogger","LastMobileActiveTimes","Poller","PresencePrivacy","PresenceStatus","ServerTime","ShortProfiles","UserActivity","copyProperties","debounceAcrossTransitions","errorCode"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){b.__markCompiled&&b.__markCompiled();var y=5,z='/ajax/chat/buddy_list.php',aa=1800000,ba=h.pollInterval,ca=h.lazyPollInterval,da=h.lazyThreshold,ea=n.create('available_list'),fa='presence_poller';i.setEntitySample(fa,.01);function ga(ha){"use strict";this.$PresencePoller0=ha;this.$PresencePoller1=false;this.$PresencePoller2=h.chatNotif;this.$PresencePoller3=new p({interval:ba,setupRequest:this.$PresencePoller4.bind(this),clearOnQuicklingEvents:false,dontStart:true});if(l.isOnline()){this.$PresencePoller5=Date.now();this.$PresencePoller6=Date.now();this.$PresencePoller7=Date.now();this.$PresencePoller8=h.updateTime;}else{this.$PresencePoller5=0;this.$PresencePoller8=0;this.$PresencePoller6=0;this.$PresencePoller7=0;}this.$PresencePoller9=0;this.$PresencePollera('available_initial_data',h.updateTime,h.availableList,h.lastActiveTimes,h.mobileFriends);u.subscribe(function(ia,ja){if(ja.idleness>ba)this.forceUpdate();}.bind(this));q.subscribe('privacy-user-presence-changed',function(){this.forceUpdate();}.bind(this));}ga.prototype.start=function(){"use strict";setTimeout(this.$PresencePoller3.start.bind(this.$PresencePoller3),0);};ga.prototype.restart=function(){"use strict";if(this.$PresencePoller3.isMuted()){this.$PresencePoller3.resume();this.forceUpdate();}};ga.prototype.stop=function(){"use strict";this.$PresencePoller3.mute();};ga.prototype.forceUpdate=function(){"use strict";this.$PresencePoller3.request();};ga.prototype.getIsUserIdle=function(){"use strict";return this.$PresencePoller1;};ga.prototype.getWebChatNotification=function(){"use strict";return this.$PresencePoller2;};ga.prototype.getCallback=function(){"use strict";return this.$PresencePoller0;};ga.prototype.$PresencePollerb=function(){"use strict";return w(function(){this.$PresencePoller0(g.ON_AVAILABILITY_CHANGED);}.bind(this),0)();};ga.prototype.$PresencePollera=function(ha,ia,ja,ka,la){"use strict";this.$PresencePoller8=ia;if(!Array.isArray(ja)){r.resetPresenceData();for(var ma in ja)r.set(ma,ja[ma].a,false,ha,ja[ma].c,ja[ma].p);}if(ka&&!Array.isArray(ka))o.update(ka);if(la)r.setMobileFriends(la);this.$PresencePollerb();};ga.prototype.$PresencePoller4=function(ha){"use strict";if(j.isShutdown()||!l.isOnline()){this.$PresencePoller3.skip();i.bumpEntityKey(fa,'skip.offline');return;}if(Date.now()-this.$PresencePoller5<ba){this.$PresencePoller3.skip();i.bumpEntityKey(fa,'skip.recent');return;}i.bumpEntityKey(fa,'request');this.$PresencePoller5=Date.now();var ia=Date.now()-this.$PresencePoller7,ja=t.getCachedProfileIDs().join(",");ha.setHandler(this.$PresencePollerc.bind(this)).setErrorHandler(this.$PresencePollerd.bind(this)).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:m.getID(),cached_user_info_ids:ja,fetch_mobile:(ia>aa)}).setURI(z).setAllowCrossPageTransition(true);};ga.prototype.$PresencePollerc=function(ha){"use strict";var ia=ha.getPayload(),ja=ia.buddy_list;if(!ja){this.$PresencePollerd(ha);return;}i.bumpEntityKey(fa,'response');this.$PresencePollere();this.$PresencePoller6=Date.now();s.update(ia.time);if(ja.mobile_friends)this.$PresencePoller7=Date.now();this.$PresencePoller9=0;this.$PresencePollerf();var ka=ja.userInfos;if(ka)t.setMulti(ka);var la=ja.chatContexts;la&&k.update(la);this.$PresencePoller1=ja.userIsIdle;if(ja.chatNotif!==(void 0)){this.$PresencePoller2=ja.chatNotif;this.$PresencePoller0(g.ON_CHAT_NOTIFICATION_CHANGED,this.$PresencePoller2);}this.$PresencePollera('buddy_list_poller',ia.time,ja.nowAvailableList,ja.last_active_times,ja.mobile_friends);};ga.prototype.$PresencePollerd=function(ha){"use strict";i.bumpEntityKey(fa,'error');if(ha.getError()==1356007)return;this.$PresencePoller9++;if(this.$PresencePoller9>=y)this.$PresencePoller0(g.ON_UPDATE_ERROR);};ga.prototype.$PresencePollerf=function(){"use strict";var ha=u.isActive(da)?ba:ca;i.bumpEntityKey(fa,'period.'+ha);this.$PresencePoller3.setInterval(ha);};ga.prototype.$PresencePollere=function(){"use strict";var ha=Date.now(),ia=ha-this.$PresencePoller6;ea.log('buddylist_presence_stats',v({duration:ia},r.getPresenceStats()));};e.exports=ga;},null);
__d("TypingStates",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={INACTIVE:0,TYPING:1,QUITTING:2};e.exports=g;},null);
__d("AvailableList",["Arbiter","ArbiterMixin","AsyncRequest","AvailableListConstants","BanzaiODS","ChannelConnection","ChannelConstants","ChatConfig","ChatVisibility","JSLogger","LastMobileActiveTimes","PresencePoller","PresencePrivacy","PresenceStatus","ServerTime","ShortProfiles","TypingStates","copyProperties","debounceAcrossTransitions","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();k.setEntitySample('presence',.0001);var aa=x({},j,h);aa.subscribe([j.ON_AVAILABILITY_CHANGED,j.ON_UPDATE_ERROR],function(ja,ka){g.inform(ja,ka);});var ba=y(function(){aa.inform(j.ON_AVAILABILITY_CHANGED);},0);function ca(ja,ka,la,ma,na,oa){var pa=t.set(ja,ka,la,ma,na,oa);if(pa)ba();}function da(ja){var ka=ja.payload.availability||{};for(var la in ka)ca(la,ka[la].a,true,'mercury_tabs',ka[la].c,ka[la].p);}function ea(){ia.restart();}function fa(){ia.stop();}function ga(ja){var ka=aa.getDebugInfo(ja),la=(ka.presence==j.ACTIVE),ma=new i('/ajax/mercury/tabs_presence.php').setData({target_id:ja,to_online:la,presence_source:ka.overlaySource,presence_time:ka.overlayTime}).setHandler(da).setErrorHandler(z).setAllowCrossPageTransition(true).send();}function ha(ja,ka){ka.chat_config=n.getDebugInfo();ka.available_list_debug_info={};t.getAvailableIDs().forEach(function(la){ka.available_list_debug_info[la]=aa.getDebugInfo(la);});ka.available_list_poll_interval=aa._poller&&aa._poller.getInterval();}var ia=new r(function(event){aa.inform(event);});x(aa,{get:function(ja){return t.get(ja);},updateForID:function(ja){ga(ja);},shouldUpdateForID:function(ja){if(n.get('avoid_available_list_updates',false))return t.getCapabilities(ja)===0;return true;},getWebChatNotification:function(){return ia.getWebChatNotification();},isUserIdle:function(){return ia.getIsUserIdle();},isReady:function(){return true;},set:function(ja,ka,la,ma,na){ca(ja,ka,true,la,ma,na);},update:function(){ia.forceUpdate();},isIdle:function(ja){return aa.get(ja)==j.IDLE;},getDebugInfo:function(ja){var ka=t.getDebugInfo(ja),la=v.getNow(ja);if(la)ka.name=la.name;return ka;}});ia.start();g.subscribe(p.DUMP_EVENT,ha);g.subscribe('chat-visibility/go-online',ea);g.subscribe('chat-visibility/go-offline',fa);s.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],ba);l.subscribe([l.CONNECTED,l.RECONNECTING,l.SHUTDOWN,l.MUTE_WARNING,l.UNMUTE_WARNING],ba);g.subscribe(m.getArbiterType('buddylist_overlay'),function(ja,ka){var la={},ma=ka.obj.overlay;for(var na in ma){aa.set(na,ma[na].a,ma[na].s||'channel',ma[na].vc,ma[na].p);if(ma[na].la)la[na]=ma[na].la;}q.update(la);});g.subscribe([m.getArbiterType('typ'),m.getArbiterType('ttyp')],function(ja,ka){var la=ka.obj;if(la.st===w.TYPING){var ma=la.from;if(o.isOnline()){k.bumpEntityKey('presence','stale_presence_check_typing');var na=t.get(ma);if(na!=j.ACTIVE){var oa=q.get(ma)*1000,pa=u.get();if(!oa){k.bumpEntityKey('presence','no_detailed_presence_typing');}else if(pa-oa>5*60*1000){var qa='stale_presence_typing',ra=pa-oa;if(ra<10*60*1000){qa+='600';}else if(ra<60*60*1000)qa+='3600';k.bumpEntityKey('presence',qa);}}}aa.set(ma,j.ACTIVE,'channel-typing');}});g.subscribe(m.getArbiterType('messaging'),function(ja,ka){if(!o.isOnline())return;var la=ka.obj;if(la.message&&la.message.timestamp&&la.message.sender_fbid){var ma=u.get(),na=la.message.timestamp;if(ma-na<2*60*1000){k.bumpEntityKey('presence','stale_presence_check');var oa=la.message.sender_fbid,pa=t.get(oa);if(pa==j.ACTIVE)return;var qa=q.get(oa)*1000;if(!qa){k.bumpEntityKey('presence','no_detailed_presence');}else if(na-qa>5*60*1000){var ra='stale_presence',sa=na-qa;if(sa<10*60*1000){ra+='600';}else if(sa<60*60*1000)ra+='3600';k.bumpEntityKey('presence',ra);}}}});a.AvailableList=e.exports=aa;},null);
__d("BlackbirdUpsell",["Event","Arbiter","AsyncRequest","LegacyContextualDialog","DOM","LayerDestroyOnHide","LayerHideOnTransition","PresencePrivacy","copyProperties","BlackbirdUpsellConfig","BlackbirdUpsellConstants","BlackbirdUpsellTemplates"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s='/ajax/chat/blackbird/update_clicks.php',t='/ajax/chat/blackbird/update_impressions.php',u='/ajax/chat/blackbird/dismiss.php',v=235,w=null,x=null,y=false,z=false;function aa(){}o(aa,{shouldShow:function(){if(this._dialogDismissed)return false;if(this.isEducation()){return !p.EducationDismissed&&p.EducationImpressions<p.EducationImpressionLimit;}else return !!p.UpsellGK&&!p.UpsellDismissed&&p.UpsellImpressions<p.UpsellImpressionLimit&&p.FriendCount>=p.UpsellMinFriendCount;},isEducation:function(){return p.TimeOffline<=p.EducationTimeOfflineThresdhold;},getOfflineContent:function(){if(this.isEducation()){return this._getEducationContent();}else return this._getUpsellContent();},_getEducationContent:function(){ga();var ka=r[':fb:chat:blackbird:offline-educate'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ja(q.CLICK_TYPE_OPEN_SETTINGS);da();});return ka.getRoot();},_getUpsellContent:function(){fa();var ka=r[':fb:chat:blackbird:upsell'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ia(q.CLICK_TYPE_OPEN_SETTINGS);ca();});var ma=ka.getNode('enableChatButton');g.listen(ma,'click',function(){ia(q.CLICK_TYPE_ENABLE_CHAT);ca();});return ka.getRoot();},getBlackbirdContent:function(ka){ga();switch(ka){case n.ONLINE:return r[':fb:chat:blackbird:most-friends-educate'].build().getRoot();case n.OFFLINE:return r[':fb:chat:blackbird:some-friends-educate'].build().getRoot();}},showOfflineDialog:function(ka){this.showDialog(ka,this.getOfflineContent.bind(this));},showBlackbirdDialog:function(ka,la){this.showDialog(ka,this.getBlackbirdContent.bind(null,la));},showDialog:function(ka,la){!w&&this._constructDialog();k.setContent(x,la());w.setContext(ka);w.show();},hide:function(){if(w&&w.isShown())w.hide();},dismiss:function(){this.hide();if(this.isEducation()){da();}else ca();},registerDismissClick:function(){if(this.isEducation()){ja(q.CLICK_TYPE_DISMISS_PROMO);}else ia(q.CLICK_TYPE_DISMISS_PROMO);},isVisible:function(){return z&&!y;},_constructDialog:function(){var ka=r[':fb:chat:blackbird:dialog-frame'].build();x=ka.getNode('dialogContent');w=new j();w.init(ka.getRoot());w.setPosition('above').setWidth(v).setFixed(true).disableBehavior(l).disableBehavior(m);g.listen(ka.getNode('dialogCloseButton'),'click',this.dismiss.bind(this));g.listen(ka.getNode('dialogCloseButton'),'click',this.registerDismissClick.bind(this));}});function ba(ka,la){if(!y&&z){y=true;n.inform('privacy-user-presence-changed');var ma=new i(u);ma.setData({source:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){y=false;});ma.send();}}function ca(){ba(q.ACTION_UPSELL,p.UpsellImpressions);}function da(){ba(q.ACTION_EDUCATE,p.EducationImpressions);}function ea(ka,la){if(!z){z=true;var ma=new i(t);ma.setData({action:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){z=false;});ma.send();}}function fa(){ea(q.ACTION_UPSELL,p.UpsellImpressions);}function ga(){ea(q.ACTION_EDUCATE,p.EducationImpressions);}function ha(ka,la,ma,na){var oa=new i(s);oa.setData({action:ka,impressions:ma,source:la,time_offline:na});oa.send();}function ia(ka){ha(ka,q.ACTION_UPSELL,p.UpsellImpressions,p.TimeOffline);}function ja(ka){ha(ka,q.ACTION_EDUCATE,p.EducateImpressions,p.TimeOffline);}h.subscribe('chat/advanced-settings-dialog-opened',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-online',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-offline',aa.dismiss.bind(aa));e.exports=aa;},null);
__d("Chat",["Arbiter"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function i(k,l){g.subscribe(h[k],function(event,m){l(m);});}var j={openBuddyList:function(){i('buddyListNub',function(k){k.show();i('sidebar',function(l){l.enable();});});},closeBuddyList:function(){i('buddyListNub',function(k){k.hide();});},toggleSidebar:function(){i('sidebar',function(k){k.toggle();});}};e.exports=j;},null);
__d("ChatOptions",["Arbiter","ChannelConstants","JSLogger","PresenceUtil","copyProperties","ChatOptionsInitialData"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=i.create('chat_options'),m={};(function(){var o=b('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=k(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===j.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(i.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;},null);
__d("ChatQuietLinks",["Event","DOM","UserAgent_DEPRECATED","DataStore","Parent"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l={},m={silenceLinks:function(q){n(q,this.removeEmptyHrefs.bind(this));},nukeLinks:function(q){n(q,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(q){o(q,function(r){return !r||r==='#';});},removeAllHrefs:function(q){o(q);}};function n(q,r){var s=!!i.chrome(),t=!!i.chrome()||i.ie()>=9||i.firefox()>=4;if(l[h.getID(q)])return;l[h.getID(q)]=true;if(!t)return;if(!s){r&&r(q);return;}g.listen(q,'mouseover',function u(v){var w=k.byTag(v.getTarget(),'a');if(w){var x=w.getAttribute('href');if(p(x)){j.set(w,'stashedHref',w.getAttribute('href'));w.removeAttribute('href');}}});g.listen(q,'mouseout',function u(v){var w=k.byTag(v.getTarget(),'a'),x=w&&j.remove(w,'stashedHref');if(p(x))w.setAttribute('href',x);});g.listen(q,'mousedown',function(u){if(!u.isDefaultRequested())return true;var v=k.byTag(u.getTarget(),'a'),w=v&&j.get(v,'stashedHref');if(p(w))v.setAttribute('href',w);});}function o(q,r){var s=h.scry(q,'a');if(r)s=s.filter(function(t){return r(t.getAttribute('href'));});s.forEach(function(t){t.removeAttribute('href');t.setAttribute('tabindex',0);});}function p(q){return q&&q!=='#';}e.exports=m;},null);
__d("OrderedFriendsList",["AvailableListConstants","PresenceStatus","SearchableEntry","ShortProfiles","WorkModeConfig","createArrayFromMixed","isValidUniqueID","InitialChatFriendsList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=[],o=[],p={},q=[],r={},s=[],t={contains:function(u){return u in p;},getList:function(){if(k.is_work_user)return l(n);t.reRank();var u=l(n);u=u.filter(function(v){var w=j.getNowUnsafe(v);return !w||w.type=="friend";});return u;},getSearchableEntries:function(u,v){var w=t.getList();j.getMulti(w.slice(0,u),function(x){var y=[];for(var z in x)y.push(t.normalizeProfileEntry(x[z]));var aa=t.getGroups().map(t.normalizeThreadEntry);v(y.concat(aa).filter(function(ba){return !!ba;}).sort(function(ba,ca){return ba.getOrder()-ca.getOrder();}));});},normalizeProfileEntry:function(u){var v=u.searchTokens||[];return new i({uniqueID:u.id,keywordString:v.join(' '),order:t.getRank(u.id),photo:u.thumbSrc,title:u.name,type:u.type,uri:u.uri,auxiliaryData:{isMessengerUser:u.is_messenger_user}});},normalizeThreadEntry:function(u,v){var w=u.mercury_thread,x=u.participants_to_render,y=u.text,z=null;if(!y)y=w.name;var aa=x.map(function(ca){return ca.name;}).join(', ');if(!y){y=aa;}else z=aa;var ba=u.uid;if(!y||!m(ba))return null;return new i({uniqueID:ba,order:v,photo:w.image_src,title:y,subtitle:z,type:'thread',auxiliaryData:{participantsToRender:x,thread:w}});},getRank:function(u){return u in p?p[u]:n.length;},getActiveList:function(){if(q.length>0)return q;return t.getList();},getActiveRank:function(u){return u in r?r[u]:t.getRank(u);},reRank:function(){n=[];var u=0;s.forEach(function(v){var w=v.slice(0,-2),x=v.slice(-1);if(h.get(w)==x){n[u]=w;p[w]=u++;}});},rankActive:function(){var u=0;s.forEach(function(v){var w=v.slice(0,-2),x=v.slice(-1);if(x==g.ACTIVE){q[u]=w;r[w]=u++;}});},getGroups:function(){return o;}};(function(){var u=b('InitialChatFriendsList');n=u.list.length?u.list:[];o=u.groups||[];if(!k.is_work_user){s=n.slice();t.rankActive();t.reRank();}else n.forEach(function(v,w){p[v]=w;});})();e.exports=a.OrderedFriendsList||t;},null);
__d("ChatSortUsers",["AvailableListConstants","OrderedFriendsList","PresencePrivacy","PresenceStatus","ShortProfiles","TokenizeUtil"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(q,r){var s=i.allows(q),t=i.allows(r);if(s!==t)return s?-1:1;return 0;}var n={};function o(q){if(n[q])return n[q];var r=(k.getNowUnsafe(q)||{}).name;if(r)return n[q]=l.flatten(r);return '~';}var p={sortAlphabetical:function(q,r){var s=o(q),t=o(r);if(s!==t)return s<t?-1:1;return 0;},sortMobile:function(q,r){var s=j.get(q)===g.MOBILE,t=j.get(r)===g.MOBILE;if(s!==t)return t?-1:1;return p.sortAlphabetical(q,r);},sortCoefficient:function(q,r){var s=h.getRank(q),t=h.getRank(r);if(s!==t)return s-t;return p.sortAlphabetical(q,r);},sort:function(q,r){var s=m(q,r);if(s!==0)return s;return p.sortCoefficient(q,r);}};e.exports=p;},null);
__d("ChatDispatcher",["Dispatcher"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("ChatTabActions",["ChatDispatcher","keyMirror"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h({CLOSE_TAB:null,CLOSE_ALL_TABS:null,CLOSE_FRAGILE_TABS:null,LOWER_TAB:null,PERSIST_LOCAL_STATE:null,PROMOTE_TAB:null,RAISE_TAB:null}),j={Types:i,closeTab:function(k,l){g.dispatch({actionType:i.CLOSE_TAB,reason:l,threadID:k});},closeAllTabs:function(){g.dispatch({actionType:i.CLOSE_ALL_TABS});},closeFragileTabs:function(){g.dispatch({actionType:i.CLOSE_FRAGILE_TABS});},lowerTab:function(k){g.dispatch({actionType:i.LOWER_TAB,threadID:k});},persistLocalState:function(){g.dispatch({actionType:i.PERSIST_LOCAL_STATE});},promoteTab:function(k){g.dispatch({actionType:i.PROMOTE_TAB,threadID:k});},raiseTab:function(k,l,m){g.dispatch({actionType:i.RAISE_TAB,signatureID:m,threadID:k,userAction:l});}};e.exports=j;},null);
__d("ChatSidebarComposeLink.react",["ChatOpenTab","React","TooltipLink.react","URI","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=h,m=l.PropTypes,n=h.createClass({displayName:"ChatSidebarComposeLink",propTypes:{className:m.string.isRequired},componentDidMount:function(){g.listenOpenEmptyTab(h.findDOMNode(this),'sidebar');},render:function(){var o=k._("New Message");return (h.createElement(i,{ajaxify:new j('/ajax/messaging/composer.php'),className:this.props.className,tooltip:o,rel:"dialog"}));}});e.exports=n;},null);
__d("ChatSidebarConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={LITESTAND_CLASSIC_SIZE:32,IMAGE_SIZE:28};Object.assign(g,{getImageSize:function(h){if(h===false)return g.IMAGE_SIZE;return g.LITESTAND_CLASSIC_SIZE;},getItemHeight:function(h){if(h===false)return g.IMAGE_SIZE+4;return g.LITESTAND_CLASSIC_SIZE+4;}});e.exports=g;},null);
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","copyProperties","MercuryConstants"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('MercuryConstants').ChatNotificationConstants,l=false,m=h.getWebChatNotification(),n=l,o=true,p=j(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return m!==k.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return n;},showsTabUnreadUI:function(){return o;}});function q(){p.inform(p.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var r=m,s=h.getWebChatNotification();m=s;if(r!=s)q();});g.subscribe('chat/set_does_page_occlude_tabs',function(r,s){n=!!s;q();});g.subscribe('chat/set_show_tab_unread_ui',function(r,s){o=!!s;q();});e.exports=p;},null);
__d("ChatSidebarSheet",["ArbiterMixin","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatBehavior","ChatConfig","ChatVisibility","CSS","DOM","Event","JSLogger","PresencePrivacy","copyProperties","fbt","mixin","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=q.create('sidebar_sheet');function x(da){switch(da){case j.HINT_AUTH:return t._("Your session has timed out. Please log in.");case j.HINT_CONN:return t._("Facebook {Chat} is currently unavailable.",[t.param("Chat",t._("Chat"))]);case j.HINT_MAINT:return t._("Facebook {Chat} is currently down for maintenance.",[t.param("Chat",t._("Chat"))]);default:return t._("Facebook {Chat} is currently unavailable.",[t.param("Chat",t._("Chat"))]);}}function y(da){var ea;if(da===null||false===navigator.onLine){ea=t._("Unable to connect to chat. Check your Internet connection.");}else if(da>l.get('warning_countdown_threshold_msec')){var fa=o.create('a',{href:'#',className:'fbChatReconnectLink'},t._("Try again"));ea=t._("Unable to connect to chat. {try-again-link}",[t.param("try-again-link",fa)]);}else if(da>1000){ea=t._("Unable to connect to chat. Reconnecting in {seconds}...",[t.param("seconds",Math.floor(da/1000))]);}else ea=t._("Unable to connect to chat. Reconnecting...");return ea;}var z=u(g);for(var aa in z)if(z.hasOwnProperty(aa))ca[aa]=z[aa];var ba=z===null?null:z.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=z;function ca(da){"use strict";this._root=da;this._message=o.find(da,'div.fbChatSidebarMessage div.message');i.subscribe([i.CONNECTED,i.SHUTDOWN,i.RECONNECTING],this._handleConnectionChange.bind(this));i.subscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this._render.bind(this));r.subscribe('privacy-user-presence-changed',this._render.bind(this));k.subscribe(k.ON_CHANGED,this._render.bind(this));this._render();}ca.prototype._handleConnectionChange=function(da,ea){"use strict";this._channelStatus=da;this._channelData=ea;this._render();};ca.prototype._renderChannelDisconnect=function(){"use strict";if(this._channelStatus===i.SHUTDOWN){return o.setContent(this._message,x(this._channelData));}else if(this._channelStatus===i.RECONNECTING){var da=this._channelData;o.setContent(this._message,y(da));if(da>1000){if(da>l.get('warning_countdown_threshold_msec'))this._warningMsgEventListener=p.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),'fbChatReconnectLink')){i.reconnect();return false;}});this._showWarningTimeout=v(this._handleConnectionChange.bind(this,i.RECONNECTING,da-1000),1000);}}};ca.prototype._renderOffline=function(){"use strict";var da='fbChatGoOnlineLink',ea=t._("Turn on chat"),fa=o.create('a',{href:'#',className:da},ea),ga=t._("{=Go online} to see who's available.",[t.param("=Go online",fa)]);o.setContent(this._message,ga);this._goOnlineEventListener=p.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),da)){w.log('sidebar_go_online');m.goOnline();return false;}});};ca.prototype._renderBlackbirdUpsell=function(){"use strict";o.setContent(this._message,h.getOfflineContent());};ca.prototype._renderBlackbird=function(da){"use strict";o.setContent(this._message,h.getBlackbirdContent(da));};ca.prototype._clear=function(){"use strict";if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}n.removeClass(this._root,'upsell');n.removeClass(this._root,'offline');n.removeClass(this._root,'blackbird');n.removeClass(this._root,'error');n.removeClass(this._root,'notice');o.empty(this._message);};ca.prototype._render=function(){"use strict";this._clear();if(h.shouldShow()){if(m.hasBlackbirdEnabled()){var da=m.isOnline()?'blackbird':'upsell';n.addClass(this._root,da);this._renderBlackbird(r.getVisibility());}else if(!m.isOnline()){n.addClass(this._root,'upsell');this._renderBlackbirdUpsell();}}else if(!m.isOnline()){n.addClass(this._root,'offline');this._renderOffline();}else if(i.disconnected()){n.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!k.notifiesUserMessages()){n.addClass(this._root,'notice');var ea=t._("Alerts are off while you use another client to chat.");o.setContent(this._message,ea);}this.inform('updated');};s(ca.prototype,{_channelStatus:null,_channelData:null,_showWarningTimeout:null,_warningMsgEventListener:null,_goOnlineEventListener:null});e.exports=ca;},null);
__d("SidebarFitWindowHeight",["Arbiter","ArbiterMixin","Event","Style","SubscriptionsHandler","TinyViewport","Vector","mixin","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t){"use strict";this.$SidebarFitWindowHeight0=t;this.onViewportUpdate();l.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){"use strict";if(l.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight1=new k();this.$SidebarFitWindowHeight1.addSubscriptions(i.listen(window,'scroll',t),g.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight2!==0){j.set(this.$SidebarFitWindowHeight0,'margin-top','0');this.$SidebarFitWindowHeight2=0;}this.$SidebarFitWindowHeight1&&this.$SidebarFitWindowHeight1.release();}};s.prototype.onScroll=function(){"use strict";o(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){"use strict";this.$SidebarFitWindowHeight3=m.getScrollPosition().y;this.$SidebarFitWindowHeight4||(this.$SidebarFitWindowHeight4=this.$SidebarFitWindowHeight0.offsetHeight);};s.prototype.resizeSidebar=function(){"use strict";var t=-Math.max(Math.min(this.$SidebarFitWindowHeight3,this.$SidebarFitWindowHeight4),0);j.set(this.$SidebarFitWindowHeight0,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight2){this.$SidebarFitWindowHeight2=t;this.inform('resized',t);}};s.prototype.getOffset=function(){"use strict";return this.$SidebarFitWindowHeight2;};e.exports=s;},null);
__d("ChatSidebar",["Arbiter","ArbiterMixin","AsyncRequest","BanzaiODS","Bootloader","ChatConfig","ChatImpressionLogger","ChatOptions","ChatSidebarComposeLink.react","ChatSidebarConstants","ChatSidebarSheet","CSS","DOM","DOMDimensions","Event","JSLogger","KeyEventController","LitestandClassicPlaceHolders","MercuryConfig","OrderedFriendsList","Parent","PresencePrivacy","React","ScrollableArea","SidebarFitWindowHeight","Style","ViewportBounds","copyProperties","createArrayFromMixed","csx","cx","debounce","emptyFunction","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na){b.__markCompiled&&b.__markCompiled();var oa='chat_sidebar_visibility',pa,qa=null,ra,sa=false,ta=false,ua=false,va=false,wa=false,xa=false,ya,za,ab=false,bb,cb,db,eb,fb,gb,hb,ib=null,jb,kb=v.create('chat_sidebar');j.setEntitySample(oa,.0001);function lb(){r.removeClass(document.documentElement,'sidebarMode');if(!wa||(!wb.isVisible()&&!va)){g.inform('reflow');return;}ua=false;va=false;ib=null;eb.hide();gb.getCore().reset();r.hide(cb);if(ab){r.hide(za);r.hide(bb);r.removeClass(document.documentElement,'miniSidebar');r.removeClass(cb,"_51xq");ya&&ya.setProps({shown:false},function(){return rb(false);});kb.log('minisidebar_hide');}else kb.log('sidebar_hide');g.inform('sidebar/hide',wb);g.inform('reflow');}function mb(){var xb=wb.shouldShowSidebar(),yb=wb.shouldShowMiniSidebar();if(wb.isEnabled()&&(xb||yb)){if(xb){pb();qb();}else sb();}else lb();if(!wa){vb();wa=true;}ib=null;}function nb(){if(gb&&wb.isVisible())gb.getCore().getElement().focus();}function ob(xb){var yb=hb.height;xb.forEach(function(zb){if(zb&&zb!==pa)yb-=t.getElementDimensions(zb).height;});if(jb)yb-=jb.getOffset();if(fb)yb-=t.getElementDimensions(fb).height;return Math.max(0,yb);}function pb(){if(wb.isVisible())return;if(ab){r.hide(za);r.show(bb);r.removeClass(document.documentElement,'miniSidebar');r.removeClass(cb,"_51xq");ya&&ya.setProps({shown:false},function(){return rb(false);});}ua=true;va=false;ib=null;r.show(cb);r.addClass(document.documentElement,'sidebarMode');eb.show();kb.log('sidebar_show');g.inform('sidebar/show',wb);x.destroy('sidebar');}function qb(){var xb=ob(ia(bb.childNodes)),yb=eb.getItemHeight(),zb=8,ac=Math.floor((xb-zb)/yb);fa.set(pa,'height',xb+'px');eb.setNumTopFriends(ac);var bc=Math.floor((xb-zb)/yb);bc=(bc-2)>0?bc-2:0;gb.getData().setMaxResults(bc);g.inform('sidebar/resized',wb);g.inform('reflow');}function rb(xb){if(cb===null)return;r.conditionClass(cb,"_2e4g",xb);}function sb(){r.hide(bb);r.show(za);r.show(cb);r.addClass(document.documentElement,'sidebarMode');r.addClass(document.documentElement,'miniSidebar');r.addClass(cb,"_51xq");var xb=ob([]),yb=p.getItemHeight(true),zb=Math.floor(xb/yb)-4;if(!ya){k.loadModules(["ChatMiniSidebar.react","ChatMiniSidebarSearchSource"],function(ac,bc){if(!ra)ra=new bc({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});ya=ca.render(ca.createElement(ac,{dataSource:ra,height:xb,maxEntries:Math.max(zb,0),onClickSearch:rb,onToggleSidebar:wb.toggle,shown:true}),za);});}else ya.setProps({height:xb,maxEntries:Math.max(zb,0),shown:true});ua=false;va=true;x.destroy('sidebar');kb.log('minisidebar_show');g.inform('minisidebar/show',wb);g.inform('reflow');}function tb(){n.setSetting('sidebar_mode',wb.isEnabled(),'sidebar');new i('/ajax/chat/settings.php').setHandler(ma).setErrorHandler(ma).setData({sidebar_mode:wb.isEnabled()}).setAllowCrossPageTransition(true).send();}function ub(){return z.getActiveList().length<=l.get('sidebar.min_friends');}function vb(){var xb=true;if(!wb.isEnabled()){kb.log('state_not_enabled');xb=false;}if(!wb.isViewportCapable())if(!ab){kb.log('state_not_shown_viewport');xb=false;}else if(!wb.isViewportCapableForMiniSidebar()){kb.log('state_not_shown_viewport_mini');xb=false;}if(xb)j.bumpEntityKey(oa,'state_viewport_can_show');if(ta){kb.log('state_not_shown_hidden');xb=false;}if(ub()){kb.log('state_not_shown_num_friends');xb=false;}var yb=xb?'state_shown':'state_not_shown';kb.log(yb);j.bumpEntityKey(oa,yb);}var wb={init:function(xb,yb,zb,ac){wb.init=ma;xa=true;cb=xb;eb=yb;gb=zb;db=ac;pa=s.find(xb,'div.fbChatSidebarBody');za=s.find(xb,"._51x-");bb=s.find(xb,"._51x_");fb=s.find(xb,"._5qqe");ab=l.get('www_mini_sidebar',false);var bc=s.find(xb,"._x1u");bc&&ca.render(ca.createElement(o,{className:"_3a-4 _5q85"}),bc);u.listen(window,'resize',mb);w.registerKey('q',function(event){if(ua){if(!qa)qa=s.scry(xb,'.inputsearch')[0];if(qa){qa.focus();event.prevent();}}});var cc=new q(xb);cc.subscribe('updated',mb);eb.setScrollContainer(aa.byClass(eb.getRoot(),'uiScrollableAreaWrap'));eb.subscribe(['render','show','hide'],la(function(dc){var ec=da.getInstance(eb.getRoot());ec&&ec.adjustGripper();}));g.subscribe('chat/option-changed',function(dc,ec){if(ec.name=="sidebar_mode"){sa=!!n.getSetting('sidebar_mode');mb();}if(ec.name==='hide_groups')mb();});zb.getCore().subscribe('sidebar/typeahead/active',wb.updateOnActiveTypeahead);if(y.SidebarClearTypeaheadGK){zb.subscribe('blur',function(){if(!eb.isVisible())wb.updateOnActiveTypeahead(null,false);});zb.subscribe('focus',function(){if(eb.isVisible()&&zb.getCore().getValue())wb.updateOnActiveTypeahead(null,true);});}zb.subscribe('reset',function(){if(!zb.getCore().getValue()&&!eb.isVisible())wb.updateOnActiveTypeahead(null,false);});g.subscribe('buddylist-nub/initialized',function(dc,ec){u.listen(ec.getButton(),'click',function(event){var fc=ta;ta=false;wb.enable();var gc=wb.shouldShowSidebar()||wb.shouldShowMiniSidebar();ta=fc&&!gc;return !gc;});});sa=!!n.getSetting('sidebar_mode');ba.subscribe('privacy-user-presence-changed',mb);mb();m.init(eb);ga.addPersistentRight(wb.getVisibleWidth);wb.inform('sidebar/initialized',wb,g.BEHAVIOR_PERSISTENT);g.inform('sidebar/initialized',wb,g.BEHAVIOR_PERSISTENT);jb=new ea(fb);jb.subscribe('resized',mb);},updateOnActiveTypeahead:function(xb,yb){if(!ua)return;if(yb){eb.hide();}else{gb.getView().clearContent();eb.show();mb();}},isInitialized:function(){return wa;},disable:function(){if(!wb.isEnabled())return;sa=false;tb();lb();},enable:function(){if(wb.isEnabled())return;sa=true;tb();mb();setTimeout(nb,0);},ensureLoaded:function(){if(!sa)return;if(xa)return;if(na('pagelet_sidebar'))return;d(['UIPagelet'],function(xb){var yb=s.create('div',{id:'pagelet_sidebar'});s.appendContent(document.body,yb);xb.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});xa=true;},hide:function(){if(ta)return;ta=true;lb();},unhide:function(){if(!ta)return;ta=false;mb();},getBody:function(){return pa;},getRoot:function(){return cb;},getVisibleWidth:function(){if((!ua&&!va)||!cb)return 0;if(ib===null){ib=cb.offsetWidth;if(va)ib=206;}return ib;},isEnabled:function(){return sa;},isViewportCapable:function(){hb=t.getViewportWithoutScrollbarDimensions();var xb=l.get('sidebar.minimum_width');return hb.width>xb;},shouldShowSidebar:function(){var xb=wb.isViewportCapable();return xb&&!ta&&!ub();},isViewportCapableForMiniSidebar:function(){hb=t.getViewportWithoutScrollbarDimensions();var xb=l.get('sidebar.minimum_width'),yb=l.get('minisidebar.minimum_width');return hb.width>yb&&hb.width<=xb;},shouldShowMiniSidebar:function(){if(!ab)return false;var xb=wb.isViewportCapableForMiniSidebar();return xb&&!ta&&!ub();},isVisible:function(){return ua;},resize:mb,toggle:function(){wb.isEnabled()?wb.disable():wb.enable();}};ha(wb,h);e.exports=wb;},null);
__d("ChatTypeaheadBehavior",["ChatOpenTab","CSS","MercuryConfig","Parent","Rect","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(p,q){var r=j.byClass(p,"_4oes");if(r)h.conditionClass(r,"_5q83",q);}function o(p){"use strict";this._typeahead=p;}o.prototype.enable=function(){"use strict";var p=this._typeahead;this._subscriptions=[p.subscribe('focus',function(){p.getData().refreshData();n(p.getElement(),true);}),p.subscribe('blur',function(q){if(!i.SidebarClearTypeaheadGK)p.getCore().reset();n(p.getElement(),false);}),p.subscribe('respond',function(q,r){if(r.value&&r.value===p.getCore().getValue()){if(!r.results.length){var s=r.value.toLowerCase(),t=p.getData().getQueryCache();if(!r.isAsync&&!t.hasOwnProperty(s))return;p.getView().showNoResults();}h.addClass(p.getElement(),'hasValue');}}),p.subscribe('reset',function(){h.removeClass(p.getElement(),'hasValue');}),p.subscribe('select',function(q,r){var s=r.selected.uid;if(r.selected.mercury_thread&&!r.selected.mercury_thread.is_canonical)s=r.selected.mercury_thread.thread_fbid;p.getView().hide();g.openTabByType(s,r.selected.type,'typeahead');}),p.subscribe('highlight',function(q,r){if(r.index>=0){var s=p.getView().getItems()[r.index];if(s){var t=new k(s),u=s.offsetParent,v=t.boundWithin(new k(u)).getPositionVector();t.getPositionVector().sub(v).scrollElementBy(u);}}})];};o.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(p){this._typeahead.unsubscribe(p);},this);this._subscriptions=null;};l(o.prototype,{_subscriptions:null});e.exports=o;},null);
__d("NotificationConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={PayloadSourceType:{UNKNOWN:0,USER_ACTION:1,LIVE_SEND:2,ENDPOINT:3,INITIAL_LOAD:4,OTHER_APPLICATION:5,SYNC:6}};},null);
__d("NotificationTokens",["CurrentUser"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={tokenizeIDs:function(i){return i.map(function(j){return g.getID()+':'+j;});},untokenizeIDs:function(i){return i.map(function(j){return j.split(':')[1];});}};e.exports=h;},null);
__d("NotificationUpdates",["Arbiter","BizSiteIdentifier.brands","ChannelConstants","JSLogger","NotificationConstants","NotificationTokens","LiveTimer","copyProperties","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p={},q={},r={},s={},t={},u=[],v=0,w=j.create('notification_updates');function x(){if(v)return;var ba=p,ca=q,da=r,ea=s,fa=t;p={};q={};r={};s={};t={};z('notifications-updated',ba);if(Object.keys(ca).length)z('seen-state-updated',ca);if(Object.keys(da).length)z('read-state-updated',da);if(Object.keys(ea).length)z('hidden-state-updated',ea);if(Object.keys(fa).length)z('gnf-state-updated',fa);u.pop();}function y(){if(u.length)return u[u.length-1];return k.PayloadSourceType.UNKNOWN;}function z(event,ba){aa.inform(event,{updates:ba,source:y()});}g.subscribe(i.getArbiterType('notification_json'),function(ba,ca){var da=Date.now(),ea=ca.obj.nodes;if(ea){ea.forEach(function(fa){fa.receivedTime=da;});w.debug('notifications_received',ea);aa.handleUpdate(k.PayloadSourceType.LIVE_SEND,ca.obj);}});g.subscribe(i.getArbiterType('notifications_seen'),function(ba,ca){var da=l.tokenizeIDs(ca.obj.alert_ids);aa.handleUpdate(k.PayloadSourceType.LIVE_SEND,{seenState:o(da)});});g.subscribe(i.getArbiterType('notifications_read'),function(ba,ca){var da=l.tokenizeIDs(ca.obj.alert_ids);aa.handleUpdate(k.PayloadSourceType.LIVE_SEND,{readState:o(da)});});var aa=n(new g(),{handleUpdate:function(ba,ca){if(ca.nodes&&Array.isArray(ca.nodes))ca.nodes=this._filterNodesBasedOnBusinessID(ca.nodes);if(ca.servertime)m.restart(ca.servertime);if(Object.keys(ca).length)this.synchronizeInforms(function(){u.push(ba);var da=n({payloadsource:y()},ca);this.inform('update-notifications',da);this.inform('update-seen',da);this.inform('update-read',da);this.inform('update-hidden',da);this.inform('update-gnf',da);}.bind(this));},didUpdateNotifications:function(ba){n(p,o(ba));x();},didUpdateSeenState:function(ba){n(q,o(ba));x();},didUpdateReadState:function(ba){n(r,o(ba));x();},didUpdateHiddenState:function(ba){n(s,o(ba));x();},didUpdateGNFState:function(ba){n(t,o(ba));x();},synchronizeInforms:function(ba){v++;try{ba();}catch(ca){throw ca;}finally{v--;x();}},_filterNodesBasedOnBusinessID:function(ba){return ba.filter(function(ca){return ca.business_id?(parseInt(h.getBusinessID(),10)==ca.business_id):!h.isBizSite();});}});e.exports=aa;},null);
__d("NotificationSeenState",["NotificationConstants","NotificationUpdates","copyProperties","createObjectFrom","mergeObjects"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l={},m=1,n=2,o=0,p=m,q=m|n,r=g.PayloadSourceType.INITIAL_LOAD,s={UNSEEN_AND_UNREAD:o,SEEN_BUT_UNREAD:p,SEEN_AND_READ:q};function t(w){var x=[],y=[];Object.keys(w).forEach(function(z){var aa=w[z],ba=l[z];l[z]=aa;if(ba===(void 0)){x.push(z);y.push(z);return;}var ca=ba^aa;if(ca&m)x.push(z);if(ca&n)y.push(z);});x.length&&h.didUpdateSeenState(x);y.length&&h.didUpdateReadState(y);}h.subscribe('update-notifications',function(w,x){var y=x.nodes;if(!y||!y.length)return;var z=x.payloadsource,aa=g.PayloadSourceType,ba=z==aa.ENDPOINT,ca={};x.nodes.forEach(function(da){var ea=da.alert_id;if(!ba||l[ea]===(void 0))ca[ea]=s[da.seen_state];});t(ca);});h.subscribe('update-seen',function(w,x){if(!x.seenState)return;var y=[],z={};Object.keys(x.seenState).forEach(function(ba){if(!x.seenState[ba]){y.push(ba);return;}var ca=l[ba];if(ca!==(void 0))z[ba]=ca|m;});var aa=k(j(y,o),z);t(aa);});h.subscribe('update-read',function(w,x){if(!x.readState)return;var y=[],z={};Object.keys(x.readState).forEach(function(ba){if(x.readState[ba]){y.push(ba);return;}var ca=l[ba];if(ca!==(void 0)){z[ba]=ca&~n;}else if(x.payloadsource==r)z[ba]=p;});var aa=k(j(y,q),z);t(aa);});function u(w){var x=l[w];return x;}var v={isRead:function(w){return u(w)===q;},isSeen:function(w){return u(w)!==o;},getUnseenCount:function(){return v.getUnseenIDs().length;},getUnseenIDs:function(){return Object.keys(l).filter(function(w){return l[w]===o;});},getUnreadCount:function(){return v.getUnreadIDs().length;},getUnreadIDs:function(){return Object.keys(l).filter(function(w){return l[w]!==q;});}};e.exports=v;},null);
__d("arrayStableSort",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i){return h.map(function(j,k){return {data:j,index:k};}).sort(function(j,k){return i(j.data,k.data)||(j.index-k.index);}).map(function(j){return j.data;});}e.exports=g;},null);
__d("RangedCallbackManager",["CallbackManagerController","arrayStableSort","createObjectFrom"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k,l,m){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager1=false;this.$RangedCallbackManager2=false;this.$RangedCallbackManager3={};this.$RangedCallbackManager4=new g(this.$RangedCallbackManager5.bind(this));this.$RangedCallbackManager6=k;this.$RangedCallbackManager7=l;this.$RangedCallbackManager8=m;}j.prototype.executeOrEnqueue=function(k,l,m,n,o){"use strict";return this.$RangedCallbackManager4.executeOrEnqueue({start:k,limit:l},m,{strict:!!n,skipOnStrictHandler:o});};j.prototype.unsubscribe=function(k){"use strict";this.$RangedCallbackManager4.unsubscribe(k);};j.prototype.getUnavailableResources=function(k){"use strict";var l=this.$RangedCallbackManager4.getRequest(k),m=[];if(l&&!this.$RangedCallbackManager1){var n=l.request,o=this.$RangedCallbackManager9(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;};j.prototype.addResources=function(k){"use strict";k.forEach(function(l){if(!this.$RangedCallbackManager3[l]){this.$RangedCallbackManager3[l]=true;this.$RangedCallbackManager0.push(l);this.$RangedCallbackManager2=null;}}.bind(this));this.resortResources();this.$RangedCallbackManager4.runPossibleCallbacks();};j.prototype.addResourcesWithoutSorting=function(k,l){"use strict";var m=this.$RangedCallbackManager0.slice(0,l);m=m.concat(k);m=m.concat(this.$RangedCallbackManager0.slice(l));this.$RangedCallbackManager0=m;Object.assign(this.$RangedCallbackManager3,i(k,true));this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();};j.prototype.removeResources=function(k){"use strict";k.forEach(function(l){if(this.$RangedCallbackManager3[l]){this.$RangedCallbackManager3[l]=false;var m=this.$RangedCallbackManager0.indexOf(l);if(m!=-1)this.$RangedCallbackManager0.splice(m,1);}}.bind(this));};j.prototype.removeAllResources=function(){"use strict";this.$RangedCallbackManager0=[];this.$RangedCallbackManager3={};};j.prototype.resortResources=function(){"use strict";this.$RangedCallbackManager0=h(this.$RangedCallbackManager0,function(k,l){return this.$RangedCallbackManager7(this.$RangedCallbackManager6(k),this.$RangedCallbackManager6(l));}.bind(this));};j.prototype.setReachedEndOfArray=function(){"use strict";if(!this.$RangedCallbackManager1){this.$RangedCallbackManager1=true;this.$RangedCallbackManager2=null;this.$RangedCallbackManager4.runPossibleCallbacks();}};j.prototype.hasReachedEndOfArray=function(){"use strict";return this.$RangedCallbackManager1;};j.prototype.setError=function(k){"use strict";if(this.$RangedCallbackManager2!==k){this.$RangedCallbackManager2=k;this.$RangedCallbackManager4.runPossibleCallbacks();}};j.prototype.getError=function(k,l,m){"use strict";var n=this.$RangedCallbackManager9({strict:m});return k+l>n.length?this.$RangedCallbackManager2:null;};j.prototype.hasResource=function(k){"use strict";return this.$RangedCallbackManager3[k];};j.prototype.getResourceAtIndex=function(k){"use strict";return this.$RangedCallbackManager0[k];};j.prototype.getAllResources=function(){"use strict";return this.$RangedCallbackManager0.concat();};j.prototype.getCurrentArraySize=function(k){"use strict";return this.$RangedCallbackManager9(k).length;};j.prototype.$RangedCallbackManager9=function(k){"use strict";var l=this.$RangedCallbackManager0;if(k&&k.strict){var m=k.skipOnStrictHandler||this.$RangedCallbackManager8;if(m)l=l.filter(m);}return l;};j.prototype.$RangedCallbackManager5=function(k,l){"use strict";var m=this.$RangedCallbackManager9(l);if(!this.$RangedCallbackManager1&&!this.$RangedCallbackManager2&&k.start+k.limit>m.length){return false;}else{var n=m.slice(k.start,k.start+k.limit),o=k.start+k.limit>m.length?this.$RangedCallbackManager2:null;return [n,o];}};j.prototype.getElementsUntil=function(k){"use strict";var l=[];for(var m=0;m<this.$RangedCallbackManager0.length;m++){var n=this.$RangedCallbackManager6(this.$RangedCallbackManager0[m]);if(this.$RangedCallbackManager7(n,k)>0)break;l.push(this.$RangedCallbackManager0[m]);}return l;};e.exports=j;},null);
__d("NotificationStore",["KeyedCallbackManager","NotificationConstants","NotificationUpdates","RangedCallbackManager","MercuryServerDispatcher"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=new g(),m=new j(function(q){var r=l.getResource(q);return r.creation_time;},function(q,r){return r-q;}),n={},o=null;i.subscribe('update-notifications',function(q,r){if(r.page_info)n=r.page_info;if(r.nodes===(void 0))return;var s,t=[],u={},v=r.nodes||[],w;v.forEach(function(x){s=x.alert_id;w=l.getResource(s);if(!w||w.creation_time<x.creation_time){t.push(s);u[s]=x;}});l.addResourcesAndExecute(u);m.addResources(t);i.didUpdateNotifications(t);});k.registerEndpoints({'/ajax/notifications/client/get.php':{mode:k.IMMEDIATE,handler:function(q){i.handleUpdate(h.PayloadSourceType.ENDPOINT,q);}}});var p={getNotifications:function(q,r){var s=m.executeOrEnqueue(0,q,function(z){var aa=l.executeOrEnqueue(z,r);}),t=m.getUnavailableResources(s);if(t.length){m.unsubscribe(s);if(!p.canFetchMore()){l.executeOrEnqueue(m.getAllResources(),r);return;}var u=n,v=(u&&u.end_cursor)||null,w;if(v){var x=Math.max.apply(null,t),y=m.getCurrentArraySize();w=x-y+1;}else w=q;k.trySend('/ajax/notifications/client/get.php',{businessID:o,cursor:v,length:w});}},getAll:function(q){p.getNotifications(p.getCount(),q);},getCount:function(){return m.getAllResources().length;},canFetchMore:function(){var q=n;return (!q||!q.hasOwnProperty('has_next_page')||q.has_next_page);},setBusinessID:function(q){o=q;}};e.exports=p;},null);
__d("NotificationInitialLoadController",["Arbiter","NotificationConstants","NotificationUpdates","NotificationSeenState","NotificationStore"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();b('NotificationSeenState');b('NotificationStore');function j(k){i.handleUpdate(h.PayloadSourceType.INITIAL_LOAD,k);g.inform('jewel/count-updated',{jewel:'notifications',count:k.nodes.length});}e.exports=j;},null);
__d("NotificationPhotoThumbnail",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(i){if(!i.media||!i.style_list||!i.style_list.length)return null;switch(i.style_list[0]){case 'new_album':case 'album':case 'application':case 'photo':case 'video':case 'video_autoplay':case 'video_inline':return i.media.image;default:return null;}}var h={getThumbnail:function(i,j,k){var l;if(i&&i.length){i.some(function(p){l=g(p);if(l)return true;return false;});if(l)return l;}if(k){var m=k.relevant_comments;if(m&&m.length){var n=m[0].attachments;if(n&&n.length){l=g(n[0]);if(l)return l;}}}if(j){var o=j.attachments;if(o&&o.length)return g(o[0]);}return null;}};e.exports=h;},null);
__d("NotificationURI",["BusinessURI.brands","URI","isFacebookURI","VideoPermalinkURI"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k={localize:function(l){l=g(l);if(!i(l))return l.toString();var m=l.getSubdomain();return l.getUnqualifiedURI().getQualifiedURI().setSubdomain(m).toString();},snowliftable:function(l){if(!l)return false;l=h(l);var m=l.getQueryData();return i(l)&&(j.isValid(l)||'fbid' in m);},isVaultSetURI:function(l){return this._areEquals(l,'/ajax/vault/sharer_preview.php');},isAlbumDraftRecoveryDialogURI:function(l){return this._areEquals(l,'/ajax/photos/upload/overlay/');},_areEquals:function(l,m){if(!l)return false;l=h(l);return i(l)&&l.getPath()===m;}};e.exports=k;},null);
__d("XNotificationsGenericNegativeFeedbackController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/notifications\/feedback\/generic\/negative\/",{notif_id:{type:"Int",required:true},undo:{type:"Bool",defaultValue:false}});},null);
__d("NotificationUserActions",["AsyncRequest","AsyncSignal","NotificationConstants","NotificationStore","NotificationTokens","NotificationUpdates","URI","XNotificationsGenericNegativeFeedbackController","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=i.PayloadSourceType.USER_ACTION,r='mark_spam',s='turn_off',t='undo',u='original_subscription_level',v=false;function w(ca){var da=m('/ajax/notifications/mark_read.php').getQualifiedURI().toString();new h(da,ca).send();}function x(ca){var da={};ca.forEach(function(ea,fa){da['alert_ids['+fa+']']=ea;});return da;}function y(ca,da,ea,fa,ga){var ha=k.untokenizeIDs([ca])[0],ia={notification_id:ha,client_rendered:true,request_type:da};Object.assign(ia,ea);new g('/ajax/notifications/negative_req.php').setData(ia).setHandler(fa||p).setErrorHandler(ga||p).send();}function z(ca,da,ea,fa){var ga=n.getURIBuilder().setInt('notif_id',k.untokenizeIDs([ca])[0]).setBool('undo',fa).getURI(),ha=function(ia){if(fa){l.handleUpdate(q,{hiddenState:o([ca],false),gnfState:o([ca],false)});da();}else{var ja=ia.payload.show_after_ok;l.handleUpdate(q,{hiddenState:o([ca],!ja),gnfState:o([ca],true)});da(ia.payload.confirmation);}};new g(ga).setHandler(ha||p).setErrorHandler(ea||p).send();}function aa(ca,da,ea,fa,ga){var ha=ga?t:s;j.getAll(function(ia){var ja=Object.keys(ia).filter(function(ka){var la=ia[ka];return !!(la.application&&la.application.id&&la.application.id==da);});y(ca,ha,null,function(ka){ea(ka);l.handleUpdate(q,{hiddenState:o(ja,!ga)});},fa);});}var ba={markNotificationsAsSeen:function(ca){l.handleUpdate(q,{seenState:o(ca)});var da=k.untokenizeIDs(ca),ea=x(da);ea.seen=true;w(ea);},setNextIsFromReadButton:function(ca){v=ca;},markNotificationsAsRead:function(ca){l.handleUpdate(q,{readState:o(ca)});var da=k.untokenizeIDs(ca),ea=x(da);if(v){ea.from_read_button=true;v=false;}w(ea);},giveGenericNegativeFeedback:function(ca,da,ea){z(ca,da,ea,false);},undoGenericNegativeFeedback:function(ca,da,ea){z(ca,da,ea,true);},markNotificationAsHidden:function(ca,da,ea){l.handleUpdate(q,{hiddenState:o([ca])});y(ca,s,null,da,ea);},markNotificationAsVisible:function(ca,da,ea,fa){l.handleUpdate(q,{hiddenState:o([ca],false)});var ga=null;if(da!==null){ga={};ga[u]=da;}y(ca,t,ga,ea,fa);},markNotificationAsSpam:function(ca,da,ea){l.handleUpdate(q,{hiddenState:o([ca],true)});y(ca,r,null,da,ea);},markAppAsHidden:function(ca,da,ea,fa){var ga=false;aa(ca,da,ea,fa,ga);},markAppAsVisible:function(ca,da,ea,fa){var ga=true;aa(ca,da,ea,fa,ga);}};e.exports=ba;},null);
__d("SplitImage.react",["React","Image.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=g.createClass({displayName:"SplitImage",render:function(){var l=this.props.size;return (g.createElement("div",g.__spread({},this.props,{className:j(this.props.className,"_55lt"),style:Object.assign({},(this.props.style||{}),{width:l,height:l})}),this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var l=this.props.srcs,m=Array.isArray(l);if(!m||l.length==1)return this.renderOne(m?l[0]:l);return l.length==2?this.renderTwo(l):this.renderThree(l);},renderOne:function(l){return (g.createElement(h,{src:l,width:this.props.size,height:this.props.size,alt:""}));},renderTwo:function(l){var m=this.props.size,n=Math.floor(m/2),o=-Math.floor(n/2),p=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.createElement("div",null,g.createElement("div",{className:"_55lu",style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement("div",{className:p,style:{width:n}},g.createElement(h,{src:l[1],width:m,height:m,style:{marginLeft:o}}))));},renderThree:function(l){var m=this.props.size,n=Math.floor(m/3*2),o=-Math.floor((m-n)/2),p=Math.floor(m/2),q=m-n,r=-Math.floor((p-q)/2),s=(("_55lu")+(this.props.border?' '+"_57pl":'')),t=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.createElement("div",null,g.createElement("div",{className:s,style:{width:n}},g.createElement(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createElement("div",{className:t,style:{width:q,height:p}},g.createElement(h,{src:l[1],width:p,height:p,style:{marginLeft:r}})),g.createElement("div",{className:"_55lu",style:{width:q,height:p}},g.createElement(h,{src:l[2],width:p,height:p,style:{marginLeft:r}}))));}});e.exports=k;},null);
__d("SyncRequestTitle.react",["React","fbt","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=g,k=j.PropTypes,l=g.createClass({displayName:"SyncRequestTitle",propTypes:{appName:k.string.isRequired,isSender:k.bool.isRequired,receiverName:k.string.isRequired,senderName:k.string.isRequired},render:function(){if(this.props.isSender){return (g.createElement("div",null,h._("Waiting for {receiver} to accept your invite to play {app_name}.",[h.param("receiver",g.createElement("span",{className:"_dg4"},this.props.receiverName)),h.param("app_name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}else return (g.createElement("div",null,h._("{sender} wants to play {app_name} with you, right now.",[h.param("sender",g.createElement("span",{className:"_dg4"},this.props.senderName)),h.param("app_name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}});e.exports=l;},null);
__d("SyncRequestAcceptedMessage.react",["React","fbt","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=g,k=j.PropTypes,l=g.createClass({displayName:"SyncRequestAcceptedMessage",propTypes:{appName:k.string.isRequired,isSender:k.bool.isRequired,receiverName:k.string.isRequired,senderName:k.string.isRequired},render:function(){if(this.props.isSender){return (g.createElement("div",null,h._("{receiver} accepted your invite to play {app name}.",[h.param("receiver",g.createElement("span",{className:"_dg4"},this.props.receiverName)),h.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}else return (g.createElement("div",null,h._("You accepted an invite from {sender} to play {app name}.",[h.param("sender",g.createElement("span",{className:"_dg4"},this.props.senderName)),h.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}});e.exports=l;},null);
__d("SyncRequestRejectedMessage.react",["AsyncRequest","Link.react","React","URI","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=i,n=m.PropTypes,o=i.createClass({displayName:"SyncRequestRejectedMessage",propTypes:{requestId:n.string.isRequired,app:n.object.isRequired,isSender:n.bool.isRequired,receiver:n.object.isRequired,sender:n.object.isRequired},render:function(){if(this.props.isSender){return (i.createElement("div",null,l._("{receiver} declined your invite to play {app_name}.",[l.param("receiver",i.createElement("span",{className:"_dg4"},this.props.receiver.name)),l.param("app_name",i.createElement("span",{className:"_dg5"},this.props.app.name))])));}else return (i.createElement("div",null,l._("You declined an invite from {sender} to play {app_name}.",[l.param("sender",i.createElement("span",{className:"_dg4"},this.props.sender.name)),l.param("app_name",i.createElement("span",{className:"_dg5"},this.props.app.name))]),i.createElement("div",{className:"_13n7"},i.createElement("div",null,i.createElement(h,{onClick:this._submitBlockApp},l._("Block {app}",[l.param("app",this.props.app.name)]))),i.createElement("div",null,i.createElement(h,{onClick:this._submitBlockUser},l._("Block requests from {sender}",[l.param("sender",this.props.sender.name)]))))));},_submitBlockApp:function(){var p=new j('/games/block_app/'),q=new g().setURI(p);q.setData({app_id:this.props.app.id,source:'sync_request'});q.send();},_submitBlockUser:function(){var p=new j('/games/block_user/'),q=new g().setURI(p);q.setData({app_id:this.props.app.id,blockee_uid:this.props.sender.id});q.send();}});e.exports=o;},null);
__d("SyncRequestExpiredMessage.react",["React","fbt","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=g,k=j.PropTypes,l=g.createClass({displayName:"SyncRequestExpiredMessage",propTypes:{appName:k.string.isRequired,isSender:k.bool.isRequired,receiverName:k.string.isRequired,senderName:k.string.isRequired},render:function(){if(this.props.isSender){return (g.createElement("div",null,h._("{receiver} missed your invite to play {app name}.",[h.param("receiver",g.createElement("span",{className:"_dg4"},this.props.receiverName)),h.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}else return (g.createElement("div",null,h._("You missed an invite from {sender} to play {app name}.",[h.param("sender",g.createElement("span",{className:"_dg4"},this.props.senderName)),h.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}});e.exports=l;},null);
__d("SyncRequestCanceledMessage.react",["React","cx","fbt"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=g,k=j.PropTypes,l=g.createClass({displayName:"SyncRequestCanceledMessage",propTypes:{appName:k.string.isRequired,isSender:k.bool.isRequired,receiverName:k.string.isRequired,senderName:k.string.isRequired},render:function(){if(this.props.isSender){return (g.createElement("div",null,i._("You canceled an invite to {receiver} to play {app name}.",[i.param("receiver",g.createElement("span",{className:"_dg4"},this.props.receiverName)),i.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}else return (g.createElement("div",null,i._("{sender} canceled an invitation to play {app name}.",[i.param("sender",g.createElement("span",{className:"_dg4"},this.props.senderName)),i.param("app name",g.createElement("span",{className:"_dg5"},this.props.appName))])));}});e.exports=l;},null);
__d("SyncRequestTimer.react",["React","fbt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=g,j=i.PropTypes;function k(m){if(m){m=Math.ceil(m);var n=m%60;if(n<10)n='0'+n;var o=Math.floor(m/60);return o+':'+n;}else return "0:00";}var l=g.createClass({displayName:"SyncRequestTimer",propTypes:{timeRemaining:j.number.isRequired,isSender:j.bool.isRequired,receiverName:j.string.isRequired},render:function(){if(this.props.isSender){return (g.createElement("div",null,h._("({time_remaining} remaining)",[h.param("time_remaining",k(this.props.timeRemaining))])));}else return (g.createElement("div",null,h._("You have {time_remaining} to accept.",[h.param("time_remaining",k(this.props.timeRemaining))])));}});e.exports=l;},null);
__d("XSyncRequestSubmitController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/platform\/games\/sync_requests\/submit\/",{request_id:{type:"Int",required:true},sender:{type:"Int",required:true},action:{type:"Int",required:true}});},null);
__d("SyncRequest.react",["Arbiter","AsyncRequest","ChannelConstants","React","SyncRequestStatusEnum","SyncRequestTitle.react","SyncRequestAcceptedMessage.react","SyncRequestRejectedMessage.react","SyncRequestExpiredMessage.react","SyncRequestCanceledMessage.react","SyncRequestTimer.react","XUIButton.react","XSyncRequestSubmitController","cx","fbt","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=j,x=w.PropTypes,y=j.createClass({displayName:"SyncRequest",propTypes:{app:x.object.isRequired,creationTime:x.number.isRequired,requestId:x.string.isRequired,receiver:x.object.isRequired,sender:x.object.isRequired,status:x.oneOf(v(k)).isRequired,timeout:x.number.isRequired,timeRemaining:x.number.isRequired,viewerId:x.number.isRequired,onStatusUpdate:x.func},componentWillMount:function(){if(this.props.status===k.PENDING){var z=g.subscribe(i.getArbiterType('sync_request_updated'),function(ca,da){da=da.obj;if(da.id.toString()!==this.props.requestId)return;this.setState({status:da.status});}.bind(this));this.setState({statusEvent:z});}var aa=null;if(this.props.status===k.PENDING){var ba=function(){this.setState({time_remaining:(this.state.time_remaining-1)});if(this.state.time_remaining<=0){clearInterval(this.state.counter);var ca={counter:null,time_remaining:0};if(this.state.status===k.PENDING)ca.status=k.EXPIRED;this.setState(ca);}};aa=setInterval(ba.bind(this),1000);}this.setState({time_remaining:this.props.timeRemaining,counter:aa});},componentWillUnmount:function(){if(this.state.counter)clearInterval(this.state.counter);g.unsubscribe(this.state.statusEvent);},getInitialState:function(){return {buttonsDisabled:false,time:Date.now(),status:this.props.status,viewerIsSender:this.props.viewerId===this.props.sender.id};},componentDidUpdate:function(z,aa){if(this.props.status!=k.PENDING)this.state.status=this.props.status;if(this.props.onStatusUpdate)this.props.onStatusUpdate(this.state.status,aa.status);},render:function(){var z;switch(this.state.status){case k.PENDING:var aa;if(!this.state.viewerIsSender){aa=[j.createElement(r,{use:"confirm",onClick:this._handleAccept,disabled:this.state.buttonsDisabled,label:u._("Accept")}),j.createElement(r,{use:"default",onClick:this._handleReject,disabled:this.state.buttonsDisabled,label:u._("Decline")})];}else aa=j.createElement(r,{use:"default",onClick:this._handleCancel,disabled:this.state.buttonsDisabled,label:u._("Cancel")});z=(j.createElement("div",null,j.createElement("div",{className:"_372m"},j.createElement(l,{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name})),j.createElement("div",{className:"_372n"},j.createElement(q,{isSender:this.state.viewerIsSender,timeRemaining:this.state.time_remaining,receiverName:this.props.receiver.name})),j.createElement("div",{className:"_372o"},aa)));break;case k.ACCEPTED:z=j.createElement("div",{className:"_372p mvs"},j.createElement(m,{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;case k.REJECTED:z=j.createElement("div",{className:"_372p mvs"},j.createElement(n,{requestId:this.props.requestId,app:this.props.app,isSender:this.state.viewerIsSender,receiver:this.props.receiver,sender:this.props.sender}));break;case k.EXPIRED:z=j.createElement("div",{className:"_372p mvs"},j.createElement(o,{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;case k.CANCELED:z=j.createElement("div",{className:"_372p mvs"},j.createElement(p,{appName:this.props.app.name,isSender:this.state.viewerIsSender,receiverName:this.props.receiver.name,senderName:this.props.sender.name}));break;default:throw new Error('The request status `%s` is unknown.',this.state.status);}return (j.createElement("div",{className:"_372q"},z));},_handleAccept:function(){this._handleStatusUpdate(k.ACCEPTED);var z=window.open(this.props.app.uri);if(z)z.focus();},_handleReject:function(){this._handleStatusUpdate(k.REJECTED);},_handleCancel:function(){this._handleStatusUpdate(k.CANCELED);},_handleStatusUpdate:function(z){this.setState({status:z,buttonsDisabled:true});var aa=s.getURIBuilder().setInt('request_id',this.props.requestId).setInt('sender',this.props.sender.id).setInt('action',z).getURI();new h().setURI(aa).setHandler(function(ba){this.setState({status:z});}.bind(this)).setErrorHandler(function(ba){this.setState({buttonsDisabled:false});}.bind(this)).send();}});e.exports=y;},null);
__d("AbstractBadge.react",["React","cx","invariant","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=g,l=k.PropTypes;function m(o){return parseInt(o,10)===o;}var n=g.createClass({displayName:"AbstractBadge",propTypes:{count:l.number.isRequired,maxcount:l.number},getDefaultProps:function(){return {maxcount:20};},render:function(){var o=this.props.count,p=this.props.maxcount;i(m(o));i(m(p));var q=(("_51lp")+(o>p?' '+"_51lr":'')+(o===0?' '+"hidden_elem":''));return (g.createElement("span",g.__spread({},this.props,{className:j(this.props.className,q)}),o>p?p+'+':o));}});e.exports=n;},null);
__d("XUIBadge.react",["React","AbstractBadge.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=g,l=k.PropTypes,m=g.createClass({displayName:"XUIBadge",propTypes:{type:l.oneOf(['regular','special'])},getDefaultProps:function(){return {type:'regular'};},render:function(){var n=this.props.type,o=(("_5ugh")+(n==='regular'?' '+"_5ugf":'')+(n==='special'?' '+"_5ugg":''));return (g.createElement(h,g.__spread({},this.props,{className:j(this.props.className,o),type:null})));}});e.exports=m;},null);
__d("str2rstr",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){var i="",j,k;for(var l=0;l<h.length;l++){j=h.charCodeAt(l);k=l+1<h.length?h.charCodeAt(l+1):0;if(55296<=j&&j<=56319&&56320<=k&&k<=57343){j=65536+((j&1023)<<10)+(k&1023);l++;}if(j<=127){i+=String.fromCharCode(j);}else if(j<=2047){i+=String.fromCharCode(192|((j>>>6)&31),128|(j&63));}else if(j<=65535){i+=String.fromCharCode(224|((j>>>12)&15),128|((j>>>6)&63),128|(j&63));}else if(j<=2097151)i+=String.fromCharCode(240|((j>>>18)&7),128|((j>>>12)&63),128|((j>>>6)&63),128|(j&63));}return i;}e.exports=g;},null);
__d("md5",["str2rstr"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(u,v){var w=u[0],x=u[1],y=u[2],z=u[3];w=j(w,x,y,z,v[0],7,-680876936);z=j(z,w,x,y,v[1],12,-389564586);y=j(y,z,w,x,v[2],17,606105819);x=j(x,y,z,w,v[3],22,-1044525330);w=j(w,x,y,z,v[4],7,-176418897);z=j(z,w,x,y,v[5],12,1200080426);y=j(y,z,w,x,v[6],17,-1473231341);x=j(x,y,z,w,v[7],22,-45705983);w=j(w,x,y,z,v[8],7,1770035416);z=j(z,w,x,y,v[9],12,-1958414417);y=j(y,z,w,x,v[10],17,-42063);x=j(x,y,z,w,v[11],22,-1990404162);w=j(w,x,y,z,v[12],7,1804603682);z=j(z,w,x,y,v[13],12,-40341101);y=j(y,z,w,x,v[14],17,-1502002290);x=j(x,y,z,w,v[15],22,1236535329);w=k(w,x,y,z,v[1],5,-165796510);z=k(z,w,x,y,v[6],9,-1069501632);y=k(y,z,w,x,v[11],14,643717713);x=k(x,y,z,w,v[0],20,-373897302);w=k(w,x,y,z,v[5],5,-701558691);z=k(z,w,x,y,v[10],9,38016083);y=k(y,z,w,x,v[15],14,-660478335);x=k(x,y,z,w,v[4],20,-405537848);w=k(w,x,y,z,v[9],5,568446438);z=k(z,w,x,y,v[14],9,-1019803690);y=k(y,z,w,x,v[3],14,-187363961);x=k(x,y,z,w,v[8],20,1163531501);w=k(w,x,y,z,v[13],5,-1444681467);z=k(z,w,x,y,v[2],9,-51403784);y=k(y,z,w,x,v[7],14,1735328473);x=k(x,y,z,w,v[12],20,-1926607734);w=l(w,x,y,z,v[5],4,-378558);z=l(z,w,x,y,v[8],11,-2022574463);y=l(y,z,w,x,v[11],16,1839030562);x=l(x,y,z,w,v[14],23,-35309556);w=l(w,x,y,z,v[1],4,-1530992060);z=l(z,w,x,y,v[4],11,1272893353);y=l(y,z,w,x,v[7],16,-155497632);x=l(x,y,z,w,v[10],23,-1094730640);w=l(w,x,y,z,v[13],4,681279174);z=l(z,w,x,y,v[0],11,-358537222);y=l(y,z,w,x,v[3],16,-722521979);x=l(x,y,z,w,v[6],23,76029189);w=l(w,x,y,z,v[9],4,-640364487);z=l(z,w,x,y,v[12],11,-421815835);y=l(y,z,w,x,v[15],16,530742520);x=l(x,y,z,w,v[2],23,-995338651);w=m(w,x,y,z,v[0],6,-198630844);z=m(z,w,x,y,v[7],10,1126891415);y=m(y,z,w,x,v[14],15,-1416354905);x=m(x,y,z,w,v[5],21,-57434055);w=m(w,x,y,z,v[12],6,1700485571);z=m(z,w,x,y,v[3],10,-1894986606);y=m(y,z,w,x,v[10],15,-1051523);x=m(x,y,z,w,v[1],21,-2054922799);w=m(w,x,y,z,v[8],6,1873313359);z=m(z,w,x,y,v[15],10,-30611744);y=m(y,z,w,x,v[6],15,-1560198380);x=m(x,y,z,w,v[13],21,1309151649);w=m(w,x,y,z,v[4],6,-145523070);z=m(z,w,x,y,v[11],10,-1120210379);y=m(y,z,w,x,v[2],15,718787259);x=m(x,y,z,w,v[9],21,-343485551);u[0]=s(w,u[0]);u[1]=s(x,u[1]);u[2]=s(y,u[2]);u[3]=s(z,u[3]);}function i(u,v,w,x,y,z){v=s(s(v,u),s(x,z));return s((v<<y)|(v>>>(32-y)),w);}function j(u,v,w,x,y,z,aa){return i((v&w)|((~v)&x),u,v,y,z,aa);}function k(u,v,w,x,y,z,aa){return i((v&x)|(w&(~x)),u,v,y,z,aa);}function l(u,v,w,x,y,z,aa){return i(v^w^x,u,v,y,z,aa);}function m(u,v,w,x,y,z,aa){return i(w^(v|(~x)),u,v,y,z,aa);}function n(u){var v=u.length,w=[1732584193,-271733879,-1732584194,271733878],x;for(x=64;x<=u.length;x+=64)h(w,o(u.substring(x-64,x)));u=u.substring(x-64);var y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(x=0;x<u.length;x++)y[x>>2]|=u.charCodeAt(x)<<((x&3)<<3);y[x>>2]|=128<<((x&3)<<3);if(x>55){h(w,y);for(x=0;x<16;x++)y[x]=0;}y[14]=v*8;h(w,y);return w;}function o(u){var v=[],w=0;while(w<64)v[w>>2]=u.charCodeAt(w++)|(u.charCodeAt(w++)<<8)|(u.charCodeAt(w++)<<16)|(u.charCodeAt(w++)<<24);return v;}var p='0123456789abcdef'.split('');function q(u){var v='',w=0;for(;w<4;w++)v+=p[(u>>((w<<3)+4))&15]+p[(u>>(w<<3))&15];return v;}function r(u){for(var v=0;v<u.length;v++)u[v]=q(u[v]);return u.join('');}var s=function(u,v){return (u+v)&4294967295;};function t(u){if(null===u||(void 0)===u){return null;}else{for(var v=0;v<u.length;v++)if(u[v]>"\u007F"){u=g(u);break;}return r(n(u));}}if(t('hello')!='5d41402abc4b2a76b9719d911017c592')s=function(u,v){var w=(u&65535)+(v&65535),x=(u>>16)+(v>>16)+(w>>16);return (x<<16)|(w&65535);};e.exports=t;},null);
__d("PlatformDialogClient",["Arbiter","AsyncDialog","AsyncRequest","DOMEventListener","guid","PlatformBaseVersioning","PlatformDialog","PopupWindow","QueryString","URI","UserAgent_DEPRECATED"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=575,s='FB_DIALOG_RESPONSE';h.getLoadingDialog().setWidth(r);j.add(window,'message',function(event){if((/\.facebook\.com$/).test(event.origin)&&new RegExp('^'+s+':').test(event.data))g.inform(m.RESPONSE,JSON.parse(event.data.substr(s.length+1)));});var t={};g.subscribe(m.RESPONSE,function(event,w){var x=w.state;if(t[x]){t[x].callback(w);w.state=t[x].state;delete t[x];}},g.SUBSCRIBE_NEW);function u(w){return function(){g.inform(m.RESPONSE,Object.assign({state:w},v.REQUEST_ABORTED_ERROR));};}var v={REQUEST_ABORTED_ERROR:{error_code:-200,error_message:'Request aborted.'},async:function(w,x,y){var z=k(),aa=x.state;x.state=z;x.redirect_uri=new p('/dialog/return/arbiter').setSubdomain('www').setFragment(o.encode({origin:x.redirect_uri})).getQualifiedURI().toString();x.display='async';t[z]={callback:y||function(){},state:aa};h.send(new i(this.getURI(w,x)).setMethod('GET').setReadOnly(true).setAbortHandler(u(z)));},popup:function(w,x,y,z,aa){var ba=k(),ca=y.state;y.state=ba;y.client_id=y.app_id=x;y.redirect_uri=new p('/dialog/return/arbiter').setSecure(p.getRequestURI().isSecure()).setSubdomain('www').setFragment(o.encode({origin:y.redirect_uri})).addQueryData(z||{}).addQueryData({relation:'opener',close:true}).toString();y.display=q.mobile()?'touch':'popup';t[ba]={callback:aa||function(){},state:ca};var da=p.getRequestURI(),ea=da.getDomain(),fa=ea.replace('developers','www');n.open(new p(this.getURI(w,y)).setDomain(fa).setProtocol('https').toString(),210,r);},getURI:function(w,x){if(x.version){var y=p('/'+x.version+'/dialog/'+w);delete x.version;return y.addQueryData(x);}return l.versionAwareURI(p('/dialog/'+w).addQueryData(x));}};e.exports=v;},null);
__d("WebMessengerEvents",["Arbiter","copyProperties"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=h(new g(),{MASTER_DOM_CHANGED:'master-dom-changed',DETAIL_DOM_CHANGED:'detail-dom-changed',FOCUS_COMPOSER:'focus-composer',FOCUS_SEARCH:'focus-search',FOCUS_AND_SELECT_SEARCH:'focus-and-select-search',STICKER_CLICKED:'sticker-clicked',SUBMIT_REPLY:'submit-reply',UPDATE_SELECTION:'update-selection',masterDOMChanged:function(){this.inform(i.MASTER_DOM_CHANGED);},detailDOMChanged:function(){this.inform(i.DETAIL_DOM_CHANGED);},focusComposer:function(){this.inform(i.FOCUS_COMPOSER);},focusSearch:function(){this.inform(i.FOCUS_SEARCH);},focusAndSelectSearch:function(){this.inform(i.FOCUS_AND_SELECT_SEARCH);},updateSelection:function(j){this.inform(i.UPDATE_SELECTION,j);},stickerClicked:function(j,k){this.inform(i.STICKER_CLICKED,{packID:j,stickerID:k});},submitReply:function(){this.inform(i.SUBMIT_REPLY);}});e.exports=i;},null);
__d("WebMessengerSubscriptionsHandler",["SubscriptionsHandler"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=new g('webmessenger');e.exports=h;},null);
__d("isWebMessengerURI",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){return (/^(\/messages)/).test(h.getPath());}e.exports=g;},null);
__d("WebMessengerWidthControl",["Arbiter","CSS","CSSClassTransition","DOM","DOMDimensions","Event","Style","URI","ViewportBounds","WebMessengerEvents","WebMessengerSubscriptionsHandler","$","cx","csx","isWebMessengerURI","requestAnimationFrame","setTimeoutAcrossTransitions","shield","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();var z=205,aa=981,ba=257,ca=18,da=848,ea=724,fa=.57,ga=56,ha,ia,ja;function ka(pa,qa,ra){this.masterChanged=pa;this.detailChaned=qa;q.addSubscriptions(l.listen(window,'resize',y(x(la,this,this),100)),g.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide','minisidebar/show'],x(la,this,this),g.SUBSCRIBE_NEW));var sa=oa()?ga:0;if(ra)sa=z;this._width=oa()?0:da;ja=true;la(this,sa);}function la(pa,qa){var ra=o.getRight()+o.getLeft();ra=ra||qa||0;var sa=k.getViewportWithoutScrollbarDimensions().width-ra,ta=Math.round(Math.max(0,sa/2-aa/2));sa=aa+ta-ba;sa-=ca;sa=Math.max(ea,Math.min(da,sa));if(!isNaN(sa)&&pa._width!==sa){pa._width=sa;var ua=Math.round(sa/(1+fa)),va=sa-ua;pa.masterChanged(va);pa.detailChaned(ua);if(oa()){var wa=sa+ba;ma(function(){if(ia){document.body.className=ia;ia='';}na(wa+'px');h.removeClass(document.body,"_5uj5");ja&&p.detailDOMChanged();ja=false;},ia);}}}function ma(pa,qa){qa&&h.addClass(document.documentElement,"_5uj6");v(pa);qa&&w(h.removeClass.bind(null,document.documentElement,"_5uj6"),1000);}function na(pa){m.set(j.find(document,"div._uaw"),'width',pa);m.set(r('globalContainer'),'width',pa);}function oa(){if(!ha)ha=h.hasClass(document.body,"_6nw");return ha;}i.registerHandler(function(pa,qa,ra,sa){function ta(ua){return oa()&&u(n(ua));}if(ta(sa)){ia=qa;return true;}else if(ta(ra)){ma(function(){pa.className=qa;na('');},true);return true;}});e.exports=ka;},null);
__d("Dock",["Event","shield","Arbiter","ArbiterMixin","ChatQuietLinks","CSS","DataStore","DOM","Parent","Scroll","Style","Toggler","Vector","copyProperties","csx","emptyFunction","WebMessengerWidthControl"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();b('WebMessengerWidthControl');function w(){}t(w,j,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(x){this.init=v;this.rootEl=x;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();k.removeEmptyHrefs(this.rootEl);g.listen(x,'click',this._onClick.bind(this));g.listen(window,'resize',this._onWindowResize.bind(this));r.subscribe(['show','hide'],function(y,z){var aa=z.getActive();if(!n.contains(x,aa))return;if(l.hasClass(aa,'fbNub')){this.notifyNub(aa,y);if(y==='show')this._resizeNubFlyout(aa);}else{var ba=o.byClass(aa,'fbNubFlyout');if(ba)l.conditionClass(ba,'menuOpened',y==='show');}}.bind(this));this.inform('init',{},i.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=s.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+s.getElementDimensions(this.rootEl).y;var x=n.scry(document,"div._4f7n")[0];if(x){var y=q.isFixed(x)?'viewport':'document';this.flyoutHeightOffset+=s.getElementPosition(x,y).y+s.getElementDimensions(x).y;}},toggle:function(x){var y=this._findFlyout(x);if(!y)return;this.subscribe('init',function(){r.toggle(x);});},show:function(x){this.subscribe('init',function(){r.show(x);});},showNub:function(x){l.show(x);},hide:function(x){this.subscribe('init',function(){var y=r.getInstance(x);n.contains(x,y.getActive())&&y.hide();});},hideNub:function(x){l.hide(x);this.hide(x);},setUseMaxHeight:function(x,y){l.conditionClass(x,'maxHeight',y!==false);this._resizeNubFlyout(x);},_resizeNubFlyout:function(x){var y=this._findFlyout(x);if(!y||!(l.hasClass(x,'openToggler')||l.hasClass(x,'opened')))return;var z=n.find(y,'div.fbNubFlyoutOuter'),aa=n.find(z,'div.fbNubFlyoutInner'),ba=n.find(aa,'div.fbNubFlyoutBody'),ca=p.getTop(ba),da=ba.offsetHeight;q.set(ba,'height','auto');var ea=s.getElementDimensions(y),fa=s.getElementDimensions(ba),ga=this.getMaxFlyoutHeight(x);q.set(y,'max-height',ga+'px');q.set(z,'max-height',ga+'px');ea=s.getElementDimensions(y);var ha=s.getElementDimensions(aa),ia=ha.y-fa.y,ja=ea.y-ia,ka=parseInt(ba.style.height||ba.clientHeight,10),la=ja!==ka;if(ea.y>ia&&la)q.set(ba,'height',ja+'px');l.removeClass(y,'swapDirection');var ma=s.getElementPosition(y).x;l.conditionClass(y,'swapDirection',function(){if(ma<0)return true;return (ma+ea.x>this.viewportDimensions.x);}.bind(this)());if(la&&ca+da>=fa.y){p.setTop(ba,ba.scrollHeight);}else p.setTop(ba,ca);this.notifyNub(x,'resize');},getMaxFlyoutHeight:function(x){var y=this._findFlyout(x),z=s.getElementPosition(y,'viewport'),aa=s.getElementDimensions(y),ba=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-z.y-aa.y);return Math.max(ba,0);},resizeAllFlyouts:function(){var x=this._getAllNubs(),y=x.length;while(y--)this._resizeNubFlyout(x[y]);},hideAllFlyouts:function(){var x=this._getAllNubs(),y=x.length;while(y--)this.hide(x[y]);},_getAllNubs:function(){var x=n.scry(this.rootEl,"div._50-v.openToggler");return x.concat(n.scry(this.rootEl,"div._50-v.opened"));},_onClick:function(event){var x=event.getTarget(),y=o.byClass(x,'fbNub');if(y){if(o.byClass(x,'fbNubFlyoutTitlebar')){var z=o.byTag(x,'a'),aa=x.nodeName=='INPUT'&&x.getAttribute('type')=='submit';if(!z&&!aa){this.hide(y);return false;}}this.notifyNub(y,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(x){return l.hasClass(x,'fbNubFlyout')?x:n.scry(x,'div.fbNubFlyout')[0]||null;},registerNubController:function(x,y){m.set(x,'dock:nub:controller',y);y.subscribe('nub/button/content-changed',h(this.inform,this,'resize',x));y.subscribe('nub/flyout/content-changed',h(this._resizeNubFlyout,this,x));},unregisterNubController:function(x){m.remove(x,'dock:nub:controller');},notifyNub:function(x,y,z){var aa=m.get(x,'dock:nub:controller');aa&&aa.inform(y,z);}});e.exports=a.Dock||w;},null);
__d("whitelistObjectKeys",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i){var j={},k=Array.isArray(i)?i:Object.keys(i);for(var l=0;l<k.length;l++)if(typeof h[k[l]]!=='undefined')j[k[l]]=h[k[l]];return j;}e.exports=g;},null);
__d("StoreAndPropBasedStateMixin",["StoreBasedStateMixinHelper","invariant","setImmediate"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=function(){for(var k=[],l=0,m=arguments.length;l<m;l++)k.push(arguments[l]);return {getInitialState:function(){return this.constructor.calculateState(this.props);},componentWillMount:function(){h(this.constructor.calculateState);this._recalculateStateID=null;var n=function(){if(this.isMounted())this.setState(this.constructor.calculateState(this.props));this._recalculateStateID=null;}.bind(this);this._mixin=new g(k);this._mixin.subscribeCallback(function(){if(this._recalculateStateID===null)this._recalculateStateID=i(n);}.bind(this));},componentWillReceiveProps:function(n){this.setState(this.constructor.calculateState(n));},componentWillUnmount:function(){this._mixin.release();this._mixin=null;}};}.bind(this);e.exports=j;},null);
__d("getNormalizedClientRect",["getDocumentScrollElement"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';function h(i){var j=i.getBoundingClientRect(),k=0,l=0,m=g(i.ownerDocument),n=m.getBoundingClientRect();if(n.left>0){k=-n.left;}else{var o=m.scrollWidth+n.left,p=n.width;if(p>o)k=p-o;}if(n.top>0)l=-n.top;return {bottom:j.bottom+l,height:j.height,left:j.left+k,right:j.right+k,top:j.top+l,width:j.width};}e.exports=h;},null);
__d("URLMatcher",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',h='\u2000-\u206F\u00ab\u00bb\uff08\uff09',i='(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])',j='(?:(?:ht|f)tps?)://',k='(?:(?:'+i+'[.]){3}'+i+')',l='\\[(?:(?:[A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})\\]',m='(?:\\b)www\\d{0,3}[.]',n='[^\\s'+g+h+']',o='(?:(?:(?:[.:\\-_%@]|'+n+')*'+n+')|'+l+')',p='(?:[.][a-z]{2,4})',q='(?::\\d+){0,1}',r='(?=[/?#])',s='(?:'+'(?:'+j+o+q+')|'+'(?:'+k+q+')|'+'(?:'+l+q+')|'+'(?:'+m+o+p+q+')|'+'(?:'+o+p+q+r+')'+')',t='[/#?]',u='\\([^\\s()<>]+\\)',v='[^\\s()<>?#]+',w=new RegExp(s,'im'),x='^\\[[0-9]{1,4}:[0-9]{1,4}:[A-Fa-f0-9]{1,4}\\]',y=new RegExp(x,'im'),z='(?:'+'(?:'+t+')'+'(?:'+'(?:'+u+'|'+v+')*'+')*'+')*',aa=new RegExp('('+'(?:'+s+')'+'(?:'+z+')'+')','im'),ba=new RegExp('('+'(?:'+j+o+q+')|'+'(?:'+m+o+p+q+')'+')'),ca=/[\s'";]/,da=new RegExp(t,'im'),ea=new RegExp('[\\s!"#%&\'()*,./:;<>?@[\\]^`{|}\u00ab\u00bb\u2000-\u206F\uff08\uff09]','im'),fa=new RegExp('[\\s()<>?#]','im'),ga=new RegExp('\\s()<>'),ha=function(oa){if(oa&&oa.indexOf('@')!=-1){return (ba.exec(oa))?oa:null;}else return oa;},ia=function(oa){return ja(oa,aa);},ja=function(oa,pa){var qa=(pa.exec(oa)||[])[1]||null;return ha(qa);},ka=function(oa){return w.exec(oa);},la=function(oa){return !ca.test(oa.charAt(oa.length-1));},ma=function(oa){do{var pa=w.exec(oa);if(!pa)return null;var qa=false;if(pa[0][0]==='['&&pa.index>0&&oa[pa.index-1]==='@'){var ra=y.exec(pa[0]);if(ra){qa=true;oa=oa.substr(pa.index+ra[0].length);}}}while(qa);var sa=oa.substr(pa.index+pa[0].length);if(sa.length===0||!(da.test(sa[0])))return ha(pa[0]);var ta=0,ua=0,va=1,wa=0,xa=ua;for(var ya=1;ya<sa.length;ya++){var za=sa[ya];if(xa===ua){if(za==='('){wa=wa+1;xa=va;}else if(da.test(za)||!(ea.test(za))){ta=ya;}else if(fa.test(za))break;}else if(za==='('){wa=wa+1;}else if(za===')'){wa=wa-1;if(wa===0){xa=ua;ta=ya;}}else if(ga.test(za))break;}return ha(pa[0]+sa.substring(0,ta+1));},na={};na.permissiveMatch=ia;na.matchToPattern=ja;na.matchHost=ka;na.trigger=la;na.match=ma;e.exports=na;},null);
__d("Emscripten",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={isSupported:function(){return (typeof Int32Array!=='undefined'&&typeof Float64Array!=='undefined'&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set);}};},null);
__d("XHRHttpError",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g='HTTP_CLIENT_ERROR',h='HTTP_PROXY_ERROR',i='HTTP_SERVER_ERROR',j='HTTP_TRANSPORT_ERROR',k='HTTP_UNKNOWN_ERROR';function l(m,n){if(n===0){var o=m.getProtocol();if(o==='file'||o==='ftp')return null;return j;}else if(n>=100&&n<200){return h;}else if(n>=200&&n<300){return null;}else if(n>=400&&n<500){return g;}else if(n>=500&&n<600){return i;}else if(n>=12001&&n<12156){return j;}else return k;}e.exports={getErrorCode:l,HTTP_CLIENT_ERROR:g,HTTP_PROXY_ERROR:h,HTTP_SERVER_ERROR:i,HTTP_TRANSPORT_ERROR:j,HTTP_UNKNOWN_ERROR:k};},null);
__d("xhrSimpleDataSerializer",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){var i=[],j;for(j in h)i.push(encodeURIComponent(j)+'='+encodeURIComponent(h[j]));return i.join('&');}e.exports=g;},null);
__d("XHRRequest",["ErrorUtils","TimeSlice","URI","XHRHttpError","getSameOriginTransport","invariant","xhrSimpleDataSerializer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n={errorCode:null,errorMsg:null,errorType:null},o={loadedBytes:null,totalBytes:null};function p(q){"use strict";this.setURI(q);this.setMethod('POST');this.setTransportBuilder(k);this.setDataSerializer(m);this.$XHRRequest0=this.$XHRRequest0.bind(this);}p.prototype.setURI=function(q){"use strict";this.$XHRRequest1=new i(q);return this;};p.prototype.getURI=function(){"use strict";return this.$XHRRequest1;};p.prototype.setMethod=function(q){"use strict";this.$XHRRequest2=q;return this;};p.prototype.getMethod=function(){"use strict";return this.$XHRRequest2;};p.prototype.setData=function(q){"use strict";this.$XHRRequest3=q;return this;};p.prototype.getData=function(){"use strict";return this.$XHRRequest3;};p.prototype.setRawData=function(q){"use strict";this.$XHRRequest4=q;return this;};p.prototype.setRequestHeader=function(q,r){"use strict";if(!this.$XHRRequest5)this.$XHRRequest5={};this.$XHRRequest5[q]=r;return this;};p.prototype.setTimeout=function(q){"use strict";this.$XHRRequest6=q;return this;};p.prototype.setResponseHandler=function(q){"use strict";this.$XHRRequest7=q;return this;};p.prototype.setErrorHandler=function(q){"use strict";this.$XHRRequest8=q;return this;};p.prototype.setAbortHandler=function(q){"use strict";this.$XHRRequest9=q;return this;};p.prototype.setTimeoutHandler=function(q){"use strict";this.$XHRRequesta=q;return this;};p.prototype.setUploadProgressHandler=function(q){"use strict";this.$XHRRequestb=q;return this;};p.prototype.setTransportBuilder=function(q){"use strict";this.$XHRRequestc=q;return this;};p.prototype.setDataSerializer=function(q){"use strict";this.$XHRRequestd=q;return this;};p.prototype.send=function(){"use strict";var q=this.$XHRRequest6,r=this.$XHRRequestc(),s=this.getURI();this.$XHRRequeste=r;var t;l(this.$XHRRequest2==='POST'||!this.$XHRRequest4);if(this.$XHRRequest2==='GET'||this.$XHRRequest4){s.addQueryData(this.$XHRRequest3);t=this.$XHRRequest4;}else t=this.$XHRRequestd(this.$XHRRequest3);r.onreadystatechange=h.guard(this.$XHRRequest0,'XHRRequest onreadystatechange');if(r.upload&&this.$XHRRequestb)r.upload.onprogress=this.$XHRRequestf.bind(this);if(q)this.$XHRRequestg=setTimeout(this.$XHRRequesth.bind(this),q);r.open(this.$XHRRequest2,s.toString(),true);if(this.$XHRRequest5)for(var u in this.$XHRRequest5)r.setRequestHeader(u,this.$XHRRequest5[u]);r.send(t);};p.prototype.abort=function(){"use strict";this.$XHRRequesti();if(this.$XHRRequest9)g.applyWithGuard(this.$XHRRequest9,null,null,null,'XHRRequest:_abortHandler');};p.prototype.$XHRRequesti=function(){"use strict";var q=this.$XHRRequeste;if(q){q.onreadystatechange=null;q.abort();}this.$XHRRequestj();};p.prototype.$XHRRequesth=function(){"use strict";this.$XHRRequesti();if(this.$XHRRequesta)g.applyWithGuard(this.$XHRRequesta,null,null,null,'XHRRequest:_abortHandler');};p.prototype.$XHRRequest0=function(){"use strict";var q=this.$XHRRequeste,r=q,s=r.readyState;if(s>=2){var t=s===4,u=this.getURI(),v=j.getErrorCode(u,q.status),w=this.$XHRRequest7;if(v!==null){if(t){n.errorCode=v;n.errorMsg=q.responseText;n.errorType='HTTP';if(this.$XHRRequest8)g.applyWithGuard(this.$XHRRequest8,null,[n],null,'XHRRequest:_errorHandler');}}else if(w){var x=null;if(w.includeHeaders)x=q.getAllResponseHeaders();if(t||(w.parseStreaming&&s===3))g.applyWithGuard(w,null,[q.responseText,x,t],null,'XHRRequest:handler');}if(t)this.$XHRRequestj();}};p.prototype.$XHRRequestf=function(q){"use strict";o.loadedBytes=q.loaded;o.totalBytes=q.total;if(this.$XHRRequestb)g.applyWithGuard(this.$XHRRequestb,null,[o],null,'XHRRequest:_uploadProgressHandler');};p.prototype.$XHRRequestj=function(){"use strict";clearTimeout(this.$XHRRequestg);delete this.$XHRRequeste;};e.exports=p;},null);
__d("getCrossOriginTransport",["ex","invariant"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(){try{var k=new XMLHttpRequest();if(!('withCredentials' in k)&&typeof XDomainRequest!=='undefined')k=new XDomainRequest();return k;}catch(j){throw new Error(g('getCrossOriginTransport: %s',j.message));}}i.withCredentials=function(){var j=i();h('withCredentials' in j);var k=j.open;j.open=function(){k.apply(this,arguments);this.withCredentials=true;};return j;};e.exports=i;},null);
__d("WebWorker",["BanzaiLogger","WebWorkerConfig","BlobFactory","EventListener","URI","areSameOrigin","destroyOnUnload","SubscriptionsHandler","XHRRequest","arrayContains","emptyFunction","getCrossOriginTransport","performanceNow","invariant","memoize","merge","filterObject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();var x=a.URL||a.webkitURL;function y(ea){"use strict";this.$WebWorker0=false;this.$WebWorker1=null;this.$WebWorker2=ea;this.$WebWorker3=null;this.$WebWorker4=q;this.$WebWorker5=q;this.$WebWorker6=[];this.$WebWorker7=false;this.$WebWorker8=new n();m(function(){if(!this.$WebWorker7)this.terminate();}.bind(this));this.$WebWorker9('constructed');}y.prototype.setMessageHandler=function(ea){"use strict";this.$WebWorker4=ea||q;return this;};y.prototype.setErrorHandler=function(ea){"use strict";this.$WebWorker5=ea||q;return this;};y.prototype.postMessage=function(ea,fa){"use strict";t(!this.isCurrentState('constructed'));t(!this.isCurrentState('terminated'));if(this.isCurrentState('preparing')){this.$WebWorker6.push(this.postMessage.bind(this,ea,fa));return this;}var ga={type:'message',message:ea};if(fa){this.$WebWorker3.postMessage(ga,fa);}else this.$WebWorker3.postMessage(ga);return this;};y.prototype.terminate=function(){"use strict";if(this.isCurrentState('executing'))this.$WebWorker3.terminate();if(!this.isCurrentState('terminated')){this.$WebWorker9('terminated');this.$WebWorker3=null;this.$WebWorkera();this.$WebWorker6=[];}return this;};y.prototype.execute=function(){"use strict";t(!this.isCurrentState('terminated'));if(['preparing','executing'].some(this.isCurrentState,this))return this;this.$WebWorker9('preparing');y.prepareResource(this.$WebWorker2,this.$WebWorkerb.bind(this));return this;};y.prototype.setAllowCrossPageTransition=function(ea){"use strict";this.$WebWorker7=ea;return this;};y.prototype.isCurrentState=function(ea){"use strict";t(p(y.states,ea));return ea===this.$WebWorker1;};y.prototype.$WebWorkerb=function(){"use strict";t(!this.isCurrentState('executing'));if(this.isCurrentState('terminated'))return;t(this.$WebWorker2.sameOriginURL||this.$WebWorker2.source);if(this.$WebWorker2.sameOriginURL){this.$WebWorker3=new a.Worker(this.$WebWorker2.sameOriginURL);}else{this.$WebWorker3=new a.Worker(y.evalWorkerURL);this.$WebWorker3.postMessage(this.$WebWorker2.source);}this.$WebWorkerc('ping',Date.now());if(this.$WebWorker2.dynamicModules)this.$WebWorkerc('defineModules',this.$WebWorker2.dynamicModules);this.$WebWorkerd();this.$WebWorker9('executing');this.$WebWorker6.forEach(function(ea){return ea();});this.$WebWorker6=null;};y.prototype.$WebWorkera=function(){"use strict";this.$WebWorker8.release();};y.prototype.$WebWorkerc=function(ea){"use strict";for(var fa=[],ga=1,ha=arguments.length;ga<ha;ga++)fa.push(arguments[ga]);this.$WebWorker3.postMessage({type:ea,args:fa});};y.prototype.$WebWorkere=function(event,ea){"use strict";y.$WebWorkere(event,this.$WebWorker2.name,v(ea,{cross_page_transition:!!this.$WebWorker7,state:this.$WebWorker1}));};y.$WebWorkerf=function(){"use strict";return Object.keys(w({object_url:y.$WebWorkerg(),eval_url:ca(),data_url:y.$WebWorkerh(),worker:y.isSupported(),transferables:y.areTransferablesSupported()},function(ea){return !!ea;}));};y.prototype.$WebWorkerd=function(){"use strict";this.$WebWorker8.addSubscriptions(j.listen(this.$WebWorker3,'message',this.$WebWorkeri.bind(this)),j.listen(this.$WebWorker3,'error',this.$WebWorkerj.bind(this)));};y.prototype.$WebWorkerj=function(ea){"use strict";var fa=this.$WebWorker5(ea);if(!fa&&!ea.defaultPrevented)this.$WebWorkere('exception',{message:ea.message});};y.prototype.$WebWorkeri=function(event){"use strict";var ea=event.data;switch(ea.type){case 'message':this.$WebWorker4(ea.message);break;case 'pong':this.$WebWorker0=true;this.$WebWorkere('executed',{dt:Math.floor(ea.args[1]-ea.args[0]),bytes:this.$WebWorker2.source.length});break;case 'terminate':this.terminate();break;case 'haste-error':this.terminate();this.$WebWorkere('haste_error',{message:ea.message});break;case 'console':var fa=ea.args.shift();t(p(['log','error','info','debug','warn'],fa));a.console[fa].apply(a.console,ea.args);break;}};y.prototype.$WebWorker9=function(ea){"use strict";t(p(y.states,ea));this.$WebWorkere('transition',{next_state:ea});this.$WebWorker1=ea;};y.prepareResource=function(ea,fa){"use strict";fa=fa||q;t(ea.sameOriginURL||ea.url||ea.source);t(!!y.isSupported());if(ea.sameOriginURL){fa();}else if(ea.url&&l(new k(ea.url),new k(a.location.href))){ea.sameOriginURL=ea.url;fa();}else if(ea.source){if(y.$WebWorkerk())ea.sameOriginURL=y.$WebWorkerl(ea.source);fa();}else if(!ea.loading){var ga=s();ea.loading=[fa];y.$WebWorkerm(ea.url,function(ha){if(ha){ea.source=ha;if(y.$WebWorkerk())ea.sameOriginURL=y.$WebWorkerl(ha);}y.$WebWorkere('prepared',ea.name,{dt:Math.floor(s()-ga),bytes:ha.length});ea.loading.forEach(function(ia){return ia();});ea.loading=false;});}else ea.loading.push(fa);return ea;};y.releaseResource=function(ea){"use strict";if(ea.sameOriginURL.indexOf('blob:')===0){if(x.revokeObjectURL)x.revokeObjectURL(ea.sameOriginURL);ea.sameOriginURL=null;}return ea;};y.isSupported=function(){"use strict";return ba&&(y.$WebWorkerk()||ca());};y.areTransferablesSupported=function(){"use strict";return y.isSupported()&&da();};y.$WebWorkerm=function(ea,fa){"use strict";new o(ea).setTransportBuilder(r).setMethod('GET').setResponseHandler(function(ga){fa(ga);}).setErrorHandler(fa.bind(null,null)).send();};y.$WebWorkerl=function(ea){"use strict";t(y.$WebWorkerk());if(y.$WebWorkerg()){var fa=i.getBlob([ea],{type:'application/javascript'});return x.createObjectURL(fa);}if(y.$WebWorkerh())return 'data:application/javascript,'+encodeURIComponent(ea);};y.$WebWorkerg=function(){"use strict";return i.isSupported()&&z();};y.$WebWorkerh=function(){"use strict";return aa();};y.$WebWorkerk=function(){"use strict";return y.$WebWorkerg()||y.$WebWorkerh();};y.$WebWorkere=function(event,ea,fa){"use strict";if(!h.logging.enabled)return;g.log(h.logging.config,v(fa,{features_array:y.$WebWorkerf(),event:event,resource:ea}));};var z=u(function(){var ea,fa;if(!x||!x.createObjectURL)return false;try{ea=x.createObjectURL(i.getBlob([''],{type:'application/javascript'}));var ha=new a.Worker(ea);ha.terminate();fa=true;}catch(ga){fa=false;}finally{if(x.revokeObjectURL)x.revokeObjectURL(ea);}return fa;}),aa=u(function(){var ea;try{var ga=new a.Worker('data:application/javascript,');ga.terminate();ea=true;}catch(fa){ea=false;}return ea;}),ba=!!a.Worker,ca=u(function(){var ea;try{var ga=new a.Worker(y.evalWorkerURL);ga.terminate();ea=true;}catch(fa){ea=false;}return ea;}),da=u(function(){var ea;try{var ga=new a.Worker(y.evalWorkerURL),ha=new ArrayBuffer(0);ga.postMessage({buffer:ha},[ha]);ga.terminate();ea=true;}catch(fa){ea=false;}return ea;});y.states=['constructed','preparing','executing','terminated'];y.evalWorkerURL=h.evalWorkerURL;e.exports=y;},null);
__d("PooledWebWorker",["WebWorker"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";g.call(this,m);this.$PooledWebWorker0=l;this.$PooledWebWorker1=k;}j.prototype.getIndex=function(){"use strict";return this.$PooledWebWorker0;};j.prototype.getPool=function(){"use strict";return this.$PooledWebWorker1;};e.exports=j;},null);
__d("WebWorkerPool",["PooledWebWorker","emptyFunction"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();i.isSupported=function(){"use strict";return g.isSupported();};function i(j,k){"use strict";this.$WebWorkerPool0=[];for(var l=0;l<k;l++)this.$WebWorkerPool0.push(new g(this,l,j).setErrorHandler(this.$WebWorkerPool1).setMessageHandler(this.$WebWorkerPool2).execute());this.$WebWorkerPool3=0;}i.prototype.setMessageHandler=function(j){"use strict";this.$WebWorkerPool4=j||h;return this;};i.prototype.setAllowCrossPageTransition=function(j){"use strict";this.$WebWorkerPool0.forEach(function(k){return k.setAllowCrossPageTransition(j);});return this;};i.prototype.setErrorHandler=function(j){"use strict";this.$WebWorkerPool5=j||h;return this;};i.prototype.postMessage=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);var m=this.getWorker();m.postMessage.apply(m,j);return m;};i.prototype.$WebWorkerPool2=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);j.unshift(this);this.getPool().$WebWorkerPool4.apply(this.getPool(),j);};i.prototype.$WebWorkerPool1=function(){"use strict";for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);j.unshift(this);return this.getPool().$WebWorkerPool5.apply(this.getPool(),j);};i.prototype.getWorker=function(){"use strict";var j=this.$WebWorkerPool0[this.$WebWorkerPool3];this.$WebWorkerPool3=(this.$WebWorkerPool3+1)%this.$WebWorkerPool0.length;return j;};e.exports=i;},null);
__d("JpegResizer",["Emscripten","JpegResizerConfig","JpegResizeWorkerResource","WebWorker","WebWorkerPool","PUWErrorCodes"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=null;n.isSupported=function(){"use strict";return k.isSupported()&&g.isSupported()&&!h.isGKBlacklisted;};n.getSingleton=function(){"use strict";if(!m)m=new n(n.DEFAULT_POOL_SIZE).setAllowCrossPageTransition(true);return m;};n.prepareResource=function(o){"use strict";j.prepareResource(i,o);};function n(o){"use strict";o=o||n.DEFAULT_POOL_SIZE;j.prepareResource(i);this.$JpegResizer0=(new k(i,o)).setErrorHandler(this.$JpegResizer1.bind(this)).setMessageHandler(this.$JpegResizer2.bind(this));this.$JpegResizer3={};this.$JpegResizer4=n.DEFAULT_RESIZE_HEIGHT;this.$JpegResizer5=n.DEFAULT_RESIZE_WIDTH;}n.prototype.setHighQuality=function(o){"use strict";if(o){this.$JpegResizer4=n.DEFAULT_RESIZE_HEIGHT;this.$JpegResizer5=n.DEFAULT_RESIZE_WIDTH;}else{this.$JpegResizer4=n.LOW_QUALITY_RESIZE_HEIGHT;this.$JpegResizer5=n.LOW_QUALITY_RESIZE_WIDTH;}return this;};n.prototype.setAllowCrossPageTransition=function(o){"use strict";this.$JpegResizer0.setAllowCrossPageTransition(o);return this;};n.prototype.resizeBlob=function(o,p,q){"use strict";var r=this.$JpegResizer0.getWorker();if(r.isCurrentState('terminated')){var s=new Error('Worker terminated');s.code=l.WORKER_TERMINATED;p(s);return this;}var t=r.postMessage({blob:o,height:this.$JpegResizer4,width:this.$JpegResizer5}).getIndex();this.$JpegResizer6(t).unshift({done:p,progress:q});return this;};n.prototype.$JpegResizer6=function(o){"use strict";if(!this.$JpegResizer3.hasOwnProperty(o))this.$JpegResizer3[o]=[];return this.$JpegResizer3[o];};n.prototype.$JpegResizer1=function(o,p){"use strict";o.terminate();var q=this.$JpegResizer6(o.getIndex());this.$JpegResizer7(p);q.forEach(function(r){return r.done(p);});q.length=0;};n.prototype.$JpegResizer2=function(o,p){"use strict";if(p.error)this.$JpegResizer7(p.error);if(p.done){this.$JpegResizer6(o.getIndex()).pop().done(p.error,p.blob,p.skipped);}else{var q=this.$JpegResizer6(o.getIndex()),r=q[q.length-1].progress;if(r)r({written:p.written,total:p.total});}};n.prototype.$JpegResizer7=function(o){"use strict";var p=o.message;if(p.indexOf('Not a JPEG file')!==-1){o.code=l.BAD_JPEG;}else if(p.indexOf('abort()')!==-1){o.code=l.WORKER_ABORT;}else o.code=l.UNKNOWN_RESIZE_ERROR;};n.DEFAULT_POOL_SIZE=3;n.DEFAULT_RESIZE_HEIGHT=2048;n.DEFAULT_RESIZE_WIDTH=2048;n.LOW_QUALITY_RESIZE_HEIGHT=960;n.LOW_QUALITY_RESIZE_WIDTH=960;e.exports=n;},null);
__d("PhotoStoreCore",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={actions:{UPDATE:'update'},_photoCache:{},_postCreateCallbacks:{},getPhotoCache:function(h){if(!this._photoCache[h])throw new Error('Photo cache requested for unknown set ID');return this._photoCache[h];},hasBeenCreated:function(h){return !!this._photoCache[h];},clearSetCache:function(h){delete this._photoCache[h];delete this._postCreateCallbacks[h];},getByIndex:function(h,i,j){this.getPhotoCache(h).getItemAtIndex(i,j);},getByIndexImmediate:function(h,i){if(this._photoCache[h])return this._photoCache[h].getItemAtIndexImmediate(i);return (void 0);},getItemsInAvailableRange:function(h){var i=this.getAvailableRange(h),j=[];for(var k=i.offset;k<i.length;k++)j.push(this.getByIndexImmediate(h,k));return j;},getItemsAfterIndex:function(h,i,j,k){var l=this.getCursorByIndexImmediate(h,i);this.fetchForward(h,l,j,k);},getAllByIDImmediate:function(h){var i=Object.keys(this._photoCache);return i.map(function(j){return this.getByIndexImmediate(j,this.getIndexForID(j,h));}.bind(this)).filter(function(j){return !!j;});},getIndexForID:function(h,i){if(this._photoCache[h])return this._photoCache[h].getIndexForID(i);return (void 0);},getEndIndex:function(h){var i=this.getAvailableRange(h);return i.offset+i.length-1;},getCursorByIndexImmediate:function(h,i){var j=this.getByIndexImmediate(h,i);if(j)return this._photoCache[h].getCursorForID(j.id);return (void 0);},hasNextPage:function(h){var i=this.getCursorByIndexImmediate(h,this.getEndIndex(h));return this.getPhotoCache(h).hasNextPage(i);},getAvailableRange:function(h){return this.getPhotoCache(h).getAvailableRange();},hasLooped:function(h){return this.getPhotoCache(h).hasLooped();},fetchForward:function(h,i,j,k){this.getPhotoCache(h).getItemsAfterCursor(i,j,k);},fetchBackward:function(h,i,j,k){this.getPhotoCache(h).getItemsBeforeCursor(i,j,k);},executePostCreate:function(h,i){if(this._photoCache[h]){i&&i();}else this._postCreateCallbacks[h]=i;},runPostCreateCallback:function(h){var i=this._postCreateCallbacks[h];if(i){i();delete this._postCreateCallbacks[h];}},setPreFetchCallback:function(h,i){this.getPhotoCache(h).setPreFetchCallback(i);},updateData:function(h){var i=h.set_id;if(!this._photoCache[i]){this._photoCache[i]=new h.cache_class(h);this.runPostCreateCallback(i);}else if(h.query_metadata.action==g.actions.UPDATE){this._photoCache[i].updateData(h);}else this._photoCache[i].addData(h);},updateFeedbackData:function(h){var i=Object.keys(h);i.forEach(function(j){return g.getAllByIDImmediate(j).forEach(function(k){k.feedback=h[j].feedback;});});},reset:function(){Object.keys(this._photoCache).forEach(function(h){return this.clearSetCache(h);}.bind(this));}};e.exports=g;},null);
__d("GiftCredits",["AsyncRequest","Dialog","URI"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={dialog:null,callback:null,purchaseLock:false,purchaseLockExpiryThreshold:5000,purchaseLockTimeoutId:null,getPurchaseCreditPrompt:function(k,l,m,n){j.main(k,null,null,null,m,null,null,null,'BuyCredits',{},n);},redeemGiftcard:function(k,l,m){var n=i(document.location).setPath('/giftcards').toString();j.main(k,null,null,n,null,null,null,null,l,{},m);},getPrompt:function(k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){j.main(k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha);},main:function(k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){if(j.isPurchaseLocked())return false;j.setPurchaseLock(true);var ia={_path:'pay',method:'pay',display:'async',app_id:k,receiver:l,api_key:q,credits_purchase:x,action:s,next:n,dev_purchase_params:JSON.stringify(t),additional_params:JSON.stringify(u),order_info:JSON.stringify(m),product:v,package_id:w,request_id:y,sdk:z,quantity:aa,quantity_min:ba,quantity_max:ca,test_currency:da,pricepoint_id:ea,user:fa,user_hash:ga,ingame_gift_data:ha},ja=new g().setURI('/fbml/ajax/dialog/').setData(ia).setMethod('GET').setReadOnly(true).setStatusElement('commerce_get_more_loading');j.callback=o;j.dialog=new h().setAsync(ja).setModal(true).setCloseHandler(function(ka){j.setPurchaseLock(false);o(ka);}).show();},isPurchaseLocked:function(){return j.purchaseLock;},setPurchaseLock:function(k){j.purchaseLock=k;if(k){j.purchaseLockTimeoutId=setTimeout(function(){j.setPurchaseLock(false);},j.purchaseLockExpiryThreshold);}else clearTimeout(j.purchaseLockTimeoutId);return true;}};e.exports=j;},null);
__d("legacy:giftcredits",["GiftCredits"],function(a,b,c,d){b.__markCompiled&&b.__markCompiled();a.GiftCredits=b('GiftCredits');},3);
__d("DropdownContextualHelpLink",["DOM","ge"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={set:function(j){var k=h('navHelpCenter');if(k!==null)g.replace(k,j);}};e.exports=i;},null);
__d("TickerReadStateTracking",["Style","clickRefAction"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=73,j='ticker_hover',k=[];function l(n){if(!n)return null;var o=JSON.parse(n.getAttribute('data-ft'));if(!o)return null;if(o.mf_story_key)return o.mf_story_key;if(o.fbid)return o.fbid;return null;}function m(n){var o=l(n);if(!o||o in k)return;k[o]=true;var p={evt:i};h(j,n,null,'FORCE',{ft:p});}e.exports.log=m;},null);
__d("TickerController",["Event","Animation","Arbiter","AsyncRequest","AsyncSignal","Bootloader","ChannelConstants","LegacyContextualDialog","CSS","DOM","HTML","JSLogger","Keys","LayerFadeOnHide","LiveTimer","NavigationMessage","Parent","Rect","Run","ScrollableArea","SelectorDeprecated","Style","TickerReadStateTracking","Toggler","UIPagelet","URI","UserActivity","UserAgent_DEPRECATED","Vector","DOMVector","BanzaiODS","$","clickRefAction","collectDataAttributes","containsNode","copyProperties","cx","csx","ex","emptyFunction","ge","getElementText","goURI","throttle","tickerPhoteSnowLiftOpenStatus"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya){b.__markCompiled&&b.__markCompiled();var za=1,ab=2,bb=3,cb=4,db=15000,eb=r.create('ticker_controller');function fb(gb,hb,ib){if(gb===(void 0))return;fb._instances[gb.id]=this;fb._activeInstance=this;this._root=gb;this._content=p.find(gb,'.ticker_stream');this._stories=p.find(this._root,'.tickerActivityStories');this._scrollableArea=hb;this._container=p.find(gb,'div.uiScrollableAreaWrap');this._newestStory={};this._storyIDs=[];this._objectIDs=[];this._fetchedStories={};this._fetchedStoriesDialog={};this._storyDialogResources={};this._removedStoryIDs=[];this._storiesToRemove=[];var jb=Date.now();this._initTime=jb;this._lastUpdate=jb;this._lastPull=jb;this._lastInsert=jb;this._lastCustomStory=0;this._pollOnly=false;this._needNonCustomStoryNum=0;this._doCustomUpdate=true;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=p.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!w.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();ma('ticker_flyout');ma('ticker_flyout_prefetch');ma('ticker_flyout_loadtime');ma('ticker_stream');this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var kb=p.create('div',{className:'storyQueue hidden_elem'});this._storyQueue=kb;p.appendContent(this._root,kb);this._lastKStories={head:null,tail:null,count:0,actors:{},apps:{},stories:{}};this._dedupeKeys={};this._initObjectIDs();this._initConfig(ib);this._resetMorePager();this._initListeners();this._initSubscriptions(ib);i.inform('ticker/init',this,i.BEHAVIOR_PERSISTENT);this._poll();}pa(fb,{_instances:{},_activeInstance:null,_placeholders:{},getInstance:function(gb){var hb=w.byClass(la(gb),'fbFeedTicker');return hb?fb._instances[hb.id]:null;},isLoaded:function(gb){var hb=fb._placeholders[gb.id];return !hb||hb.status==bb;},show:function(gb,hb){hb=hb||ta;for(var ib in fb._instances){var jb=ua(ib);if(!jb||jb.parentNode.id==gb.id)continue;fb.hide(jb.parentNode);}fb._doPositionChange(gb);o.show(gb);var kb=fb._placeholders[gb.id];if(kb&&kb.status==za){var lb=(ia.getElementDimensions(gb).y||0)>0,mb=gb.id==='pagelet_rhc_ticker'&&!o.hasClass(gb,'hidden_rhc_ticker');if(lb||mb){fb._fetchTickerForPlaceholder(gb,hb);}else i.subscribe('Ticker/resized',function(){if(kb.status==za)fb._fetchTickerForPlaceholder(gb,hb);});}else{var nb=p.scry(gb,'.fbFeedTicker')[0],ob=nb&&fb.getInstance(nb);fb._activeInstance=ob;ob&&ob._poll();fb._placeholders[gb.id]={status:cb,callback:hb};hb();}i.inform('ticker/show',{node:gb,callback:hb});},_doPositionChange:function(gb){if(o.shown(gb))return;new k('/common/ods_endpoint.php',{k:'ticker.render.switch.'+gb.id}).send();},hide:function(gb){var hb=p.scry(gb,'.fbFeedTicker')[0],ib=hb&&fb.getInstance(hb);ib&&ib.hideActiveStory();o.hide(gb);},hideStoriesByClass:function(gb){for(var hb in fb._instances)p.scry(la(hb),gb).forEach(o.hide);},hideStory:function(gb){var hb=gb&&fb.getInstance(gb);hb&&hb.hideStory(gb);},replaceStory:function(gb,hb){var ib=p.scry(document.body,'div.fbFeedTickerStory'),jb=fb.getInstance(ib[0]),kb=jb._findStoryById(gb);jb.handleRemoveStory();o.hide(kb);p.insertAfter(kb,hb);hb.setAttribute('data-story-id',kb.getAttribute('id'));var lb=setTimeout(function(){fb.removeMarkup(hb,kb);},db);hb.setAttribute('data-timeout-token',lb);},removeMarkup:function(gb,hb){o.addClass(gb,'removedStoryMarkup');new h(gb).to('height',0).duration(500).ondone(function(){p.remove(gb);}).go();},undoHideStory:function(gb){var hb=gb&&fb.getInstance(gb);hb&&hb.undoHideStory(gb);},insertStoriesAtBottom:function(gb){fb._activeInstance.insertStoriesAtBottom(gb);},_fetchTickerForPlaceholder:function(gb,hb){var ib={handler:function(){fb._placeholders[gb.id].status=bb;hb();}};ea.loadFromEndpoint('TickerEntStoryPagelet',gb.id,fb._placeholders[gb.id].pageletData,ib);fb._placeholders[gb.id].status=ab;},registerStoryDialog:function(gb,hb){i.subscribe('ticker/init',function(){var ib=ua(gb),jb=ib&&fb.getInstance(ib);jb&&jb.registerStoryDialog(ib,hb);},i.SUBSCRIBE_ALL);},registerPlaceholder:function(gb,hb){var ib=fb._placeholders[gb];fb._placeholders[gb]={status:za,pageletData:hb};if(ib&&ib.status==cb){fb.show(la(gb));ib.callback();}}});pa(fb.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_ACTION_FOOTER_PADDING:8,FLYOUT_TARGET_HEIGHT_OFFSET:25,DEFAULT_LOOK_BEHIND:10,init:function(gb,hb,ib){new fb(gb,hb,ib);},_lastKStoriesInsert:function(gb){this._lastKStories.stories[gb.getAttribute("data-story-key")]=true;var hb={story:gb,next:null};if(this._lastKStories.head)this._lastKStories.head.next=hb;this._lastKStories.head=hb;this._lastKStories.count++;if(!this._lastKStories.tail)this._lastKStories.tail=this._lastKStories.head;var ib=gb.getAttribute("data-actor");if(!this._lastKStories.actors[ib])this._lastKStories.actors[ib]=0;this._lastKStories.actors[ib]++;var jb=gb.getAttribute("data-app");if(jb){if(!this._lastKStories.apps[jb])this._lastKStories.apps[jb]=0;this._lastKStories.apps[jb]++;}if(this._lastKStories.count>this.DEFAULT_LOOK_BEHIND){while(this._lastKStories.tail&&!this._lastKStoriesRemove(this._lastKStories.tail.story))this._lastKStories.tail=this._lastKStories.tail.next;if(!this._lastKStories.tail)this._lastKStories.head=null;}},_lastKStoriesRemove:function(gb){var hb=gb.getAttribute("data-story-key"),ib=gb.getAttribute("data-actor"),jb=gb.getAttribute("data-app");if(this._lastKStories.stories[hb]){delete this._lastKStories.stories[hb];this._lastKStories.actors[ib]--;if(jb)this._lastKStories.apps[jb]--;this._lastKStories.count--;return true;}else return false;},_loadStoriesWithActions:function(){var gb=ua('rightCol');if(!gb)return;this._toggleWrapper=p.scry(gb,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var hb=p.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var ib=0;ib<hb.length;ib++){var jb=hb[ib];this._storiesWithActions[jb.getAttribute('data-story-key')]=jb;}}},_initConfig:function(gb){pa(this,{_newest:gb.newest,_page_newest:gb.newest,_timeout:gb.timeout,_heartbeatTimeout:Math.min(5000,gb.heartbeatTimeout),_maxHeartbeatTimeout:Math.max(30000,gb.maxHeartbeatTimeout),_pullTimeout:Math.max(30000,gb.pullTimeout),_insertTimeout:gb.insertTimeout,_friendCount:gb.friendCount,_maxQueueLength:gb.maxQueueLength,_heartbeatEndpoint:gb.heartbeatEndpoint,_maxCustomQueueLength:gb.maxCustomQueueLength,_customStoryInsertTimeout:Math.max(5000,gb.customStoryInsertTimeout),_nonCustomToCustomStoryRatio:gb.nonCustomToCustomStoryRatio,_minForceUpdateInterval:Math.max(gb.insertTimeout,gb.minForceUpdateInterval),_popupOnHover:gb.popupOnHover,_priorityAppId:gb.priorityAppId,_userIdleTimeout:gb.userIdleTimeout,_firstCustomStoryDelay:gb.firstCustomStoryDelay,_pollOnly:gb.pollOnly,_tickerSource:gb.tickerSource,_logFlyouts:gb.logFlyouts,_userScrollGaurdDelay:gb.userScrollGaurdDelay,_rescheduleScrollToTopDelay:gb.rescheduleScrollToTopDelay,_aggressiveRegulator:gb.aggressiveRegulator});this._queueCustomStories(gb.customStories);},_initListeners:function(){this._listeners=g.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=g.listen(this._container,'scroll',this._handleScroll.bind(this));setTimeout(this._initInfiniteScrollListener.bind(this),0);},_initSubscriptions:function(gb){y.onLeave(this._cleanup.bind(this));this._subscriptions=[i.subscribe(v.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),i.subscribe('composer/publish',this._handleComposerPublish.bind(this)),i.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),i.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),i.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),i.subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),i.subscribe('ufi/comment',this._scrollDialogToBottom.bind(this)),i.subscribe('ufi/changed',this._redrawFlyout.bind(this)),i.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(!gb.pollOnly)this._subscriptions.push(i.subscribe(m.getArbiterType('ticker_update'),this._handleTickerPush.bind(this)));if(gb.pushChannel&&!gb.pollOnly)this.setPushChannel(gb.pushChannel);},_handleClick:function(event){if(!(event.button===1||event.altKey||event.ctrlKey||event.metaKey))event.prevent();var gb=event.getTarget();if(this._getButtonFromNode(gb)){this._logUserAction(gb,'click',event);this._handleActionButton(event);return;}var hb=this._getStoryFromNode(gb),ib=w.byClass(gb,'tickerStoryAllowClick');if(!hb||hb==this._selectedStory||ib)return;if(this._storyIsHidden(hb))return;if(hb==this._activeStory&&!this._selectedStory)this._selecting=true;if(this._storyCanOpenExternally(hb)){var jb=hb.getAttribute('data-href');if(jb&&!gb.getAttribute('href')){var kb={href:jb},lb=na(gb,['ft','gt']);ma('click',kb,event,'FORCE',lb);}else this._logUserAction(gb,'click',event);this._openStoryExternally(hb,event);return;}this._logUserAction(gb,'flyout',event);this._activateStory(hb,'click');this._selectStory(hb);},_handleMouseover:function(event){this._setLocked(true);var gb=event.getTarget(),hb=this._getOpenableStory(gb);if(!hb){var ib=w.byClass(gb,"_5wvy");if(ib){clearTimeout(parseInt(ib.getAttribute('data-timeout-token'),10));var jb=setTimeout(function(){fb.removeMarkup(ib,hb);},db);ib.setAttribute('data-timeout-token',jb);}return;}event.kill();if(this._popupOnHover){if(!(hb.id in this._fetchedStories))this._uaCurStoryIDPrefetch=hb.id;this._fetchStory(hb);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var kb=this._storyCanOpenExternally(hb)?500:1000,lb=this._activeStory?75:kb;this._hoverShowTimeout=this._setTimeout(function(){this._activateStory(hb,'hover');this._logUserAction(gb,'flyout',event);}.bind(this),lb);}},_handleMouseout:function(event){var gb=event.getTarget();this._setLocked(false);if(gb==this._getStoryFromNode(gb)){var hb=p.scry(gb.parentNode,'.openToggler');for(var ib=0;ib<hb.length;ib++)aa.toggle(hb[ib]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var gb=this._activeStory;if(!gb)return;var hb=g.getKeyCode(event);switch(hb){case s.UP:case s.DOWN:var ib=this._getInsertedStories(),jb;if(event.getModifiers().any){jb=hb===s.UP?0:ib.length-1;}else jb=ib.indexOf(gb)+(hb===s.UP?-1:1);gb=ib[jb];break;case s.ESC:this._deactivateStory(true);return;default:return;}event.kill();if(!gb)return;this._activateStory(gb,'keypress');this._selectStory(gb);},_fadeTopmostStoryButton:function(){var gb=0,hb=15;if(this._storiesWithActions)for(var ib in this._storiesWithActions){var jb=this._storiesWithActions[ib],kb=p.scry(jb,'.tickerInlineActionButton')[0],lb=p.scry(kb,'.tickerActionIcon')[0],mb=ia.getElementPosition(kb).y-ia.getElementPosition(this._toggleWrapper).y;if(mb<gb){ba.set(kb,'opacity',0);ba.set(lb,'opacity',0);}else if(mb>=gb&&mb<hb){var nb=(mb-gb)/(hb-gb);ba.set(kb,'opacity',nb);ba.set(lb,'opacity',nb);break;}else{ba.set(kb,'opacity',1);ba.set(lb,'opacity',1);}}},_handleScroll:function(){var gb=ya.checkIsOpen();if(gb)this._preventFlyoutDismiss=true;if(!this._preventScrollDismiss&&!gb){if(!this._preventFlyoutDismiss){this._deactivateStory(true);}else this._preventFlyoutDismiss=false;}else this._preventScrollDismiss=false;if(!this._handleScrollThrottled)this._handleScrollThrottled=xa(this._handleScrollInner.bind(this));this._handleScrollThrottled();},_handleScrollInner:function(){this._fadeTopmostStoryButton();this._checkInfiniteScroll();this._setIsUserScrolling();if(!this._scrollLogged){this._scrollLogged=true;var gb=this._stories.childNodes.length,hb=this._stories.getAttribute('data-gt'),ib={ticker_scroll:1,number_stories:gb,source:hb};ma('scroll',null,null,'FORCE',{gt:ib});}},_setIsUserScrolling:function(){clearTimeout(this._userScrollingToken);if(this._isScrolledToTop()){this._userScrolling=false;return;}this._userScrolling=true;this._userScrollingToken=setTimeout(function(){this._userScrolling=false;this._userScrollingToken=null;}.bind(this),this._userScrollGaurdDelay);},_isUserScrolling:function(){return this._userScrolling;},_handleStoriesInserted:function(){this._initInfiniteScrollListener();if(this._scrollableArea instanceof z){this._scrollableArea.adjustGripper();}else eb.error('wrong_scrollable_area',{dump:this});},_handleActionButton:function(event){var gb=event.getTarget(),hb=this._getOpenableStory(gb),ib=this._getStoryDialog(hb);if(ib)var jb=ib.subscribe('beforehide',function(){ib.unsubscribe(jb);return false;});},_handleScrollToTopClick:function(){this._scrollToTop(this._poll.bind(this));},_scheduleScrollToTop:function(){this._scrollToTopToken&&clearTimeout(this._scrollToTopToken);this._scrollToTopToken=setTimeout(function(){if(this._isLocked()||this._isUserScrolling()){this._scheduleScrollToTop();}else{this._scrollToTopToken=null;this._scrollToTop();}}.bind(this),this._rescheduleScrollToTopDelay);},_scrollToTop:function(gb){new h(this._container).to('scrollTop',0).ease(h.ease.end).ondone(gb).go();},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return p.scry(this._root,'div.fbFeedTickerStory');},_findStoryById:function(gb){var hb=p.scry(this._root,'.fbFeedTickerStory'),ib;for(story in hb){ib=hb[story];if(gb==this._getStoryDialogParams(ib).token)return ib;}return null;},_getInsertedStories:function(){return this._getAllStories().filter(function(gb){return !o.hasClass(gb,'queuedStory')&&!o.hasClass(gb,'customStory');});},_getQueuedStories:function(){return p.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getQueuedCustomStories:function(){return p.scry(this._storyQueue,'.fbFeedTickerStory.customStory');},_getButtonFromNode:function(gb){return w.byClass(gb,'tickerInlineOverlay');},_getStoryFromNode:function(gb){return w.byClass(gb,'fbFeedTickerStory');},_getActionButtonFromStory:function(gb){return p.scry(gb,'.tickerInlineActionButton')[0];},_getOpenableStory:function(gb){var hb=this._getStoryFromNode(gb);return this._storyCanOpenDialog(hb)?hb:null;},_getStoryDialog:function(gb){return this._fetchedStoriesDialog[gb.id]||n.getInstance(gb);},_getStoryDialogParams:function(gb){var hb=gb&&gb.getAttribute('data-flyoutdata')||null;return hb&&JSON.parse(hb)||null;},_storyCanOpenDialog:function(gb){return !!this._getStoryDialogParams(gb)&&!this._storyIsHidden(gb);},_storyCanOpenExternally:function(gb){return !!gb.getAttribute('data-href')||!this._storyCanOpenDialog(gb);},_storyIsHidden:function(gb){return o.hasClass(gb,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(gb){this._deactivateStory();if(va(gb)==='')p.remove(gb);o.addClass(gb,'tickerStoryHidden');o.removeClass(gb,'tickerStoryClickable');},undoHideStory:function(gb){o.addClass(gb,'tickerStoryClickable');o.removeClass(gb,'tickerStoryHidden');},insertStoriesAtBottom:function(gb){if(!gb)return;var hb=p.create('div');hb.appendChild(gb);var ib=p.scry(hb,'.fbFeedTickerStory'),jb=p.find(hb,'.tickerMorePager'),kb=[];for(var lb=0;lb<ib.length;lb++)if(!this.dedupeStory(ib[lb]))kb.push(ib[lb]);if(kb.length){kb.push(jb);p.replace(p.find(this._root,'.tickerMorePager'),kb);}i.inform('Ticker/storiesInserted');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function(gb){this._scrollTopPromptVisible=gb;o.conditionShow(this._scrollTopPrompt,gb);if(gb&&!this._listeners.scrollTop){this._listeners.scrollTop=g.listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!gb&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function(){return !ga.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){if(!this._isTickerVisible())return;if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var gb=this._storiesToRemove.pop();this.removeStory(gb);}var hb=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(hb);var ib=Date.now(),jb=ib-this._lastInsert;if(jb<this._insertTimeout||this._isLocked())return this._schedulePoll();var kb=this._getQueuedStories(),lb=this._getQueuedCustomStories(),mb=this._isUserIdle(),nb=kb.length>0,ob=lb.length>0&&!mb&&(ib-this._initTime>this._firstCustomStoryDelay)&&(this._needNonCustomStoryNum===0||(!nb&&(ib-this._lastCustomStory)>this._customStoryInsertTimeout));if(ob){this.insertStory(lb.shift());this._lastCustomStory=ib;this._needNonCustomStoryNum=this._nonCustomToCustomStoryRatio;return this._schedulePoll();}if(nb){var pb=kb.shift();this.insertStory(pb);this._needNonCustomStoryNum--;if(this._needNonCustomStoryNum<0)this._needNonCustomStoryNum=0;return this._schedulePoll();}if(mb)return ga.subscribeOnce(this._poll.bind(this));var qb=lb.length===0&&this._needNonCustomStoryNum===0&&this._nonCustomToCustomStoryRatio>0&&ga.isActive(this.ADS_IDLE_MS)&&((ib-this._lastUpdate)>this._minForceUpdateInterval),rb=false,sb=false;if(this._pollOnly){sb=ib-this._lastUpdate>this._heartbeatTimeout;}else rb=(ib-this._lastPull>this._pullTimeout);var tb=(qb&&this._doCustomUpdate)||rb||sb;if(!tb)return this._schedulePoll();if(qb)this._doCustomUpdate=false;this.update({pull:rb,fullpoll:sb,needcustomstory:qb});},_updatePollOnlyHeartbeatTimeout:function(){if(this._pollOnly&&this._heartbeatTimeout<this._maxHeartbeatTimeout)this._heartbeatTimeout=Math.min(this._heartbeatTimeout+5000,this._maxHeartbeatTimeout);},update:function(gb){this._updatePollOnlyHeartbeatTimeout();if(!this._pollOnly)return this._schedulePoll();var hb={newest:(gb.fullpoll||gb.cache_update)?this._newest:this._page_newest,storyids:this._storyIDs,friendcount:this._friendCount,priorityappid:this._priorityAppId,source:this._tickerSource,needcustomstory:this._nonCustomToCustomStoryRatio>0};if(!hb.newest||hb.newest==='0')throw new Error(sa('Trying to request new ticker stories with an invalid cursor %s, with'+' the settings fullpoll %s, cache_update %s, value coming from this.%s',typeof hb.newest==='string'?'"'+hb.newest+'"':hb.newest,gb.fullpoll,gb.cache_update,(gb.fullpoll||gb.cache_update)?'_newest':'_page_newest'));pa(hb,gb);new j().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(hb).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(hb.pull)this._lastPull=this._lastUpdate;this._storyIDs=[];},insertStory:function(gb,hb,ib){this._lastInsert=Date.now();window.LiveTimer&&u.addTimeStamps(gb);o.removeClass(gb,'queuedStory');o.removeClass(gb,'customStory');if(hb!==false){var jb=ib?this._fadeStoryIn:this._flyStoryIn;if(this._isUserScrolling()){var kb=function(){this._container.scrollTop=this._container.scrollTop+this._stories.firstChild.offsetHeight;this._scheduleScrollToTop();}.bind(this);this._fadeStoryIn(gb,kb);}else this._scrollToTop(jb.bind(this,gb));}else p.prependContent(this._stories,gb);if(this._storiesWithActions&&o.hasClass(gb,'tickerStoryWithButton'))this._storiesWithActions[gb.getAttribute('data-story-key')]=gb;this._removeOldStories();},_removeOldStories:function(){var gb=this._getInsertedStories();if(gb.length<=this._maxStoriesToKeep)return;var hb=this._minStoriesToKeep,ib=gb.slice(hb);ib.forEach(p.remove);if(this._storiesWithActions)for(var jb=0;jb<ib.length;jb++)delete this._storiesWithActions[ib[jb].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var gb=this._getInsertedStories();if(!gb||!gb.length)return;var hb=gb[gb.length-1].getAttribute('data-ticker-timestamp'),ib=p.scry(this._root,'.tickerMorePager a')[0];if(!ib||!hb)return;var jb=new fa(ib.getAttribute('ajaxify'));jb.addQueryData({oldest:hb});ib.setAttribute('ajaxify',jb);},_setLocked:function(gb){this._locked=gb;},_isLocked:function(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function(gb,hb,ib){var jb=this._getStoryFromNode(gb),kb=jb.getAttribute('data-story-key');p.setContent(jb,hb);o.addClass(jb,'highlightedStory');this._setTimeout(this.removeStory.bind(this,kb),ib||6000);},_getStoryByStoryKey:function(gb){var hb=this._getAllStories();for(var ib=0;ib<hb.length;ib++){var jb=hb[ib];if(jb.getAttribute('data-story-key')==gb)return jb;}return null;},removeStory:function(gb){this._removedStoryIDs[gb]=true;var hb=this._getStoryByStoryKey(gb);if(!hb)return;if(this._storiesWithActions)delete this._storiesWithActions[gb];if(hb==this._activeStory)this._deactivateStory();var ib=this._getStoryDialog(hb);ib&&ib.destroy();this._lastKStoriesRemove(hb);var jb=hb.getAttribute("data-dedupe-key");if(jb)delete this._dedupeKeys[jb];if(o.hasClass(hb,'queuedStory')){p.remove(hb);return;}this._animateStoryOut(hb);},_isScrolledToTop:function(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function(gb){var hb=p.create('div',{style:{marginTop:'-1000px'}},gb);ba.set(hb,'opacity',0);p.prependContent(this._stories,hb);var ib=ia.getElementDimensions(hb).y;ba.set(hb,'marginTop','-'+ib+'px');this._isInsertingStory=true;new h(hb).to('marginTop',0).ease(h.ease.end).checkpoint(.5).to('opacity',1).ondone(function(){p.replace(hb,gb);this._afterInsert(gb);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function(gb,hb){new h(this._stories).to('opacity',.5).ondone(function(){p.prependContent(this._stories,gb);if(hb)hb();new h(this._stories).to('opacity',1).ondone(function(){this._afterInsert(gb);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function(gb){var hb=p.create('div',{style:{overflow:'hidden',position:'relative'}});p.insertBefore(gb,hb);p.appendContent(hb,gb);new h(hb).to('top',20).to('height',0).to('opacity',0).ease(h.ease.end).ondone(function(){p.remove(hb);i.inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function(gb){i.inform('Ticker/afterInsert');},setPushChannel:function(gb){this._pushSubscription&&this._pushSubscription.unsubscribe();this._pushSubscription=i.subscribe(m.getArbiterType(gb),this._handleTickerPush.bind(this));d(['ChatConfig','ChannelConnection'],function(hb,ib){this._channelConnection=ib;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}.bind(this));},_checkChannelConnection:function(){o.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},setCurrentAppId:function(gb){this._priorityAppId=gb;},_handleTickerPush:function(gb,hb){var ib=hb.obj;if(ib.delete_id){this._storiesToRemove.push(ib.delete_id);return;}if(ib.fromups)if(ib.do_logging)this._logDarkLaunch(ib);var jb=ib.story_xhp;if(!jb)return;var kb=q(jb).getRootNode();if(!ib.story_time||ib.story_time==='0')throw new Error(sa('An invalid story time was pushed: %s, for ticker story: %s',typeof ib.story_time==='string'?'"'+ib.story_time+'"':ib.story_time,kb.getAttribute('data-flyoutdata')));this._newest=ib.story_time;this.queueStory(kb,ib.flyout_js_cmds);if(this._aggressiveRegulator&&ib.actor==this._newestStory.actorID){this.removeStory(this._newestStory.storyKey);new k('/common/ods_endpoint.php',{k:'ticker.aggr.remove'}).send();}this._newestStory={actorID:ib.actor,storyKey:kb.getAttribute('data-story-key')};},_handleComposerPublish:function(gb,hb){hb.tickerMarkup&&this.insertStory(hb.tickerMarkup);},_logDarkLaunch:function(gb){var hb={actor:gb.actor,story_time:gb.story_time,key:gb.story_obj_id,dark:1};new j().setURI('/alite/push/log.php').setData({msg:JSON.stringify(hb)}).send();},_logRender:function(){if(this._loggedRender)return;var gb=this._tickerInSidebarMode;if(gb||w.byClass(this._content,'home_right_column')){new k('/ajax/log_ticker_render.php',{sidebar_mode:gb}).send();this._loggedRender=true;}},_isTickerVisible:function(){var gb=(fb._activeInstance==this);gb&&this._logRender();return gb;},_handleResponse:function(gb){var hb=gb.getPayload();if(hb.newest)this._newest=this._page_newest=hb.newest;if(hb.content)if(hb.content instanceof Array){for(var ib=0;ib<hb.content.length;ib++)this.queueStoryMarkup(hb.content[ib]);}else this.queueStoryMarkup(hb.content);if(hb.custom_stories&&hb.custom_stories.length){this._queueCustomStories(hb.custom_stories);this._doCustomUpdate=true;}},queueStoryMarkup:function(gb){var hb=q(gb).getRootNode();this.queueStory(hb);},dedupeStory:function(gb){var hb=gb.getAttribute('data-story-key'),ib=hb&&(!!this._objectIDs[hb]||!!this._removedStoryIDs[hb]);ib=ib||!!this._lastKStories.actors[gb.getAttribute('data-actor')]||!!this._lastKStories.apps[gb.getAttribute('data-app')];var jb=gb.getAttribute('data-dedupe-key');ib=ib||jb&&this._dedupeKeys[jb];if(gb.getAttribute('data-force-push'))ib=false;hb&&(this._objectIDs[hb]=true);return ib;},queueStory:function(gb,hb){if(this.dedupeStory(gb))return;this._lastKStoriesInsert(gb);var ib=gb.getAttribute("data-dedupe-key");if(ib)this._dedupeKeys[ib]=true;o.addClass(gb,'queuedStory');p.appendContent(this._storyQueue,gb);var jb=hb&&hb.length;if(jb)hb.forEach(function(lb){new Function(lb).apply();});gb.setAttribute('id',gb.id+'_'+this._root.id);var kb=this._getQueuedStories();kb.slice(0,-this._maxQueueLength).forEach(p.remove);if(jb)this._fetchedStories[gb.id]=true;},_queueCustomStories:function(gb){while(gb.length){var hb=gb.shift();hb=q(hb).getRootNode();if(this.dedupeStory(hb))continue;o.addClass(hb,'customStory');p.appendContent(this._storyQueue,hb);}var ib=this._getQueuedCustomStories();ib.slice(0,-this._maxQueueLength).forEach(p.remove);},_cleanup:function(){fb._placeholders.pagelet_rhc_ticker=null;if(!w.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.forEach(i.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&this._pushSubscription.unsubscribe();for(var gb in this._listeners)this._listeners[gb]&&this._listeners[gb].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();i.inform('Ticker/cleanup');},_onNavHandler:function(gb,hb){var ib=hb.params.key;if(ib!='lf'&&ib!='h')this._cleanup();},registerStoryDialog:function(gb,hb){if(this._uaCurStoryIDFetch==gb.id)this._uaCurStoryIDFetch=null;if(this._uaCurStoryIDPrefetch==gb.id)this._uaCurStoryIDPrefetch=null;this._fetchedStories[gb.id]=true;this._fetchedStoriesDialog[gb.id]=hb;hb.setContext(gb);hb.subscribe('hide',this._deactivateStory.bind(this,true));hb.subscribe('success',this._focusStory.bind(this,gb));hb.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){hb.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));hb.subscribe('mouseleave',this._scheduleHide.bind(this));hb.subscribe('show',function(){setTimeout(this._highlightDialogScrollbar.bind(this,hb),0);var ib=g.listen(hb.getContent(),'mousedown',function(){this._selectStory(gb);ib.remove();}.bind(this));}.bind(this));}if(gb==this._activeStory)this._openDialog(hb);},_highlightDialogScrollbar:function(gb){var hb=p.scry(gb.getContent(),'.uiScrollableArea')[0];hb&&z.poke(hb);},_openStoryExternally:function(gb,event){var hb=gb.getAttribute('data-href');if(!hb||hb=='#')return;var ib=gb.getAttribute('data-story-rel');switch(ib){case 'theater':this._deactivateAndClearStory();l.loadModules(["PhotoViewer"],function(lb){lb.bootstrap(hb,gb);});return;case 'async':this._deactivateAndClearStory();j.bootstrap(hb,gb);return;}var jb=gb.getAttribute('data-target'),kb=(event.which!=1||event.getModifiers().any||jb=='_blank');kb?window.open(hb,'_blank'):wa(hb);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStoryWillTriggerScroll:function(gb){var hb=this._container,ib=hb.clientHeight,jb=gb.offsetHeight,kb=hb.scrollTop,lb=kb+ib,mb=gb.offsetTop,nb=mb+jb;return mb<kb||nb>lb;},_focusStory:function(gb){if(this._focusStoryWillTriggerScroll(gb))this._preventScrollDismiss=true;var hb=new x(gb),ib=w.byClass(gb,'scrollable'),jb=hb.boundWithin(new x(ib)).getPositionVector(),kb=hb.getPositionVector().sub(jb);if(kb.y!==0)kb.scrollElementBy(ib);gb.focus();},_selectStory:function(gb){this._selectedStory=gb;o.addClass(gb,'tickerStorySelected');o.addClass(this._root,'tickerChildSelected');},_activateStory:function(gb,hb){this._clearHoverTimeouts();if(gb==this._activeStory||!this._storyCanOpenDialog(gb))return;this._deactivateStory();this._focusStory(gb);this._activeStory=gb;o.addClass(gb,'tickerStoryActive');window.Toggler&&da.hide();if(this._logFlyouts){hb=hb||'unknown';new k('/ajax/feed/ticker/flyout.php',{src:hb}).send();}ca.log(gb);var ib=this._getStoryDialog(gb);if(ib){if(this._storyDialogResources[gb.id])l.loadResources(this._storyDialogResources[gb.id]);this._openDialog(ib);ka.bumpEntityKey('ticker_stories','flyouts.open');return;}if(!(gb.id in this._fetchedStories))this._uaCurStoryIDFetch=gb.id;this._fetchStory(gb);},handleRemoveStory:function(){this._deactivateStory(true);},_deactivateStory:function(gb){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(gb===true){this._dialog.enableBehavior(t);}else this._dialog.disableBehavior(t);this._dialog.hide();}if(this._activeStory){o.removeClass(this._activeStory,'tickerStoryActive');o.removeClass(this._activeStory,'tickerStorySelected');o.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;},_logUserAction:function(gb,hb,event){ma(hb,gb,event,'FORCE');},_fetchStory:function(gb){clearTimeout(this._fetchToken);var hb=[],ib=this._getInsertedStories(),jb=ib.indexOf(gb);[-1,0,1].forEach(function(kb){var lb=ib[jb+kb];lb&&hb.push(lb);},this);this._fetchToken=setTimeout(this._fetchStories.bind(this,hb),100);},_fetchStories:function(gb){var hb=[],ib,jb=function(kb){clearTimeout(ib);gb.forEach(function(lb){o.conditionClass(lb,'tickerStoryFetching',kb);});};gb=gb.filter(function(kb){if(kb.id in this._fetchedStories)return false;this._fetchedStories[kb.id]=true;var lb=this._getStoryDialogParams(kb);if(!lb)return false;lb.uniq_id=kb.getAttribute('id');lb.referrer=this._tickerSource;hb.push(lb);return true;},this);if(!hb.length)return;ib=this._setTimeout(jb.bind(null,true),500);new j('/ajax/feed/ticker/multi_story').setInitialHandler(this._handleDialogResponse.bind(this,hb)).setFinallyHandler(jb.bind(null,false)).setErrorHandler(ta).setData({stories:hb}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_handleDialogResponse:function(gb,hb){if(hb&&hb.resource_map){var ib=[];for(var jb in hb.resource_map){var kb=hb.resource_map[jb];if(kb.type==='css'&&!kb.permanent)ib.push(jb);}if(ib.length>0)for(var lb=0;lb<gb.length;lb++)this._storyDialogResources[gb[lb].uniq_id]=ib;}},_tickerDeClicker:function(event){var gb=event.getTarget(),hb=w.byTag(gb,'a'),ib=this._getStoryFromNode(gb),jb=this._getButtonFromNode(gb);if(ib&&hb&&!jb&&o.hasClass(ib,'tickerStoryClickable')&&!o.hasClass(hb,'tickerStoryAllowClick')&&!this._storyIsHidden(ib))hb.setAttribute('rel','ignore');var kb=(event.button==2),lb=(event.type==='keydown'),mb=ib&&this._getActionButtonFromStory(ib);if(!kb&&mb&&!lb)this._setClickedStory(ib);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(gb){this._clearClickedStory();o.addClass(gb,'tickerStoryClicked');this._clickedStory=gb;},_clearClickedStory:function(){if(this._clickedStory){o.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function(){var gb=this._getInsertedStories();if(this._storiesWithActions)for(var hb=0;hb<gb.length;hb++){var ib=gb[hb];if(o.hasClass(ib,'tickerStoryWithButton'))this._storiesWithActions[ib.getAttribute('data-story-key')]=ib;}var jb=Math.max(0,gb.length-this._autoloadStoryIndex);this._infiniteScrollStory=gb[jb];this._checkInfiniteScroll();},_checkInfiniteScroll:function(){if(this._infiniteScrollStory){var gb=ia.getElementPosition(this._infiniteScrollStory).y,hb=ia.getElementPosition(this._container).y+ia.getElementDimensions(this._container).y;if(gb<hb){var ib=p.scry(this._root,'.tickerMorePager a')[0];if(ib){var jb=w.byClass(ib,'stat_elem')||ib;new j(ib.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(ib).setStatusElement(jb).setAllowCrossPageTransition(true).send();}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function(gb){if(!this._selectedStory)return;var hb=this._getStoryDialog(this._selectedStory);if(hb){hb.setFixed&&hb.setFixed(gb);hb.updatePosition();}},_setTimeout:function(gb,hb){return setTimeout(gb,hb,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var gb=this._dialog&&this._dialog.getContent(),hb=gb&&p.scry(gb,'.uiScrollableAreaWrap')[0],ib=hb&&z.getInstance(hb);ib&&ib.scrollToBottom();},_redrawFlyout:function(gb,hb){if(this._hasUFIUpdated)return;var ib=this._dialog;if(ib&&ib.isShown()&&oa(ib.getContent(),hb.form)){this._hasUFIUpdated=true;this._updateDialogPosition();}},_openDialog:function(gb){if(!this._tickerInSidebarMode)o.addClass(gb.getRoot(),'tickerStoryOverlayOnTop');this._hasUFIUpdated=false;var hb=ja.getScrollPosition();this._dialog=gb.show();window.scrollTo(hb.x,hb.y);this._updateDialogPosition();this._writeSwfFrame(gb);setTimeout(this._initCommentFocusListener.bind(this),0);setTimeout(this._initContentResizeListener.bind(this),0);this._stupidIE7VideoResizeHack(gb);},_stupidIE7VideoResizeHack:function(gb){if(ha.ie()===7){var hb=p.scry(gb.getContent(),'.uiVideoThumb .img');hb.forEach(function(ib){ba.set(ib,'width','');});}},_updateDialogPosition:function(){var gb=this._tickerInSidebarMode||!!w.byClass(this._root,'fixed_elem');this._dialog.setFixed&&this._dialog.setFixed(gb);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(gb){var hb=this._dialog&&this._dialog.getContent(),ib=p.scry(hb,'.swfObject')[0];if(!ib)return;var jb=ib.getAttribute('data-swfid');if(jb&&window[jb]){var kb=window[jb];kb.write(ib);}},_initCommentFocusListener:function(){var gb=this._dialog&&this._dialog.getContent(),hb=gb&&p.scry(gb,'.tickerDialogFooter textarea')[0];if(!hb)return;this._listeners.inputFocus=g.listen(hb,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var gb=this._dialog&&this._dialog.getContent();if(!gb)return;this._listeners.contentResize=g.listen(gb,'click',function(){setTimeout(this._dialog.updatePosition.bind(this._dialog),0);}.bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var gb=this._dialog&&this._dialog.getContent(),hb=gb&&p.scry(gb,'.uiScrollableAreaWrap')[0];if(!hb)return;var ib=ia.getElementDimensions(hb),jb=ia.getElementPosition(hb),kb=p.scry(hb,'.uiUfi .uiUfiComment'),lb=p.scry(hb,"._12tg")[0],mb=p.scry(hb,".UFILikeSentence")[0],nb=this.FLYOUT_MAX_HEIGHT;if(lb||mb){var ob=this._getUfiItemAndTop(lb,mb),pb=ob[0],qb=ob[1];nb=Math.max(nb,this.FLYOUT_TARGET_HEIGHT_OFFSET+hb.scrollTop+qb+pb.offsetHeight-jb.y);}var rb=ia.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING;nb=Math.min(nb,rb);var sb=nb-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var tb=0;tb<kb.length;tb++){var ub=kb[tb],vb=ia.getElementPosition(ub),wb=vb.y-jb.y;if(Math.abs(wb-sb)<=this.FLYOUT_OFFSET_THRESHOLD){sb=wb+this.FLYOUT_COMMENT_OFFSET;break;}}if(ib.y>=sb){ba.set(hb,'height',sb+'px');ba.set(hb,'max-height',null);}else{ba.set(hb,'max-height',nb+'px');ba.set(hb,'height',null);}},_getUfiItemAndTop:function(gb,hb){var ib=(gb&&ia.getElementPosition(gb).y)||0,jb=(hb&&ia.getElementPosition(hb).y)||0,kb=[gb,ib+this.FLYOUT_ACTION_FOOTER_PADDING],lb=[hb,jb];return ib>jb?kb:lb;},_initObjectIDs:function(){var gb=this._getAllStories();for(var hb=gb.length-1;hb>=0;hb--){var ib=gb[hb].getAttribute('data-story-key');if(ib){this._objectIDs[ib]=true;this._lastKStoriesInsert(gb[hb]);var jb=gb[hb].getAttribute("data-dedupe-key");if(jb)this._dedupeKeys[jb]=true;}}},_handleChatOpened:function(){this._deactivateStory(true);},_handleChannelConnection:function(){this._checkChannelConnection();},getNewest:function(){return this._newest;}});e.exports=fb;},null);
__d("TickerRightColumnController",["Arbiter","CSS","DOM","Event","NavigationMessage","Run","Style","SubscriptionsHandler","TickerController","Vector","ge","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s;function t(){var y=q('pagelet_rhc_ticker');y&&o.show(y,v);}function u(){var y=q('pagelet_rhc_ticker');y&&o.hide(y);}function v(){var y=q('pagelet_rhc_ticker'),z=i.scry(y,'.ticker_container')[0],aa=i.scry(y,'.ticker_stream')[0],ba=q('rightCol');if(!y||!z||!aa||!ba)return;m.set(z,'height','0');var ca=75,da=p.getViewportDimensions().y,ea=p.getElementDimensions(ba).y,fa=da-ea-ca,ga=p.getElementDimensions(aa).y,ha=Math.max(Math.min(fa,ga,s.tickerMaxHeight||425),s.tickerMinHeight||225);m.set(z,'height',ha+'px');}function w(y){var z=q('pagelet_reminders'),aa=q('pagelet_rhc_ticker'),ba=z&&i.scry(z,'div.tickerToggleWrapper')[0],ca=aa&&i.scry(aa,'div.tickerToggleWrapper')[0];ba&&h.conditionClass(ba,'displayedTickerToggleWrapper',!y);ca&&h.conditionClass(ca,'displayedTickerToggleWrapper',y);aa&&h.conditionClass(aa,'hidden_rhc_ticker',!y);if(y){v();var da=q('fbTickerClosedEd');da&&h.hide(da);}}var x={init:function(y){s=y;var z=new n();if(s.enableSidebar)z.addSubscriptions(g.subscribe('sidebar/hide',t),g.subscribe('sidebar/show',u),g.subscribe('minisidebar/show',t),g.subscribe('LitestandClassicRHC/loaded',v),j.listen(window,'scroll',r(function(){var ba=i.scry(q('pagelet_rhc_ticker'),'.fbFeedTicker')[0],ca=ba&&o.getInstance(ba);ca&&ca.handleRemoveStory();})));if(!h.hasClass(document.documentElement,'sidebarMode')){t();}else if(s.enableSidebar)h.hasClass(document.documentElement,'miniSidebar')?t():u();var aa=function(){z.release();};g.subscribeOnce(k.NAVIGATION_BEGIN,aa);l.onLeave(aa);},initRHCTickerHider:function(y){j.listen(y,'click',this.hideRHCTicker);},showRHCTicker:function(){w(true);},hideRHCTicker:function(){w(false);}};e.exports=x;},null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={generateMessageID:function(j){var k=j||Date.now(),l=h(0,4294967295),m=g.getSessionID();return ("<"+k+":"+l+"-"+m+"@mail.projektitan.com>");},generateThreadID:function(j){return 'root:'+i.generateMessageID(j);}};e.exports=i;},null);
__d("MercuryMessageObject",["MercuryActionStatus","MercuryActionType","MercuryIDs","MercuryLocalIDs","MercuryMessageClientState","MercuryMessageSourceTags","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercurySendMessageFields","fbt","formatDate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(v){"use strict";this.$MercuryMessageObject0=v;}s.prototype.constructUserGeneratedMessageObject=function(v,w,x,y,z){"use strict";var aa=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);if(typeof v=='string')v=v.replace(/^\s+/,'').replace(/\s+$/,'');aa.body=v;aa.has_attachment=false;aa.html_body=false;aa.attachments=[];aa.specific_to_list=y||[];aa.creator_info=z;return aa;};s.prototype.constructStickerMessageObject=function(v,w,x){"use strict";var y=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);y.has_attachment=true;y.html_body=false;y.attachments=[];y.sticker_id=v;y.specific_to_list=[];return y;};s.prototype.constructAttachmentMessageObject=function(v,w){"use strict";var x=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,v,w);x.attachments=[];x.specific_to_list=[];return x;};s.prototype.constructLogMessageObject=function(v,w,x,y){"use strict";var z=t(this.$MercuryMessageObject0,h.LOG_MESSAGE,v,w);z.log_message_type=x;z.log_message_data=y;return z;};s.prototype.normalizeNewMessage=function(v){"use strict";if(v.status===undefined)v.status=g.UNSENT;v.timestamp_absolute=q._("Today");v.message_id=v.message_id||j.generateMessageID(v.timestamp);var w=i.getParticipantIDFromUserID(this.$MercuryMessageObject0);v.specific_to_list=v.specific_to_list||[];if(v.specific_to_list.length&&v.specific_to_list.indexOf(w)===-1)v.specific_to_list.push(w);if(!v.thread_id){if(v.specific_to_list.length==1){v.thread_id='user:'+this.$MercuryMessageObject0;}else if(v.specific_to_list.length==2){var x=v.specific_to_list[0]==w?v.specific_to_list[1]:v.specific_to_list[0];v.thread_id=i.getThreadIDFromParticipantID(x);}v.thread_id=v.thread_id||'root:'+v.message_id;}if(!v.specific_to_list.length){var y=i.tokenize(v.thread_id),z=y.type,aa=y.value;if(z=='user')v.specific_to_list=['fbid:'+aa,w];}if(!v[p.MANUAL_RETRY_CNT])v[p.MANUAL_RETRY_CNT]=0;};s.prototype.normalizeResendMessage=function(v){"use strict";v.status=g.RESENDING;v.timestamp=Date.now();v[p.MANUAL_RETRY_CNT]+=1;};s.prototype.normalizeAddAttachmentPlaceholder=function(v,w,x){"use strict";if(x.preview_attachments.length>0){v.has_attachment=true;v.preview_attachments=x.preview_attachments;}v.client_state=k.DO_NOT_SEND_TO_SERVER;v.status=g.RESENDING;v.upload_id=w;};function t(v,w,x,y){var z=u(x)?[l.CHAT]:[],aa=Date.now(),ba=r(new Date(aa),'g:ia'),ca={action_type:w,thread_id:y,author:i.getParticipantIDFromUserID(v),author_email:null,coordinates:null,timestamp:aa,timestamp_absolute:(new Date(aa)).toLocaleDateString(),timestamp_relative:ba,timestamp_time_passed:o.TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:x,source_tags:z};return ca;}function u(v){switch(v){case n.CHAT_WEB:case n.CHAT_JABBER:case n.CHAT_IPHONE:case n.CHAT_MEEBO:case n.CHAT_ORCA:case n.CHAT_TEST:case n.CHAT:case n.DESKTOP:return true;default:return false;}}Object.assign(s,m);e.exports=s;},null);
__d("MercuryMessageActions",["CurrentUser","MercuryActionType","MercuryMessageObject","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';function m(n){this.$MercuryMessageActions0=n;this.$MercuryMessageActions1=i.getForFBID(this.$MercuryMessageActions0);this.$MercuryMessageActions2=k.getForFBID(this.$MercuryMessageActions0);}m.prototype.send=function(n,o,p){o=o||Function.prototype;this.$MercuryMessageActions1.normalizeNewMessage(n);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},n),j.CLIENT_SEND_MESSAGE));this.$MercuryMessageActions2.sendNewMessage(n,p);o(n.thread_id);};m.prototype.resend=function(n,o){var p=Object.assign({},n);this.$MercuryMessageActions1.normalizeResendMessage(p);this.send(p,(void 0),o);};m.prototype.addAttachmentPlaceholder=function(n,o,p){this.$MercuryMessageActions1.normalizeAddAttachmentPlaceholder(n,o,p);this.$MercuryMessageActions1.normalizeNewMessage(n);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},n),j.CLIENT_SEND_MESSAGE));};m.prototype.cancelAttachmentPlaceholder=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:n,upload_data:o,action_type:h.CANCEL_ATTACHMENT_PLACEHOLDER},j.CLIENT_SEND_MESSAGE));};m.prototype.confirmAttachmentPlaceholder=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:n,upload_data:o,action_type:h.CONFIRM_ATTACHMENT_PLACEHOLDER},j.CLIENT_SEND_MESSAGE));};m.addShareDataToExistingMessage=function(n,o,p,q){q=q||g.getID();m.getForFBID(q).addShareDataToExistingMessage(n,o,p);};m.prototype.addShareDataToExistingMessage=function(n,o,p){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions4({server_id:n,attach_key:o,attach_data:p,action_type:h.ADD_SHARE_DATA_TO_EXISTING_MESSAGE},j.SERVER_ADD_SHARE_DATA_TO_EXISTING_MESSAGE));};m.prototype.markSpam=function(n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions5(n,o,h.MARK_MESSAGES_SPAM,j.CLIENT_MARK_MESSAGES_SPAM));};m.prototype["delete"]=function(n,o,p){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions5(n,o,h.DELETE_MESSAGES,p||j.CLIENT_DELETE_MESSAGES));};m.prototype.$MercuryMessageActions3=function(n,o){return {actions:[n],from_client:true,payload_source:o};};m.prototype.$MercuryMessageActions4=function(n,o){return {actions:[n],from_client:false,payload_source:o};};m.prototype.$MercuryMessageActions5=function(n,o,p,q){return {actions:[{action_type:p,action_id:null,thread_id:n,message_ids:o}],from_client:true,payload_source:q};};Object.assign(m,l);e.exports=m;},null);
__d("MercuryThreadActions",["MercuryActionType","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MessagingTag","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';function m(n){this.$MercuryThreadActions0=n;this.__serverRequests=i.getForFBID(this.$MercuryThreadActions0);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.__serverRequests.handleUpdate(this.$MercuryThreadActions1(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.__serverRequests.handleUpdate(this.$MercuryThreadActions1(n,false,o));};m.prototype.markSeen=function(n,o){this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.MARK_THREAD_SEEN,h.CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions2(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions2(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(n,k.SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(n,k.INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(n,o));};m.prototype["delete"]=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.__constructClientPayload(n,g.DELETE_THREAD,h.CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.CHANGE_MUTE_SETTINGS,h.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:o}));};m.prototype.addParticipants=function(n,o){this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.ADD_PARTICIPANTS,h.CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.unpinThread=function(n){this.__serverRequests.unpinThread(n);this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.UNPIN_THREAD,h.CLIENT_UNPIN_THREAD));};m.prototype.$MercuryThreadActions1=function(n,o,p){return this.__constructClientPayload(n,g.CHANGE_READ_STATUS,h.CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions2=function(n,o){return this.__constructClientPayload(n,g.CHANGE_ARCHIVED_STATUS,h.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,g.CHANGE_FOLDER,h.CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.__constructClientPayload=function(n,o,p,q){return {actions:n.map(function(r){return l({action_type:o,action_id:null,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,j);e.exports=m;},null);
__d("MercuryShareAttachmentSnippet.react",["MercuryShareAttachmentReactShape","MercuryShareStyleMap","React"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=i,k=j.PropTypes,l=i.createClass({displayName:"MercuryShareAttachmentSnippet",propTypes:{attachment:g,isSenderViewer:k.bool,senderName:k.string},render:function(){var m=this.props.attachment;if(!m.style_list)return null;for(var n=0;n<m.style_list.length;n++){var o=h.get(m.style_list[n]);if(o&&!!o.getSnippetComponent){var p=o.getSnippetComponent();return (i.createElement(p,i.__spread({},this.props)));}}return null;}});e.exports=l;},null);
__d("ImageSourceType",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};e.exports=g;},null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher","arrayContains","extendArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(){"use strict";this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}n.prototype.setFBID=function(r){"use strict";this._request.fbid=r;return this;};n.prototype.setType=function(r){"use strict";if(!l([h.PROFILE_PICTURE,h.IMAGE],r))throw new TypeError('ImageSourceRequest.setType: invalid type '+r);this._request.type=r;return this;};n.prototype.setDimensions=function(r,s){"use strict";this._request.width=r;this._request.height=s;return this;};n.prototype.setResizeMode=function(r){"use strict";if(!l([j.COVER,j.CONTAIN],r))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+r);this._request.resize_mode=r;return this;};n.prototype.setCallback=function(r){"use strict";this._callback=r;return this;};n.prototype.send=function(){"use strict";if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var r=p(),s=q(this._request);r.executeOrEnqueue(s,this._callback);if(r.getUnavailableResourcesFromRequest(s).length===1){k.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var o=null;function p(){if(o)return o;var r=new i();o=r;k.registerEndpoints({'/ajax/image_source.php':{request_user_id:g.getID(),mode:k.BATCH_DEFERRED_MULTI,batch_function:function(s,t){m(s.requests,t.requests);return s;},handler:function(s,t){var u=t.getData().requests;for(var v=0;v<u.length;++v)r.setResource(q(u[v]),s[v]);}}});return r;}function q(r){return [r.fbid,r.type,r.width,r.height,r.resize_mode].join('|');}e.exports=n;},null);
__d("MercuryParticipantFetcher",["MercuryIDs","MercuryPayloadSource","MercuryServerRequests","Set","ShortProfiles","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';function m(o){this.$MercuryParticipantFetcher0=i.getForFBID(o);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new j();this.$MercuryParticipantFetcher3=new j();}m.prototype.fetch=function(o){this.$MercuryParticipantFetcher4(o);this.$MercuryParticipantFetcher5();};m.prototype.fetchMulti=function(o){o.forEach(function(p){return this.$MercuryParticipantFetcher4(p);}.bind(this));this.$MercuryParticipantFetcher5();};m.prototype.$MercuryParticipantFetcher4=function(o){if(!this.$MercuryParticipantFetcher3.has(o))this.$MercuryParticipantFetcher2.add(o);};m.prototype.$MercuryParticipantFetcher5=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;l(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(o){return this.$MercuryParticipantFetcher3.add(o);}.bind(this));this.$MercuryParticipantFetcher6(this.$MercuryParticipantFetcher2,function(o){o.forEach(function(p){return this.$MercuryParticipantFetcher3["delete"](p.id);}.bind(this));this.$MercuryParticipantFetcher7(o);}.bind(this));this.$MercuryParticipantFetcher2.clear();}.bind(this));};m.prototype.$MercuryParticipantFetcher6=function(o,p){var q=[];o.forEach(function(r){var s=g.tokenize(r),t=s.type,u=s.value;t==='fbid'&&q.push(u);});if(q.length>0)k.getMulti(q,function(r){var s=[];for(var t in r)s.push(n(r[t],t));p(s);});};m.prototype.$MercuryParticipantFetcher7=function(o){this.$MercuryParticipantFetcher0.handleUpdate({participants:o,from_client:false,payload_source:h.SERVER_FETCH_PARTICIPANTS});};function n(o,p){var q=Object.assign({gender:o.gender,href:o.uri,id:g.getParticipantIDFromUserID(o.id||p),image_src:o.thumbSrc,name:o.name,short_name:o.firstName,employee:o.employee,is_employee_away:o.is_employee_away,type:o.type,vanity:o.vanity,is_friend:o.is_friend,is_messenger_user:o.is_messenger_user,orion_eligible:o.orionEligible,social_snippets:o.social_snippets},{});if(o.officeStatus){q.officeStatus=o.officeStatus;q.officeStatusStartDate=o.officeStatusStartDate;q.officeStatusEndDate=o.officeStatusEndDate;q.officeStatusComment=o.officeStatusComment;q.officeStatusLocation=o.officeStatusLocation;}return q;}e.exports=m;},null);
__d("MercuryParticipants",["CurrentUser","EventEmitter","ImageSourceRequest","ImageSourceType","ImmutableObject","KeyedCallbackManager","Map","MercuryAssert","MercuryIDs","MercuryParticipantFetcher","MercuryParticipantTypes","MercuryParticipantsConstants","MercuryServerRequests","PhotoResizeModeConst","Set","fbt","mapObject"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();'use strict';var x='change';function y(aa){this.$MercuryParticipants0=aa;this.$MercuryParticipants1=new h();this.$MercuryParticipants2=new l();this.$MercuryParticipants3=new p(this.$MercuryParticipants0);this.$MercuryParticipants4=new m();this.$MercuryParticipants5=s.getForFBID(this.$MercuryParticipants0);this.$MercuryParticipants5.subscribe('update-participants',function(ba,ca){if(ca.participants&&ca.participants.length>0){var da={};ca.participants.forEach(function(ea){da[ea.id]=ea;});this.$MercuryParticipants6(da);}}.bind(this));}y.prototype.addListener=function(aa,ba){return this.$MercuryParticipants1.addListener(aa,ba);};y.prototype.getIDFromVanityOrFBID=function(aa){if(!aa)return;if(this.$MercuryParticipants4.has(aa))return this.$MercuryParticipants4.get(aa);if(/^\d+$/.test(aa))return o.getParticipantIDFromUserID(aa);};y.prototype.getNow=function(aa){return this.$MercuryParticipants7(aa);};y.prototype.getOrFetch=function(aa){var ba=this.$MercuryParticipants7(aa);if(!ba)this.$MercuryParticipants3.fetch(aa);return ba;};y.prototype.get=function(aa,ba){n.isParticipantID(aa);return this.$MercuryParticipants8([aa],function(ca){ba(ca[aa]);});};y.prototype.getMulti=function(aa,ba){return this.$MercuryParticipants8(aa,ba);};y.prototype.getBigImageMulti=function(aa,ba){n.allParticipantIDs(aa);var ca=r.BIG_IMAGE_SIZE;return this.$MercuryParticipants8(aa,function(da){var ea={},fa=0,ga=new u(),ha=function(la,ma){fa++;ea[la]=ma;if(fa===aa.length){ba(ea);if(ga.size>0)this.$MercuryParticipants9(ga);}}.bind(this),ia=function(la,ma){this.$MercuryParticipants2.setResource(la,k.set(this.$MercuryParticipants2.getResource(la),{big_image_src:ma.uri}));ga.add(la);ha(la,ma.uri);}.bind(this);for(var ja in da){var ka=da[ja];if(!ka.big_image_src){new i().setFBID(o.getUserIDFromParticipantID(ja)).setType(j.PROFILE_PICTURE).setDimensions(ca,ca).setResizeMode(t.COVER).setCallback(ia.bind(null,ja)).send();}else ha(ka.id,ka.big_image_src);}}.bind(this));};y.prototype.getOrderedBigImageMulti=function(aa,ba){return this.getBigImageMulti(aa,function(ca){ba(aa.map(function(da){return ca[da];}));});};y.prototype.$MercuryParticipants8=function(aa,ba){n.allParticipantIDs(aa);var ca=this.$MercuryParticipants2.executeOrEnqueue(aa,ba),da=this.$MercuryParticipants2.getUnavailableResources(ca).filter(function(ea){var fa=o.tokenize(ea),ga=fa.type,ha=fa.value;if(ga==='email'){this.$MercuryParticipantsa(ea,ha);return false;}return true;}.bind(this));this.$MercuryParticipants3.fetchMulti(da);return this.$MercuryParticipantsb(ca);};y.prototype.$MercuryParticipants7=function(aa){var ba=this.$MercuryParticipants2.getResource(aa);if(!ba){var ca=o.tokenize(aa),da=ca.type,ea=ca.value;if(da==='email')ba=this.$MercuryParticipantsa(aa,ea);}return ba;};y.prototype.$MercuryParticipantsa=function(aa,ba){var ca=new k(z(aa,ba));this.$MercuryParticipants2.setResource(aa,ca);return ca;};y.prototype.$MercuryParticipants9=function(aa){this.$MercuryParticipants1.emit(x,aa);};y.prototype.$MercuryParticipants6=function(aa){aa=w(aa,function(ba,ca){if(ba.vanity)this.$MercuryParticipants4.set(ba.vanity,ca);return new k(this.$MercuryParticipantsc(ba));}.bind(this));this.$MercuryParticipants2.addResourcesAndExecute(aa);this.$MercuryParticipants9(new u(Object.keys(aa)));};y.prototype.$MercuryParticipantsc=function(aa){var ba=aa.type===q.USER||aa.type===q.FRIEND;if(!ba)return aa;if(!aa.name&&!aa.href&&!aa.vanity){var ca=v._("Facebook User");aa.name=ca;aa.short_name=ca;}return aa;};y.prototype.$MercuryParticipantsb=function(aa){return {remove:function(){this.$MercuryParticipants2.unsubscribe(aa);}.bind(this)};};function z(aa,ba){return {gender:r.UNKNOWN_GENDER,href:null,id:aa,image_src:r.EMAIL_IMAGE,big_image_src:r.EMAIL_IMAGE,name:ba,short_name:ba,employee:false};}e.exports=new y(g.getID());},null);
__d("MercuryAttachmentSnippet.react",["EmoticonsList","Image.react","MercuryAttachment","MercuryAttachmentSnippetRenderer","MercuryAttachmentSnippetType","MercuryAttachmentType","MercuryIDs","P2PMercuryAttachmentSnippet.react","MercuryShareAttachmentSnippet.react","MercuryParticipants","React","StickerConstants","TextWithEmoticons.react","cx","ix","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();'use strict';var w=q,x=w.PropTypes,y=q.createClass({displayName:"MercuryAttachmentSnippet",propTypes:{thread:x.object.isRequired,viewer:x.string.isRequired},componentWillMount:function(){this._ensureParticipant(this.props.thread.snippet_sender);this._setVariables(this.props);},componentWillReceiveProps:function(ba){this._ensureParticipant(ba.thread.snippet_sender);this._setVariables(ba);},componentWillUnmount:function(){this._cancelParticipantFetch();},render:function(){var ba=this._getSenderName(),ca=j.getAttachmentSnippetType(this._attachments);switch(ca){case k.PHOTO:return this._renderPhotoSnippet(ba);case k.GIF:return this._renderAnimatedImageSnippet(ba);case k.VIDEO:return this._renderVideoSnippet(ba);case k.AUDIO_CLIP:return this._renderAudioClipSnippet(ba);case k.STICKER:return this._renderStickerSnippet(ba);case k.ORION:return this._renderOrionSnippet(ba);case k.SHARE:return this._renderShareSnippet(ba);case k.ERROR:return this._renderError(ba);default:return this._renderMixedSnippet(ba);}},_renderPhotoSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.PHOTO,this._isViewerSender,ba,this._attachments));},_renderAnimatedImageSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.GIF,this._isViewerSender,ba,this._attachments));},_renderVideoSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.VIDEO,this._isViewerSender,ba));},_renderAudioClipSnippet:function(ba){return this._renderSnippet(j.renderAttachmentSnippetText(k.AUDIO_CLIP,this._isViewerSender,ba));},_renderStickerSnippet:function(ba){if(z(this._attachments[0].metadata.stickerID)){return (q.createElement(s,{renderEmoticons:true,text:g.symbols.like}));}else return (q.createElement("span",null,j.renderAttachmentSnippetText(k.STICKER,this._isViewerSender,ba)));},_renderOrionSnippet:function(ba){return (q.createElement("span",null,q.createElement(n,q.__spread({},this._attachments[0].metadata))));},_renderShareSnippet:function(ba){if(!!this._attachments[0].share)return (q.createElement(o,{attachment:this._attachments[0].share,senderName:ba,isViewerSender:this._isViewerSender}));return this._renderSnippet(j.renderAttachmentSnippetText(k.SHARE,this._isViewerSender,ba));},_renderMixedSnippet:function(ba){return (q.createElement("span",null,this._attachments.filter(function(ca){return ca.attach_type===l.FILE||ca.attach_type===l.PHOTO||ca.attach_type===l.VIDEO;}).map(function(ca,da){return this._renderSnippet(ca.name,ca.icon_type,da);}.bind(this))));},_renderSnippet:function(ba,ca,da){var ea=i.getAttachIconClass(ca||this._attachments[0].icon_type),fa=v(ea,"uiIconText _3l6h");return (q.createElement("span",{className:fa,key:da},q.createElement(h,{src:u('/images/messaging/docs/generic.png')}),ba));},_renderError:function(ba){var ca=j.renderAttachmentSnippetText(k.ERROR,this._isViewerSender,ba);return this._renderSnippet(ca);},_setVariables:function(ba){this._viewer=ba.viewer;this._sender=ba.thread.snippet_sender;this._attachments=ba.thread.snippet_attachments;this._isViewerSender=aa(this._sender,this._viewer);},_getSenderName:function(){if(!this._sender||this._isViewerSender)return null;var ba=p.getNow(this._sender);if(!ba)return null;return ba.short_name;},_ensureParticipant:function(ba){if(!ba)return;this._cancelParticipantFetch();if(!p.getNow(ba))this._sub=p.get(ba,function(ca){return this.forceUpdate();}.bind(this));},_cancelParticipantFetch:function(){this._sub&&this._sub.remove();}});function z(ba){return (ba==r.LIKE_STICKER_ID||ba==r.HOT_LIKE_SMALL_STICKER_ID||ba==r.HOT_LIKE_MEDIUM_STICKER_ID||ba==r.HOT_LIKE_LARGE_STICKER_ID);}function aa(ba,ca){return !!(ba&&m.getParticipantIDFromUserID(ca)==ba);}e.exports=y;},null);
__d("MercuryParticipantsImage.react",["MercuryParticipants","React","SplitImage.react","areEqual"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=h,l=k.PropTypes,m=h.createClass({displayName:"MercuryParticipantsImage",_bigImageToken:(null),propTypes:{participants:l.array.isRequired,size:l.number},getInitialState:function(){return {participantImages:[]};},componentDidMount:function(){this._getParticipantImages(this.props);},componentWillReceiveProps:function(n){this._getParticipantImages(n);},componentWillUnmount:function(){this._bigImageToken&&this._bigImageToken.remove();},shouldComponentUpdate:function(n,o){return (n.size!==this.props.size||!o||!j(o.participantImages,this.state.participantImages));},render:function(){if(this.state.participantImages.length>0)return (h.createElement(i,{border:true,className:this.props.className,srcs:this.state.participantImages,size:this.props.size}));return null;},_getParticipantImages:function(n){this._bigImageToken&&this._bigImageToken.remove();(this)._bigImageToken=g.getOrderedBigImageMulti(n.participants,function(o){this.isMounted()&&this.setState({participantImages:o});}.bind(this));}});e.exports=m;},null);
__d("MercuryThreadImage.react",["ImmutableObject","MercuryIDs","MercuryParticipantsImage.react","MercuryParticipantsConstants","Pixelz.react","React","areEqual"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();'use strict';var n=l,o=n.PropTypes,p=l.createClass({displayName:"MercuryThreadImage",propTypes:{thread:o.instanceOf(g).isRequired,viewer:o.string.isRequired,size:o.number,useBackground:o.bool},shouldComponentUpdate:function(q,r){return (q.thread.image_src!==this.props.thread.image_src||!m(q.thread.participants,this.props.thread.participants)||q.size!==this.props.size||q.viewer!==this.props.viewer||q.useBackground!==this.props.useBackground);},render:function(){var q=this.props.size||j.BIG_IMAGE_SIZE,r=this.props.thread.image_src;if(r){if(this.props.useBackground)return (l.createElement("div",{style:{height:q,backgroundImage:("url("+r+")"),backgroundPosition:'50% 50%',backgroundRepeat:'no-repeat',backgroundSize:'cover',width:q}}));return (l.createElement(k,{height:q,resizeMode:'cover',src:r,width:q}));}var s=h.getParticipantIDFromUserID(this.props.viewer),t=this.props.thread.participants.filter(function(v){return v!==s;}),u=[];if(!t.length){u=[s];}else if(t.length==1){u=t;}else u=t.slice(0,3);return (l.createElement(i,{participants:u,size:q}));}});e.exports=p;},null);
__d("MercuryParticipantListRenderer",["fbt"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';function h(){this.$MercuryParticipantListRenderer0=false;this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=function(r){return this.$MercuryParticipantListRenderer1?r.short_name:r.name;}.bind(this);}h.prototype.renderParticipantList=function(r){var s=r.map(this.$MercuryParticipantListRenderer3);switch(s.length){case 0:return i(this.$MercuryParticipantListRenderer0);case 1:return j(s);case 2:return this.$MercuryParticipantListRenderer2?l(s):k(s);case 3:return this.$MercuryParticipantListRenderer2?n(s):m(s);default:return this.$MercuryParticipantListRenderer2?p(s):o(s);}};h.prototype.setIsNewThread=function(r){this.$MercuryParticipantListRenderer0=r;return this;};h.prototype.setNameRenderer=function(r){this.$MercuryParticipantListRenderer3=r;return this;};h.prototype.setUseShortName=function(r){this.$MercuryParticipantListRenderer1=r;return this;};h.prototype.setUseAndSeparator=function(r){this.$MercuryParticipantListRenderer2=r;return this;};function i(r){if(r){return (g._("New Message"));}else return (g._("No Participants"));}function j(r){return r[0];}function k(r){return (g._("{participant1}, {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function l(r){return (g._("{participant1} and {participant2}",[g.param("participant1",r[0]),g.param("participant2",r[1])]));}function m(r){return (g._("{participant1}, {participant2}, {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function n(r){return (g._("{participant1}, {participant2} and {participant3}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2])]));}function o(r){return (g._("{participant1}, {participant2}, {participant3}, {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("participant3",r[2]),g.param("others_link",q(r.length-3))]));}function p(r){return (g._("{participant1}, {participant2} and {others_link}",[g.param("participant1",r[0]),g.param("participant2",r[1]),g.param("others_link",q(r.length-2))]));}function q(r){if(r>1){return (g._({"*":"{others_count} others"},[g.param("others_count",r,[0])]));}else return (g._("1 other"));}e.exports=h;},null);
__d("MercuryThreadTitle.react",["MercuryIDs","MercuryParticipantListRenderer","MercuryParticipants","React","TextWithEmoticons.react","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=j,n=m.PropTypes,o=j.createClass({displayName:"MercuryThreadTitle",propTypes:{isNewThread:n.bool,thread:n.object.isRequired,viewer:n.string.isRequired,showUnreadCount:n.bool,useShortName:n.bool,useAndSeparator:n.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(p){this._renderParticipantsList(p);},render:function(){return (j.createElement("span",{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var p=this.props.thread,q=j.createElement(k,{renderEmoticons:true,renderEmoji:true,text:p.name});if(!p.unread_count||!this.props.showUnreadCount)return q;return this._renderTitleWithUnreadCount(q,p.unread_count);},_renderParticipantsList:function(p){if(p.thread.name)return;var q=g.getParticipantIDFromUserID(p.viewer),r=p.thread.participants;if(r.length>1)r=r.filter(function(s){return s!=q;});i.getMulti(r,function(s){if(!this.isMounted())return;var t=r.map(function(w){return s[w];}),u=new h().setUseShortName(this.props.useShortName).setUseAndSeparator(this.props.useAndSeparator).setIsNewThread(this.props.isNewThread).renderParticipantList(t),v=(p.showUnreadCount&&p.thread.unread_count)?this._renderTitleWithUnreadCount(u,p.thread.unread_count):u;this.setState({participantNames:v});}.bind(this));},_renderTitleWithUnreadCount:function(p,q){return (l._("{conversation-title} ({unread-count})",[l.param("conversation-title",p),l.param("unread-count",q)]));}});e.exports=o;},null);
__d("WebMessengerThreadPermalinks",["MercuryIDs","MessagingTag","URI","WebMessengerPermalinkConstants","WWWBase","requireWeak"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m={getThreadURI:function(q,r,s){if(g.isCanonical(q)){n(q,r,s);}else o(q,r,s);}};function n(q,r,s){var t=new i(k.uri),u=g.tokenize(q).value;t.setPath(p(s)+'/'+u);r&&r(t.toString());}function o(q,r,s){l(['MercuryServerRequests'],function(t){var u=t.get();u.getServerThreadID(q,function(v){var w=new i(k.uri);w.setPath(j.getURIPathForThreadID(v,p(s)));r&&r(w.toString());});});}function p(q){var r=j.BASE_PATH;if(q&&q!=h.INBOX)r+='/'+q;return r;}e.exports=m;},null);
__d("MercuryTypeaheadDataSource",["Banzai","BanzaiLogger","CurrentUser","DataSource","MercuryParticipantTypes","MercuryTypeaheadConstants","OrderedFriendsList","ShortProfiles","WorkModeConfig","debounce","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){b.__markCompiled&&b.__markCompiled();var r=500,s=[],t={},u={},v={},w=false,x=false;for(var y in j)if(j.hasOwnProperty(y))aa[y]=j[y];var z=j===null?null:j.prototype;aa.prototype=Object.create(z);aa.prototype.constructor=aa;aa.__superConstructor__=j;function aa(ba){"use strict";ba=ba||{};ba.kanaNormalization=true;j.call(this,ba);this.logQuery=p(function(ca){this.$MercuryTypeaheadDataSource0(ca);},r,this,true);this.logResponse=p(function(ca){this.$MercuryTypeaheadDataSource0(ca);},r,this,true);}aa.prototype.dirty=function(){"use strict";this.$MercuryTypeaheadDataSource1=s;this.localCache=u;this.queryCache=t;this.queryIDs=v;return this;};aa.prototype.bootstrap=function(){"use strict";if(w||x)return false;this.$MercuryTypeaheadDataSource0({event:'bootstrap_start'});x=true;n.fetchAll().then(function(){this.updateBootstrapData();this.$MercuryTypeaheadDataSource0({event:'bootstrap_end'});x=false;w=true;}.bind(this),function(){this.$MercuryTypeaheadDataSource0({event:'bootstrap_failure'});}.bind(this));return true;};aa.prototype.updateBootstrapData=function(){"use strict";var ba=this.getCachedShortProfileIDs(),ca=o.is_work_user?k.FB4C:k.FRIEND,da=ba.map(function(ea){var fa=n.getNow(ea),ga=ea==i.getID()?ca:fa.type,ha=[fa.additionalName,fa.alternateName].concat(fa.searchTokens||[]).join(' ');return {uid:ea,index:m.getActiveRank(ea),text:fa.name,tokens:ha,localized_text:fa.name,additional_text:fa.additionalName,photo:fa.thumbSrc,render_type:ga,type:l.USER_TYPE};});if(da.length)this.addEntries(da);};aa.prototype.query=function(ba,ca,da,ea){"use strict";var fa=ca||ba.length===1;return z.query.call(this,ba,fa,da,ea);};aa.prototype.getQueryData=function(ba,ca){"use strict";return q(z.getQueryData.call(this,ba,ca),{needs_friends:!this.isBootstrapped()});};aa.prototype.setEntry=function(ba,ca){"use strict";this.$MercuryTypeaheadDataSource1[ba]=ca;};aa.prototype.getEntry=function(ba){"use strict";return this.$MercuryTypeaheadDataSource1[ba]||null;};aa.prototype.getCachedShortProfileIDs=function(){"use strict";var ba=n.getCachedProfileIDs(),ca=ba.filter(function(da){var ea=n.getNow(da);return (da==i.getID()||ea.type===k.FRIEND);});return ca;};aa.prototype.isBootstrapped=function(){"use strict";return w;};aa.prototype.isBootstrapping=function(){"use strict";return x;};aa.prototype.$MercuryTypeaheadDataSource0=function(ba){"use strict";if(!g.isEnabled('mercury_typeahead_logging'))return;h.log('MercuryQueryResultsLoggerConfig',ba);};e.exports=aa;},null);
__d("MercuryMessageInfo",["MercuryActionStatus","MercuryViewer"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={isOutbound:function(j){return j.author===h.getID();},isInbound:function(j){return !i.isOutbound(j);},isSending:function(j){return (j.status===g.UNSENT||j.status===g.UNCONFIRMED||j.status===g.UNABLE_TO_CONFIRM||j.status===g.RESENDING);},hasError:function(j){return (j.status===g.FAILED_UNKNOWN_REASON||j.status===g.UNABLE_TO_CONFIRM||j.status===g.ERROR);}};e.exports=i;},null);
__d("MercuryErrorInfo",["MercuryErrorType","MercuryMessageInfo","fbt"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j={getMessage:function(k){var l='';if(j.isConnectionError(k)){l=i._("This message didn't send.");if(j.isTransient(k))l=i._("{message} Check your internet connection and click to try again.",[i.param("message",l)]);}else{if(k&&k.description){l=k.description;}else l=i._("This message failed to send.");if(j.isTransient(k))l=i._("{message} Click to send again.",[i.param("message",l)]);}return l;},isConnectionError:function(k){if(k&&k.type==g.TRANSPORT)return k.code===1001||k.code===1004||k.code===1006;return false;},isTransient:function(k){return k&&k.is_transient;},isPermanent:function(k){return k?!this.isTransient(k):false;},hasErrorStatus:function(k){return h.hasError(k);}};e.exports=j;},null);
__d("MercuryThreadInfo",["CurrentUser","MercuryThreadMode"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={canReply:function(k){return !!(k.is_subscribed&&k.mode!=h.OBJECT_ORIGINATED&&!k.has_email_participant&&!k.read_only&&(k.recipients_loadable||k.recipients_loadable===(void 0)));},getMuteSetting:function(k){return (k.mute_settings&&k.mute_settings[j(g.getID())]);},isMuted:function(k){return i.getMuteSetting(k)!==(void 0);}};function j(k){return k+'@facebook.com';}e.exports=i;},null);
__d("MercuryMessages",["AsyncRequest","BanzaiODS","CurrentUser","EventEmitter","ImmutableObject","LogHistory","Map","MercuryActionStatus","MercuryActionType","MercuryAssert","MercuryAttachmentType","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySingletonMixin","MercuryMessageActions","MercuryMessageIDs","RangedCallbackManager","MercurySendMessageFields","MercuryServerRequests","MercuryThreadActions","MercuryThreadInformer","MercuryThreads","URI","copyProperties","debounceAcrossTransitions","invariant","isMessengerDotComURI","mergeDeep"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){b.__markCompiled&&b.__markCompiled();'use strict';var ja=new j(),ka=l.getInstance('mercury_messages');function la(xa,ya){var za=ya;if(xa._localIdsMap[ya])za=xa._localIdsMap[ya];return xa._messages.get(za);}function ma(xa){switch(xa){case t.UNKNOWN:case t.SERVER_INITIAL_DATA:case t.SERVER_FETCH_THREAD_INFO:case t.SERVER_THREAD_SYNC:return true;}return false;}function na(xa,ya){if(!xa._threadsToMessages[ya])xa._threadsToMessages[ya]=new x(function(za){return la(xa,za).timestamp;},function(za,ab){return ab-za;});return xa._threadsToMessages[ya];}function oa(xa,ya,za){ya.forEach(function(ab){var bb=na(xa,ab);bb.setReachedEndOfArray();xa._emitReorderedChange(ab,za);});}function pa(xa){this._fbid=xa;this._messageActions=v.getForFBID(this._fbid);this._serverRequests=z.getForFBID(this._fbid);this._threadInformer=ba.getForFBID(this._fbid);this._threads=ca.getForFBID(this._fbid);this._threadActions=aa.getForFBID(this._fbid);this._didChange=false;this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new m();this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(ya,za){var ab=(za.actions||[]).filter(function(cb){var db=cb.action_type,eb=((cb.is_forward||cb.thread_id)&&(db==o.LOG_MESSAGE||db==o.USER_GENERATED_MESSAGE||db==o.SEND_MESSAGE||db==o.DELETE_THREAD||db==o.DELETE_MESSAGES||db==o.MARK_MESSAGES_SPAM)),fb=((cb.upload_id&&cb.upload_data)&&(db==o.CANCEL_ATTACHMENT_PLACEHOLDER||db==o.CONFIRM_ATTACHMENT_PLACEHOLDER)),gb=(db==o.ADD_SHARE_DATA_TO_EXISTING_MESSAGE&&(cb.server_id&&cb.attach_key&&cb.attach_data));return (eb||fb||gb);}),bb=ma(za.payload_source);this.handleUpdates(ab,bb,za.payload_source,za.from_client);if(za.end_of_history)oa(this,za.end_of_history,za.payload_source);if(this._didChange){this._didChange=false;ja.emit('change');}}.bind(this));ka.debug('constructed',{fbid:this._fbid});}ea(pa.prototype,{getMessagesFromIDs:function(xa){return (xa||[]).map(la.bind(null,this)).filter(function(ya){return ya;});},hasLoadedNMessages:function(xa,ya){var za=na(this,xa);return za.hasReachedEndOfArray()||za.getCurrentArraySize()>=ya;},hasLoadedExactlyNMessages:function(xa,ya){var za=na(this,xa);return za.getCurrentArraySize()==ya;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new m();this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};},getThreadMessagesRange:function(xa,ya,za,ab,bb,cb){var db=na(this,xa),eb=function(mb){ab(qa(this,mb));}.bind(this),fb=db.executeOrEnqueue(ya,za,eb),gb=db.getUnavailableResources(fb),hb=this._failedHistoryFetchThreads[xa];if(gb.length&&!hb){var ib=db.getCurrentArraySize(),jb=this._localTitanMessagesCount[xa]||0,kb=ib-jb,lb=gb.length+jb;ka.debug('fetch_missing_messages',{threadID:xa,offset:ya,limit:za,missingIndices:gb,messageCount:ib,localMessageCount:jb});this._serverRequests.fetchThreadMessages(xa,kb,lb,bb,cb);}else this._failedHistoryFetchThreads[xa]=false;return fb;},getThreadMessagesRangeNow:function(xa,ya,za){var ab=na(this,xa),bb=[];for(var cb=ya;cb<ya+za;cb++){var db=ab.getResourceAtIndex(cb),eb=la(this,db);eb&&bb.push(eb);}return bb;},getThreadMessagesSinceTimestamp:function(xa,ya){var za=na(this,xa),ab=za.getElementsUntil(ya);return qa(this,ab);},hasLoadedAllMessages:function(xa){return na(this,xa).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(xa){var ya=na(this,xa).getAllResources();return qa(this,ya);},unsubscribe:function(xa,ya){p.isThreadID(ya);var za=na(this,ya);za.unsubscribe(xa);},_addNewMessage:function(xa,ya){ta(this,ya);ua(ya);this._messages.set(xa,new k(ya));},_updateMessage:function(xa,ya,za){var ab=k.set(ya,za);this._messages.set(xa,ab);return ab;},_addAttachmentData:function(xa,ya,za){var ab=la(this,xa);if(ab){var bb=ab.attachments.indexOf(ya);if(bb!=-1){this._updateMessage(xa,ab,{attachments:ab.attachments.map(function(cb,db){return (db===bb)?za:cb;})});this._emitUpdatedChange(ab.thread_id,ab.message_id,'attach');}}else{if(!this._attachmentData[xa])this._attachmentData[xa]=[];this._attachmentData[xa].push({attach_key:ya,data:za});}},_shouldSortOutOfOrderMessages:function(xa,ya,za){if(xa==t.CLIENT_CHANNEL_MESSAGE){var ab=this.getThreadMessagesSinceTimestamp(ya,za);if(ab.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},_preprocessIncomingAction:function(xa,ya){var za=xa.action_type;if(ya==t.CLIENT_CHANNEL_MESSAGE&&za==o.USER_GENERATED_MESSAGE&&xa.threading_id&&this._localIdsMap[xa.threading_id]===xa.threading_id){xa.client_message_id=xa.threading_id;xa.status=n.SUCCESS;xa.action_type=o.SEND_MESSAGE;za=xa.action_type;}if(ya===t.CLIENT_CHANNEL_MESSAGE&&za==o.USER_GENERATED_MESSAGE){var ab=this._threads.getThreadMetaNow(xa.thread_id);if(ab&&ab.folder)xa.folder=ab.folder;}return xa;},handleUpdates:function(xa,ya,za,ab){var bb,cb={},db={};for(var eb=0;eb<xa.length;eb++){var fb=this._preprocessIncomingAction(xa[eb],za),gb=fb.action_type,hb=la(this,fb.message_id);if(fb.is_forward||za==t.SERVER_SEARCH){if(!this._messages.has(fb.message_id))this._addNewMessage(fb.message_id,fb);continue;}else if(fb.client_state===s.SEND_TO_SERVER){this._addNewMessage(fb.message_id,fb);continue;}else if(gb==o.SEND_MESSAGE){var ib=fb.client_message_id;if(ib&&this._localIdsMap[ib]&&fb.status){var jb=la(this,ib),kb=jb.status;if(jb.status==n.SUCCESS)continue;if(fb.status==n.UNCONFIRMED){if(!db[fb.thread_id])db[fb.thread_id]=[];db[fb.thread_id].push(ib);}else if(!cb[fb.thread_id])cb[fb.thread_id]=[];this._updateLocalMessage(fb);if(typeof kb!==(void 0)||fb.status==n.FAILED_UNKNOWN_REASON||fb.status==n.UNABLE_TO_CONFIRM||fb.status==n.SUCCESS||fb.status==n.ERROR)this._emitUpdatedChange(fb.thread_id,la(this,ib).message_id,za);}continue;}else if(gb==o.DELETE_THREAD){na(this,fb.thread_id).removeAllResources();continue;}else if(gb==o.DELETE_MESSAGES){this._deleteMessages(fb.thread_id,fb.message_ids,za);continue;}else if(gb===o.MARK_MESSAGES_SPAM){this._markMessagesSpam(fb,za);continue;}else if((fb.threading_id&&this._localIdsMap[fb.threading_id])||(hb&&!hb.is_forward)){if(hb&&fb.ranges&&fb.ranges.length>0){var lb=hb.message_id;this._updateMessage(this._localIdsMap[lb]||lb,hb,{ranges:xa.ranges});this._emitUpdatedChange(hb.thread_id,hb.message_id,'link_shim');}continue;}else if(gb===o.CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(fb.upload_id,fb.upload_data);continue;}else if(gb===o.CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(fb.upload_id,fb.upload_data);continue;}else if(gb===o.ADD_SHARE_DATA_TO_EXISTING_MESSAGE){this._addAttachmentData(fb.server_id,fb.attach_key,fb.attach_data);continue;}else{if(za===t.CLIENT_SEND_MESSAGE){this._localIdsMap[fb.message_id]=fb.message_id;if(fb.thread_id=='root:'+fb.message_id)na(this,fb.thread_id).setReachedEndOfArray();}if(gb==o.LOG_MESSAGE&&fb.log_message_type==r.SERVER_ERROR)this._failedHistoryFetchThreads[fb.thread_id]=true;if(fb.client_state===s.DO_NOT_SEND_TO_SERVER&&fb.upload_id)this._uploadMessages[fb.upload_id]=fb;if(!cb[fb.thread_id])cb[fb.thread_id]=[];cb[fb.thread_id].push(fb.message_id);this._addNewMessage(fb.message_id,fb);if(fb.threading_id&&fb.threading_id!=fb.message_id)w.addServerID(fb.threading_id,fb.message_id);if(fb[y.MANUAL_RETRY_CNT]>0){bb=na(this,fb.thread_id);bb.resortResources([fb.message_id]);this._emitReorderedChange(fb.thread_id,t.CLIENT_SEND_MESSAGE);}ya=ya||this._shouldSortOutOfOrderMessages(za,fb.thread_id,fb.timestamp);if(!ya)this._emitReceivedChange(la(this,fb.message_id));continue;}}for(var mb in cb){bb=na(this,mb);var nb=bb.getAllResources(),ob=nb.filter(function(qb){var rb=this._messages.get(qb);return rb.action_type==o.LOG_MESSAGE&&rb.log_message_type==r.SERVER_ERROR;}.bind(this));bb.removeResources(ob);if(ab)ra(this,mb,cb[mb]);if(ya){bb.addResources(cb[mb]);this._emitReorderedChange(mb,za);}else bb.addResourcesWithoutSorting(cb[mb].reverse(),0);this._threadInformer.updatedThread(mb);}var pb=Object.keys(db);if(pb.length)this._serverRequests.requestMessageConfirmation(db);ka.debug('handle_updates',{localMessageCounts:ia(this._localTitanMessagesCount)});},isFirstMessage:function(xa){var ya=na(this,xa.thread_id);if(ya.getCurrentArraySize()===0)return false;var za=ya.getResourceAtIndex(ya.getCurrentArraySize()-1),ab=la(this,za).message_id,bb=la(this,xa.message_id).message_id;return ya.hasReachedEndOfArray()&&ab==bb;},_markMessagesSpam:function(xa,ya){var za=xa,ab=za.thread_id,bb=za.message_ids;if(!bb.length)return;this._deleteIndividualMessages(ab,bb,ya);this._serverRequests.markMessagesSpam(ab,bb);},_deleteMessages:function(xa,ya,za){if(!ya.length)return;this._deleteIndividualMessages(xa,ya,za);if(za!==t.CLIENT_CHANNEL_MESSAGE)this._serverRequests.deleteMessages(xa,ya);},_deleteIndividualMessages:function(xa,ya,za){var ab=ya.map(function(cb){return la(this,cb).message_id;},this),bb=na(this,xa);bb.removeResources(ab);this._emitReorderedChange(xa,za);},_updateLocalMessage:function(xa){var ya=la(this,xa.client_message_id),za={};za.status=xa.status;if(xa.status===n.SUCCESS||xa.error_data)za.error_data=xa.error_data;var ab=xa.message_id,bb=xa.client_message_id;if(this._messages.has(ab)){this._updateMessage(ab,ya,za);return false;}if(xa.timestamp)za.timestamp=xa.timestamp;if(xa.log_message_data)za.log_message_data=xa.log_message_data;if(xa.ranges&&xa.ranges.length){ua(xa);za.ranges=xa.ranges;}if(xa.attachments&&xa.attachments.length){za.raw_attachments=null;za.attachments=xa.attachments;ta(this,za,ab);}this._localIdsMap[bb]=ab;w.addServerID(bb,ab);var cb=this._updateMessage(ab,ya,za);this._messages.set(bb,new k());if(sa(cb))this._localTitanMessagesCount[cb.thread_id]--;return true;},getNumberLocalMessages:function(xa){return this._localTitanMessagesCount[xa]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(xa,ya){var za=this._popPendingAttachmentMessage(xa,ya);this._serverRequests.sendNewMessage(za);},_cancelAttachmentPlaceholder:function(xa,ya){var za=this._popPendingAttachmentMessage(xa,ya);this._deleteIndividualMessages(za.thread_id,[za.message_id]);if(this._localTitanMessagesCount[za.thread_id])this._localTitanMessagesCount[za.thread_id]--;},_popPendingAttachmentMessage:function(xa,ya){var za=this._uploadMessages[xa];ga(za);za.image_ids=ya.image_ids;za.file_ids=ya.file_ids;za.audio_ids=ya.audio_ids;za.gif_ids=ya.gif_ids;za.client_state=s.SEND_TO_SERVER;delete this._uploadMessages[xa];return za;},_emitUpdatedChange:function(xa,ya,za){this._didChange=true;this._threadInformer.updatedMessage(xa,ya,za);},_emitReceivedChange:function(xa){this._didChange=true;this._threadInformer.receivedMessage(xa);},_emitReorderedChange:function(xa,ya){this._didChange=true;this._threadInformer.reorderedMessages(xa,ya);}});Object.assign(pa,u,{addListener:function(xa,ya){return ja.addListener(xa,ya);}});function qa(xa,ya){var za=ya.map(la.bind(null,xa));return za.reverse();}function ra(xa,ya,za){var ab=za.filter(function(bb){return sa(la(xa,bb));});if(!xa._localTitanMessagesCount[ya])xa._localTitanMessagesCount[ya]=0;xa._localTitanMessagesCount[ya]+=ab.length;}function sa(xa){var ya=xa.action_type;if(ya==o.USER_GENERATED_MESSAGE)return true;switch(xa.log_message_type){case r.SUBSCRIBE:case r.UNSUBSCRIBE:case r.SERVER_ERROR:case r.LIVE_LISTEN:return false;default:return true;}}function ta(xa,ya,za){za=za||ya.message_id;var ab=xa._attachmentData[za];if(ab){ab.forEach(function(bb){var cb=ya.attachments.indexOf(bb.attach_key);if(cb!==-1)ya.attachments[cb]=bb.data;});delete xa._attachmentData[za];}else if(!ya.is_forward&&va(xa,ya)){xa._messagesNeedingAttachmentData[za]=true;wa(xa);}}function ua(xa){if(!xa.ranges)return;xa.ranges.forEach(function(ya){if(!ya.entity||ya.entity.external||!ya.entity.url)return;var za=new da(ya.entity.url);if(ha(da.getRequestURI())&&!za.getDomain()){za.setProtocol('https').setDomain('www.facebook.com');ya.entity.url=za.toString();}});}function va(xa,ya){if(!ya||!ya.attachments)return false;for(var za=0;za<ya.attachments.length;za++){var ab=ya.attachments[za];if(typeof ab==='string'&&ab.indexOf(q.SHARE)===0)return true;}var bb=ya.forward_message_ids||[];for(za=0;za<bb.length;za++){var cb=la(xa,bb[za]);if(va(xa,cb))return true;}return false;}var wa=fa(function(xa){var ya={};for(var za in xa._messagesNeedingAttachmentData){var ab=la(xa,za);if(va(xa,ab))ya[za]=true;}var bb=Object.keys(ya);if(bb.length){var cb={message_ids:bb};if(xa._fbid!=i.getID())cb.request_user_id=xa._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(cb).setAllowCrossPageTransition(true).send();}xa._messagesNeedingAttachmentData={};},0,this);e.exports=pa;},null);
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionType","MercuryGlobalActionType","MercuryMessages","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","MercuryViewer","MessagingEvent","MessagingReliabilityLogger","MessagingTag","PresenceUtil","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=v(n);for(var x in w)if(w.hasOwnProperty(x))z[x]=w[x];var y=w===null?null:w.prototype;z.prototype=Object.create(y);z.prototype.constructor=z;z.__superConstructor__=w;function z(aa){"use strict";this.$MercuryChannelHandler0=aa;this.__serverRequests=m.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler1=o.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler2=k.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler3=[];}z.prototype.getInstanceFBID=function(){"use strict";return this.$MercuryChannelHandler0;};z.prototype.$MercuryChannelHandler4=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!ba.obj.message){r.addEntry('channel_receive','invalid_data');return;}var ca=ba.obj.message,da=ca.other_user_fbid?ca.other_user_fbid:ca.thread_fbid,ea={author:ca.mercury_author_id,author_email:ca.mercury_author_email,body:ca.body,subject:ca.subject,has_attachment:ca.has_attachment,attachments:ca.attachments,html_body:ca.html_body,thread_id:ca.tid,thread_fbid:ca.thread_fbid,other_user_fbid:ca.other_user_fbid,message_id:ca.mid,coordinates:ca.mercury_coordinates,is_spoof_warning:ca.is_spoof_warning,ranges:ca.ranges,source:ca.mercury_source,source_tags:ca.mercury_source_tags,threading_id:ca.threading_id,timestamp:ca.timestamp,timestamp_absolute:ca.timestamp_absolute,timestamp_relative:ca.timestamp_relative,timestamp_time_passed:ca.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ca.is_unread,is_forward:false,forward_count:ca.forward_count||ca.forward,forward_message_ids:ca.forward_msg_ids,location_text:ca.location_text,folder:ba.obj.folder};if("sync_id" in ca){ea.sync_id=ca.sync_id;}else ea.action_id=ca.action_id;var fa=[u({},ea)];fa=fa.concat(ca.forward_actions||[]);var ga=l.CLIENT_CHANNEL_MESSAGE;this.__serverRequests.handleUpdateWaitForThread({actions:fa,payload_source:ga},da);if(!ca.is_unread&&p.isViewer(ca.mercury_author_id)){var ha={};ha[da]=ba.obj.folder;this.$MercuryChannelHandler6(this.__getMessagingPayloadType(),{obj:{event:q.READ,thread_fbids:ca.thread_fbid?[ca.thread_fbid]:[],other_user_fbids:ca.other_user_fbid?[ca.other_user_fbid]:[],folder_info:ha,timestamp:ca.timestamp}});}r.addEntry('channel_receive','success',[da,ea.message_id,t.getSessionID()]);};z.prototype.$MercuryChannelHandler6=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=[],da=ba.obj.event==q.READ;(ba.obj.thread_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});(ba.obj.other_user_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});this.__serverRequests.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler7=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!(ba.obj.thread_fbids||ba.obj.other_user_fbids))return;var ca=[];(ba.obj.thread_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,thread_fbid:da});});(ba.obj.other_user_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,other_user_fbid:da});});this.__serverRequests.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler8=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids)||!ba.obj.mids)return;var ca=ba.obj.thread_fbids.length?ba.obj.thread_fbids[0]:null,da=ba.obj.other_user_fbids.length?ba.obj.other_user_fbids[0]:null,ea={action_type:i.DELETE_MESSAGES,action_id:null,thread_fbid:ca,other_user_fbid:da,message_ids:ba.obj.mids};this.__serverRequests.handleUpdate({actions:[ea],threads:[ba.obj.updated_thread],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler9=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!ba.obj.folder)return;var ca={action_type:j.MARK_ALL_READ,action_id:ba.obj.action_id,folder:ba.obj.folder};this.__serverRequests.handleUpdate({global_actions:[ca]});};z.prototype.$MercuryChannelHandlera=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE;(ba.obj.thread_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:da,other_user_fbid:null,archived:ba.obj.state};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);(ba.obj.other_user_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:da,archived:ba.obj.state};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);};z.prototype.$MercuryChannelHandlerb=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE,da;(ba.obj.thread_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,thread_fbid:ea,other_user_fbid:null,new_folder:da};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);(ba.obj.other_user_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,other_user_fbid:ea,thread_fbid:null,new_folder:da};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);};z.prototype.$MercuryChannelHandlerc=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj.tag)return;switch(ba.obj.tag){case s.ACTION_ARCHIVED:this.$MercuryChannelHandlera(aa,ba);break;case s.INBOX:case s.OTHER:this.$MercuryChannelHandlerb(aa,ba);break;}};z.prototype.__markAsSeen=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlerd(aa)||!ba.obj||!ba.obj.seen_timestamp)return;this.__serverRequests.handleUpdate({message_counts:[{seen_timestamp:ba.obj.seen_timestamp,folder:s.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:s.INBOX}],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__updateModelsFromMercuryPayload=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlere(aa)||!ba.obj)return;this.$MercuryChannelHandler1.synchronizeInforms(function(){var ca=ba.obj,da=[];(ca.actions||[]).forEach(function(ea){var fa=i.USER_GENERATED_MESSAGE;if(ea.action_type==i.LOG_MESSAGE){var ga=l.CLIENT_CHANNEL_MESSAGE,ha;ha=ea.other_user_fbid||ea.thread_fbid;this.__serverRequests.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ga},ha);}else if(ea.action_type!=fa)da.push(ea);},this);ca.actions=da;ca.payload_source=l.CLIENT_CHANNEL_MESSAGE;this.__serverRequests.handleUpdate(ca);}.bind(this));};z.prototype.$MercuryChannelHandlerf=function(aa,ba){"use strict";this.__serverRequests.handleRoger(ba.obj);};z.prototype.$MercuryChannelHandlerg=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||ba.obj.mute_settings===(void 0)||(!ba.obj.thread_fbid&&!ba.obj.other_user_fbid))return;var ca=i.CHANGE_MUTE_SETTINGS,da=[{action_type:ca,action_id:null,thread_fbid:ba.obj.thread_fbid,other_user_fbid:ba.obj.other_user_fbid,mute_settings:ba.obj.mute_settings}];this.__serverRequests.handleUpdate({actions:da,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__handleMessagingPayload=function(aa,ba){"use strict";switch(ba.obj.event){case q.DELIVER:this.$MercuryChannelHandler4(aa,ba);break;case q.READ:case q.UNREAD:this.$MercuryChannelHandler6(aa,ba);break;case q.READ_ALL:this.$MercuryChannelHandler9(aa,ba);break;case q.DELETE:this.$MercuryChannelHandler7(aa,ba);break;case q.DELETE_MESSAGES:this.$MercuryChannelHandler8(aa,ba);break;case q.TAG:this.$MercuryChannelHandlerc(aa,ba);break;case q.REPORT_SPAM:this.$MercuryChannelHandlerb(aa,ba);break;case q.READ_RECEIPT:this.$MercuryChannelHandlerf(aa,ba);break;case q.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandlerg(aa,ba);break;}};z.prototype.getRouting=function(){"use strict";return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};z.prototype.__getMessagingPayloadType=function(){"use strict";return h.getArbiterType('messaging');};z.prototype.__getMercuryPayloadType=function(){"use strict";return h.getArbiterType('mercury');};z.prototype.__getInboxPayloadType=function(){"use strict";return h.getArbiterType('inbox');};z.prototype.$MercuryChannelHandler5=function(aa){"use strict";return (aa==this.__getMessagingPayloadType());};z.prototype.$MercuryChannelHandlere=function(aa){"use strict";return (aa==this.__getMercuryPayloadType());};z.prototype.$MercuryChannelHandlerd=function(aa){"use strict";return (aa==this.__getInboxPayloadType());};z.prototype.turnOn=function(){"use strict";if(!this.$MercuryChannelHandler3.length){var aa=this.getRouting();for(var ba in aa)this.$MercuryChannelHandler3.push(g.subscribe(h.getArbiterType(ba),aa[ba].bind(this)));}return this;};z.prototype.turnOff=function(){"use strict";if(this.$MercuryChannelHandler3.length){this.$MercuryChannelHandler3.forEach(g.unsubscribe);this.$MercuryChannelHandler3=[];}return this;};u(z,n);e.exports=z;},null);
__d("MercuryRoger",["Arbiter","ArbiterMixin","immutable","JSLogger","MercuryActionStatus","mapObject","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o={},p=[],q=k.SUCCESS,r={getSeenBy:function(u,v){if(!u)return [];var w=[],x=o[u.thread_id];if(!x)return w;x.forEach(function(y,z){if(s(u,y,z,v))w.push(z);});return w;},wasSeenByAll:function(u){if(!u)return false;var v=o[u.thread_id];if(!v)return false;return v.every(function(w,x){return s(u,w,x);});},getSeenTimestamps:function(u){var v=o[u];if(!v){v=i.OrderedMap();o[u]=v;}return v;},getSeenTimestamp:function(u,v){var w=o[u];return w?w.get(v):null;}};Object.assign(r,h);function s(u,v,w,x){return !!(v>u.timestamp&&(u.status===(void 0)||u.status===q)&&(!x||w!=u.author));}m.subscribe('update-roger',function(u,v){for(var w in v){var x=o[w]||i.OrderedMap();x=x.withMutations(function(y){for(var z in v[w]){var aa=n.getThreadMetaNow(w);if(aa&&aa.participants)if(aa.participants.indexOf(z)==-1){p.push(t(o));continue;}var ba=y.get(z),ca=v[w][z];if(!ba||ca>ba)y.set(z,ca);}});o[w]=x.sort();}v&&r.inform('change',v);});g.subscribe(j.DUMP_EVENT,function(u,v){v.bad_read_receipts={receipts:p};});function t(u){return l(u,function(v){return v.toJS();});}e.exports=r;},null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryRoger","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=b('MercuryMessages').get(),n=b('MercuryThreadInformer').get(),o=b('MercuryThreads').get(),p={},q={},r=j['roger.seen_delay'],s={getSeenBy:function(y,z){if(q[y])return [];return k.getSeenBy(t(y),z);},wasSeenByAll:function(y){if(q[y])return false;return k.wasSeenByAll(t(y));}};Object.assign(s,g);function t(y){if(!p[y]){var z=o.getThreadMetaNow(y);if(z)p[y]={thread_id:y,author:z.participants[0],timestamp:z.timestamp};}return p[y];}function u(y){var z=false;m.getThreadMessagesRange(y,0,1,function(aa){var ba=aa[0];if(!ba)return;var ca=ba.timestamp;if(ba.action_id||ba.status==i.SUCCESS)ca-=h.getServerTimeOffset();var da=s.getSeenBy(y);if(q[y]){clearTimeout(q[y]);delete q[y];}var ea=ca+r,fa=ea-Date.now();if(fa>0)q[y]=l(function(){delete q[y];v(y);},fa);p[y]=ba;var ga=s.getSeenBy(y);if(da.length||ga.length)z=true;});return z;}function v(y){var z={};z[y]=true;w(z);}function w(y){s.inform('state-changed',y);s.inform('change');}function x(event,y){var z={};for(var aa in y)if(u(aa))z[aa]=true;for(var ba in z){w(z);break;}}k.subscribe('change',function(y,z){for(var aa in z)!q[aa]&&v(aa);});n.subscribe('messages-received',x);n.subscribe('messages-reordered',x);n.subscribe('messages-updated',x);e.exports=s;},null);
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryParticipants","MercuryViewer","fbt","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('MercuryMessages').get(),l=b('MercuryThreads').get();function m(n,o){g.isThreadID(n);l.getThreadMeta(n,function(p){k.getThreadMessagesRange(n,0,1,function(q){var r=q.length&&q[q.length-1];if(r&&r.author!=i.getID()){h.get(r.author,function(s){if(p.name){o(j._("{senderName} messaged {groupName}",[j.param("senderName",s.short_name),j.param("groupName",p.name)]));}else o(j._("{name} messaged you",[j.param("name",s.short_name)]));});}else o(j._("New message!"));});});}e.exports={renderDocumentTitle:m};},null);
__d("MercuryThreadMetadataRawRenderer",["Event","CSS","DOM","MercuryActionStatus","MercuryErrorInfo","MercuryStatusTemplates","Tooltip","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p={renderParticipantListWithNoThreadName:function(q,r,s,t,u,v){var w={callback:true,check_length:true,show_unread_count:true};v=v||{};var x={};for(var y in v)if(w[y]){x[y]=v[y];delete v[y];}var z=s.map(function(ea){return t[ea];}),aa=this.renderRawParticipantList(q,z,s.length,v);aa=this.renderRawTitleWithUnreadCount(aa,x.show_unread_count?r.unread_count:0);var ba=v.abbr_mode,ca={};for(var da in v)ca[da]=v[da];ca.abbr_mode=true;u.forEach(function(ea){var fa=u.length>1?this._cloneIfDOMElement(aa):aa;i.setContent(ea,fa);if(x.check_length&&!ba&&ea.scrollWidth>ea.clientWidth){var ga=this.renderRawParticipantList(q,z,s.length,ca),ha=this.renderRawTitleWithUnreadCount(ga,x.show_unread_count?r.unread_count:0);i.setContent(ea,ha);}}.bind(this));x.callback&&x.callback(aa);},renderRawParticipantList:function(q,r,s,t){var u={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};t=t||{};var v=null;if(t.names_renderer){v=t.names_renderer(r);}else v=r.map(function(x){return x.name;});var w=null;if(v.length===0){if(!q){w=o._("New Message");}else w=o._("No Participants");}else if(v.length==1){w=v[0];}else if(v.length==2){if(t.last_separator_uses_and){w=o._("{participant1} and {participant2}",[o.param("participant1",v[0]),o.param("participant2",v[1])]);}else w=o._("{participant1}, {participant2}",[o.param("participant1",v[0]),o.param("participant2",v[1])]);}else if(t.last_separator_uses_and){if(t.abbr_mode){w=o._("{participant1} and {others_link}",[o.param("participant1",v[0]),o.param("others_link",this.renderRawParticipantCount({render_subset:true,count:s-1}))]);}else if(v.length==3){w=o._("{participant1}, {participant2} and {participant3}",[o.param("participant1",v[0]),o.param("participant2",v[1]),o.param("participant3",v[2])]);}else w=o._("{participant1}, {participant2} and {others_link}",[o.param("participant1",v[0]),o.param("participant2",v[1]),o.param("others_link",this.renderRawParticipantCount({render_subset:true,count:s-2}))]);}else if(v.length==3){w=o._("{participant1}, {participant2}, {participant3}",[o.param("participant1",v[0]),o.param("participant2",v[1]),o.param("participant3",v[2])]);}else w=o._("{participant1}, {participant2}, {participant3}, {others_link}",[o.param("participant1",v[0]),o.param("participant2",v[1]),o.param("participant3",v[2]),o.param("others_link",this.renderRawParticipantCount({render_subset:true,count:s-3}))]);if(Array.isArray(w))w=i.create('span',{},w);return w;},renderRawTitleWithUnreadCount:function(q,r){var s=q;if(r&&r>1)s=i.create('span',{},o._("{conversation_title} ({unread_count})",[o.param("conversation_title",q),o.param("unread_count",r)]));return s;},renderRawParticipantCount:function(q){var r=q.render_subset,s;if(!r){s=q.count>1?o._({"*":"{num} people"},[o.param("num",q.count,[0])]):o._("1 person");}else s=q.count>1?o._({"*":"{others_count} others"},[o.param("others_count",q.count,[0])]):o._("1 other");return s;},renderShortNames:function(q){if(q.length==1)return [q[0].name];return q.map(function(r){return r.short_name;});},renderStatusIndicator:function(q,r,s){var t;if(q==j.RESENDING){t=this.renderResendIndicator();}else if(q!==(void 0)&&q!=j.UNSENT&&q!=j.UNCONFIRMED&&q!=j.SUCCESS)t=this.renderErrorIndicator(r,s);return t;},renderResendIndicator:function(){return l[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(q,r){if(!q)return null;var s=l[':fb:mercury:error-indicator'].render(),t=q.is_transient,u=k.getMessage(q);if(t)if(k.isConnectionError(q)){u=o._("{message} Check your internet connection and click to try again.",[o.param("message",u)]);}else u=o._("{message} Click to send again.",[o.param("message",u)]);m.set(s,u,'above','center');if(r&&t){g.listen(s,'click',r);s.setAttribute('tabindex','0');h.addClass(s,"_55q-");}return s;},_cloneIfDOMElement:function(q){if(q&&q.cloneNode){return q.cloneNode();}else return q;}};e.exports=p;},null);
__d("MercuryThreadSearchUtils",["escapeRegex","TokenizeUtil"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={wordsInString:function(j){return (j||'').split(/\s+/).filter(function(k){return k.trim().length>0;});},anyMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(k(j[l]))return true;return false;},allMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(!k(j[l]))return false;return true;},queryWordMatchesAnyNameWord:function(j,k){var l=new RegExp('^'+g(j),'i');return this.anyMatchPredicate(k,function(m){var n=h.parse(m).flatValue;return l.test(n);});},queryMatchesName:function(j,k){var l=this.wordsInString(j),m=this.wordsInString(k);return this.allMatchPredicate(l,function(n){return this.queryWordMatchesAnyNameWord(n,m);}.bind(this));}};e.exports=i;},null);
__d("AsyncLayout",["AjaxPipeRequest","Arbiter","AsyncRequest","AsyncResponse","CSS","DOM","HTML","NavigationMessage","PageTransitions","URI","$","emptyFunction","ge","goURI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();function u(v){"use strict";this.canvasID=v;if(s('rightCol'))this.auxiliaryID='rightCol';if(s('headerArea'))this.headerID='headerArea';if(s('toolbarContainer'))this.toolbarID='toolbarContainer';this.waitingForAux=false;o.registerHandler(this.catchPageTransition.bind(this));this.subscription=h.subscribe(n.NAVIGATION_BEGIN,this.onNavigate.bind(this));h.inform('AsyncLayout/initialized',null,h.BEHAVIOR_STATE);}u.prototype.catchPageTransition=function(v){"use strict";this.subscription.unsubscribe();return false;};u.prototype.getCanvasID=function(v){"use strict";return v.sidecol?'contentCol':'contentArea';};u.prototype.onNavigate=function(v,w){"use strict";var x=w.useAjaxPipe;w=w.params;if(w.endpoint){if(this.request){this.request.setFinallyHandler(r);this.request.abort();}if(this.sideRequest)this.sideRequest.abort();if(x){this.request=new g().setURI(w.endpoint).setData(w).setCanvasId(this.getCanvasID(w)).setFinallyHandler(this.finallyHandler.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFirstResponseCallback(this.firstResponseCallback.bind(this)).send();}else{w.handled=true;this.waitingForAux=w.sidecol;var y=!!w.iframe,z=new i().setOption('useIframeTransport',y).setURI(new p(w.endpoint)).setReadOnly(true).setMethod('GET').setData(w).setHandler(this.onResponse.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFinallyHandler(this.finallyHandler.bind(this));this.request=z;z.send();}}};u.prototype.onSideResponse=function(v){"use strict";var w=v.getPayload();if(w&&this.auxiliaryID)this.receivedAux(w);};u.prototype.receivedAux=function(v){"use strict";!this.waitingForAux;this.waitingForAux=false;l.setContent(q(this.auxiliaryID),m(v));};u.prototype.onResponse=function(v){"use strict";var w=v.getPayload();if(w.redirect){t(w.redirect);}else{var x=w.html||w;l.setContent(q(this.canvasID),m(x));if(w.side_html&&this.auxiliaryID)this.receivedAux(w.side_html);if(this.headerID&&!w.keep_header){var y=q(this.headerID);l.setContent(y,m(w.header_html||''));k.conditionShow(y,w.header_html);}if(w.toolbar_html&&this.toolbarID)l.setContent(q(this.toolbarID),m(w.toolbar_html));if(w.js)(new Function(w.js))();k.conditionClass('contentCol','hasRightCol',this.auxiliaryID&&!w.noRightSide);var z=s('rightCol');if(z&&w.noRightSide)l.empty(z);}var aa=v.getRequest().getData();h.inform(n.NAVIGATION_COMPLETED,aa.key);};u.prototype.errorHandler=function(v){"use strict";j.verboseErrorHandler(v);h.inform(n.NAVIGATION_FAILED);this.request=null;};u.prototype.firstResponseCallback=function(v){"use strict";window.scrollTo(0,0);h.inform(n.NAVIGATION_FIRST_RESPONSE);};u.prototype.finallyHandler=function(v){"use strict";this.request=null;o.transitionComplete(true);h.inform(n.NAVIGATION_COMPLETED);};e.exports=u;},null);
__d("CanvasNavigationFullScreen",["Arbiter","CSS","cx","Event","FullScreen"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=false,m={initLink:function(n,o){if(l){return;}else l=true;h.conditionClass(n,"_4-os",k.isSupported());if(k.isSupported()&&o)setTimeout(o.show.bind(o),500);j.listen(n,'click',this.setFullScreen.bind(null,true));k.subscribe('changed',function(){if(k.isFullScreen()){g.inform('canvas.enter_fullscreen');}else g.inform('canvas.exit_fullscreen');});},isSupported:function(){var n=l&&k.isSupported();return !!n;},getFullScreen:function(){return !!k.isFullScreen();},setFullScreen:function(n){var o=true;if(n){o=k.enableFullScreen(document.documentElement);}else o=k.disableFullScreen();return o;}};e.exports=m;},null);
__d("XAppFriendsController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/platform\/games\/appfriends\/",{app_id:{type:"Int",required:true}});},null);
__d("CanvasPresenceController",["Arbiter","AsyncRequest","AvailableListConstants","AvailableList","PresenceStatus","XAppFriendsController"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=60*1000,n=false,o=[],p=0,q,r,s,t;function u(){var z=0;o.forEach(function(aa){if(k.hasDetailedPresenceData(aa)&&k.getDetailedActivePresence(aa)==i.ACTIVE_ON_WEB)z++;});if(s===(void 0)||s!==(z>1)){s=z>1;g.inform('canvas.friendsOnlineUpdated',s);}}function v(z){var aa=l.getURIBuilder().setInt('app_id',p).getURI();new h().setURI(aa).setHandler(function(ba){o=ba.payload.ids;if(z)z();u();}).send();}function w(){if(p===0){t=w;return;}n=true;v(function(){q=setInterval(v,m);r=j.subscribe(i.ON_AVAILABILITY_CHANGED,u);});}function x(){n=false;clearInterval(q);j.unsubscribe(r);}var y={setAppID:function(z){p=z;if(t)t();},setAppFriends:function(z){o=z;},useFriendsOnline:function(z){if(z==n)return;if(z){w();}else x();}};e.exports=y;},null);
__d("CanvasResizer",["createArrayFromMixed","CSS","DOMEventListener","Vector"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k;function l(){var n,o=document.documentElement;if(window.innerHeight){n=window.innerHeight;}else if(o&&o.clientHeight){n=o.clientHeight;}else n=document.body.clientHeight;for(var p=0;p<k.length;p++){var q=k[p];if(!h.hasClass(q,'noresize')){var r=j.getElementPosition(q,'document').y,s=n-r;q.style.height=s/(k.length-p)+'px';}}}i.add(window,'resize',l);var m={smartSizingFrameAdded:function(){k=[];var n=g(document.getElementsByTagName('iframe'));n.forEach(function(o){if(h.hasClass(o,'smart_sizing_iframe')&&!h.hasClass(o,'noresize')){h.removeClass(o,'canvas_iframe_util');k.push(o);}});l();}};e.exports=m;},null);
__d("XPendingSyncRequestsController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/platform\/games\/sync_requests\/pending_list\/",{app_id:{type:"Int",required:true}});},null);
__d("CanvasSyncRequestsController",["Arbiter","AsyncRequest","ChannelConstants","SyncRequestStatusEnum","XPendingSyncRequestsController"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l={},m=false,n=0,o;function p(u){if(r(u))q(u);l[u.id]=u;u.timer=setTimeout(function(){u.status=j.EXPIRED;s(u);},u.timeout*1000);}function q(u){clearTimeout(l[u.id].timer);delete l[u.id];}function r(u){return l[u.id]!==(void 0);}function s(u){if(!r(u))return;if(u.status!=j.PENDING){var v={id:u.id,status:j.namesByValue[u.status]};g.inform('canvas.syncRequestUpdated',v);q(u);}}g.subscribe(i.getArbiterType('sync_request_created'),function(u,v){return p(v.obj);});g.subscribe(i.getArbiterType('sync_request_updated'),function(u,v){return s(v.obj);});var t={setAppID:function(u){n=u;if(o)o();},initPendingSyncRequests:function(){if(m)return;if(n===0){o=t.initPendingSyncRequests;return;}m=true;var u=k.getURIBuilder().setInt('app_id',n).getURI();new h().setURI(u).setHandler(function(v){v.getPayload().forEach(p);}).send();}};e.exports=t;},null);
__d("FileFormResetOnSubmit",["DOMQuery","Event","emptyFunction"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(l,m){var n=h.listen(l,'change',i.thatReturnsFalse,h.Priority.URGENT);try{m();}catch(o){throw o;}finally{n.remove();}}function k(l){"use strict";this._form=l;}k.prototype.enable=function(){"use strict";var l=this._reset.bind(this);this._subscription=this._form.subscribe('submit',function(){setTimeout(l,0);});};k.prototype.disable=function(){"use strict";this._subscription.unsubscribe();this._subscription=null;};k.prototype._reset=function(){"use strict";var l=this._form.getRoot();j(l,function(){var m=g.scry(l,'input[type="file"]');m.forEach(function(n){n.value='';});});};e.exports=k;},null);
__d("JSONRPC",["Log"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){"use strict";this.$JSONRPC0=0;this.$JSONRPC1={};this.remote=function(j){this.$JSONRPC2=j;return this.remote;}.bind(this);this.local={};this.$JSONRPC3=i;}h.prototype.stub=function(i){"use strict";this.remote[i]=function(){for(var j=[],k=0,l=arguments.length;k<l;k++)j.push(arguments[k]);var m={jsonrpc:'2.0',method:i};if(typeof j[j.length-1]=='function'){m.id=++this.$JSONRPC0;this.$JSONRPC1[m.id]=j.pop();}m.params=j;this.$JSONRPC3(JSON.stringify(m),this.$JSONRPC2||{method:i});}.bind(this);};h.prototype.read=function(i,j){"use strict";var k=JSON.parse(i),l=k.id;if(!k.method){if(!this.$JSONRPC1[l]){g.warn('Could not find callback %s',l);return;}var m=this.$JSONRPC1[l];delete this.$JSONRPC1[l];delete k.id;delete k.jsonrpc;m(k);return;}var n=this,o=this.local[k.method],p;if(l){p=function(s,t){var u={jsonrpc:'2.0',id:l};u[s]=t;setTimeout(function(){n.$JSONRPC3(JSON.stringify(u),j);},0);};}else p=function(){};if(!o){g.error('Method "%s" has not been defined',k.method);p('error',{code:-32601,message:'Method not found',data:k.method});return;}k.params.push(p.bind(null,'result'));k.params.push(p.bind(null,'error'));try{var r=o.apply(j||null,k.params);if(typeof r!=='undefined')p('result',r);}catch(q){g.error('Invokation of RPC method %s resulted in the error: %s',k.method,q.message);p('error',{code:-32603,message:'Internal error',data:q.message});}};e.exports=h;},null);
__d("XdArbiter",["Arbiter","Log","QueryString","Queue"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=/^apps\./.test(location.hostname)?'canvas':'tab',l={},m=[],n=new j(),o={setRpcHandler:function(q){n.start(q);},handleMessage:function(q,r,s){try{if(typeof q=='string'){if(/^FB_RPC:/.test(q)){n.enqueue([q.substring(7),{origin:r,source:s||l[k]}]);return;}q=JSON.parse(q);}if(!q.method)return;if(typeof q.params=='string')q.params=JSON.parse(q.params);g.inform('Connect.Unsafe.'+q.method,q.params,g.BEHAVIOR_PERSISTENT);}catch(t){}},register:function(q,r,s){var t=r||k;g.inform("XdArbiter/register",{origin:s});l[t]=q;l[s]=q;g.inform('XdArbiter.register',t,g.BEHAVIOR_PERSISTENT);this.scheduleDispatch();return t;},scheduleDispatch:function(){var q=this,r=42;function s(){var t=m.shift();if(t)q.send.apply(q,t);if(m.length)setTimeout(s,r);}setTimeout(s,r);},hasProxy:function(q){var r=q||k;return !!l[r];},send:function(q,r,s){var t=s in l?s:k;r=r||l[t];if(typeof q!=='string')q=i.encode(q);try{r.proxyMessage(q,s);}catch(u){h.debug('XdArbiter: Proxy for %s not available, '+'page might have been navigated: %s',t,u.message);delete l[t];}return true;}},p=a.XdArbiter;a.XdArbiter=o;if(p){if(p._p.length)while(p._p.length)o.register.apply(o,p._p.shift());if(p._m.length)while(p._m.length)o.handleMessage.apply(o,p._m.shift());}e.exports=o;},null);
__d("PlatformAppController",["Arbiter","AsyncRequest","Bootloader","CanvasNavigationFullScreen","CanvasPresenceController","CSS","CurrentUser","Dialog","JSONRPC","PlatformDialogClient","Style","URI","Vector","XdArbiter","CanvasSyncRequestsController","errorCode","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();var x={oauth:true,test_flow:true,app_requests:true,game_group_create:true,game_group_join:true,gift:true,share:true,share_open_graph:true,sync_request:true},y,z,aa=true,ba=0,ca=false,da,ea=false,fa=window._cstart,ga=0,ha,ia,ja={},ka=new o(function(wa,xa){t.send('FB_RPC:'+wa,xa.source||w(y).contentWindow.frames['fb_xdm_frame_'+location.protocol.replace(':','')],xa.origin||z);});g.subscribe("XdArbiter/register",function(wa,xa){if(ha&&xa.origin!=z)new h().setURI('/platform/app_owned_url_check/').setData({appid:ha,url:xa.origin}).setHandler(function(ya){var za=ya.getPayload();if(za.allowed)z=xa.origin;}).send();});function la(wa){var xa=parseInt(wa.x,10),ya=parseInt(wa.y,10);if(xa>=0&&ya>=0)window.scrollTo(xa,ya);}function ma(wa){var xa=w(wa.frame.replace(/_fb_https$/,''));if(xa){l.addClass(xa,'noresize');xa.style.height=wa.height+'px';}}function na(){var wa=w(y),xa=0,ya=0;while(wa){xa+=parseInt(wa.offsetLeft,10);ya+=parseInt(wa.offsetTop,10);wa=wa.offsetParent;}var za=s.getViewportDimensions(),ab=s.getScrollPosition();return {clientWidth:za.x,clientHeight:za.y,scrollLeft:ab.x,scrollTop:ab.y,offsetLeft:xa,offsetTop:ya};}function oa(wa,xa,ya){var za=wa.method;delete wa.method;delete wa.access_token;delete wa.next;delete wa.context;delete wa.locale;wa.display='async';if(!/^[\w\-_.]+$/.test(za))throw new Error('Malformed method name');if(!wa.redirect_uri||r(wa.redirect_uri).getOrigin()!=r(this.origin).getOrigin())wa.redirect_uri=this.origin;if(za=='permissions.oauth'||za=='permissions.request')za='oauth';if(za=='apprequests'){za='app_requests';wa.context='canvas_app_requests';}if(za=='pay')if(wa.action=='purchaseitem'||wa.action=='purchase_item'){x[za]=ia&&ia.useNewPayDialogs;}else x[za]=false;if(x[za]){var ab=wa.redirect_uri;p.async(za,wa,function(db){if(db.error_code==1340004){if(m.getID()&&m.getID()!="0"){xa(db);}else r('/login.php').addQueryData('next',r.getRequestURI().toString()).go();}else if(za=='app_requests'&&db.error_code==1349146){pa(za,wa,xa,db,ab);}else xa(db);});return;}var bb=r('/fbml/ajax/dialog/'+za.replace(/\./g,'_')).setQueryData(wa),cb=new h().setMethod('GET').setReadOnly(true).setURI(bb).setAbortHandler(function(){ya(p.REQUEST_ABORTED_ERROR);});new n().setAsync(cb).setModal(true).setWideDialog(true).show().setCloseHandler(xa);}function pa(wa,xa,ya,za,ab){xa.redirect_uri=ab;p.async('oauth',xa,function(bb){if(bb.error){ya(za);}else{xa.redirect_uri=ab;p.async(wa,xa,function(cb){ya(cb);});}});}function qa(wa){ca=wa;}function ra(wa,xa){ea=wa;da=xa;}ka.stub('navigate');function sa(wa){if(ca){ka.remote.navigate(wa);return true;}return false;}ka.stub('enterFullScreen');g.subscribe('canvas.enter_fullscreen',ka.remote.enterFullScreen);ka.stub('exitFullScreen');g.subscribe('canvas.exit_fullscreen',ka.remote.exitFullScreen);ka.stub('fireEvent');g.subscribe('canvas.friendsOnlineUpdated',ka.remote.fireEvent.bind(ka.remote));g.subscribe('canvas.syncRequestUpdated',ka.remote.fireEvent.bind(ka.remote));function ta(wa){var xa=wa.time-fa+ga;switch(wa.name){case 'StopIframeAppTtiTimer':ga=xa;return {time_delta_ms:xa,type:"tti"};case 'StartIframeAppTtiTimer':fa=wa.time;break;case 'RecordIframeAppTti':if(ea)i.loadModules(["CanvasIFrameLogger"],function(ya){ya.log(xa,wa.appId,da);});return {time_delta_ms:xa,type:"tti"};}}ka.local.setSize=ma;ka.local.getPageInfo=na;ka.local.scrollTo=la;ka.local.showDialog=oa;ka.local.setNavigationEnabled=qa;ka.local.isFullScreenSupported=j.isSupported;ka.local.getFullScreen=j.getFullScreen;ka.local.logTtiMessage=ta;ka.local.useFriendsOnline=k.useFriendsOnline.bind(k);ka.local.initPendingSyncRequests=u.initPendingSyncRequests.bind(u);t.setRpcHandler(function(wa){ka.read.apply(ka,wa);});ka.stub('hidePluginObjects');g.subscribe('layer_shown',function(){if(++ba===1)if(aa){ka.remote.hidePluginObjects();}else q.set(w('pagelet_canvas_content'),'visibility','hidden');});ka.stub('showPluginObjects');g.subscribe('layer_hidden',function(){if(--ba===0){if(aa){ka.remote.showPluginObjects();}else q.set(w('pagelet_canvas_content'),'visibility','');}else if(ba<0)ba=0;});function ua(wa){ja[wa.name]=wa;var xa=w(wa.name);if(xa)y=xa;}var va={setActiveIframeAndAppID:function(wa,xa,ya){y=wa;z=xa;ha=ya;k.setAppID(ha);u.setAppID(ha);},setInformAppOnLayerChange:function(wa){aa=wa;},setNavigationEnabled:qa,setTtiEnabled:ra,handleNavigation:sa,init:ua,getFrameParams:function(wa){return ja[wa];},setConfig:function(wa){ia=wa;}};a.PlatformAppController=va;e.exports=va;},null);
__d("FavIcon",["DOM"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h;function i(){var k=g.scry(document.head,"link");if(k)k.forEach(function(l){if(l.rel.indexOf('icon')!=-1||l.rel.indexOf('shortcut icon')!=-1)g.remove(l);});}var j={set:function(k){if(h)g.remove(h);i();h=g.create('link',{type:'image/x-icon',rel:'icon',href:k});g.appendContent(g.find(document,'head'),h);}};e.exports=j;},null);
__d("PlatformCanvasController",["PlatformAppController","DOMEventListener","URI","CSS","DOM","DocumentTitle","FavIcon","ge","fbt","AsyncRequest","UserActivity","UIPagelet","PageTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t='iframe_canvas',u=240000,v=5000,w=60000,x,y,z,aa,ba,ca,da;function ea(na){var oa=n('pagelet_canvas_content');j.hide(oa);k.scry(oa,'iframe').forEach(function(pa){pa.src='';});k.setContent(n('canvas_throbber_text'),o._("Loading {app-name}",[o.param("app-name",na)]));}function fa(na,oa,pa,qa,ra){var sa=n('pagelet_canvas_footer_content'),ta=n('pagelet_canvas_content'),ua=n('pagelet_canvas_ip_banner_content');k.setContent(ta,na);k.setContent(sa,oa);k.setContent(ua,ra);j.show(ta);l.set(pa);m.set(qa);}function ga(na){if(na.getSubdomain()!='apps')return false;var oa,pa=k.scry(document,'a[data-appname]');for(var qa=0;qa<pa.length;qa++)if(pa[qa].href==na){oa=pa[qa].getAttribute('data-appname');break;}if(!oa)return false;var ra=na.getPath().split('/')[1];if(ra=='l.php')return false;ea(oa);if(n('pagelet_canvas_storybox'))new p().setURI(new i('/ajax/canvas/storybox')).setData({fb_app_name:ra}).setMethod('GET').setReadOnly(true).send();var sa=na.getUnqualifiedURI();new p().setURI(new i('/ajax/canvas.php')).setData({fb_app_name:ra,uri:sa.toString()}).setMethod('GET').setReadOnly(true).setStatusElement('canvas_throbber').setHandler(function(ta){var ua=ta.getPayload();j.conditionClass(document.body,'center_fixed_width_app',!ua.is_liquid);fa(ua.main_html,ua.footer_html,ua.page_title,ua.favicon,ua.start_now_banner_markup);s.transitionComplete();}).send();return true;}function ha(na){if(!String(na.getPath()).startsWith('/'+z+'/')&&!String(na.getPath()).startsWith('/'+y+'/'))return false;na=na.getUnqualifiedURI();na.setPath('/'+na.getPath().split('/').slice(2).join('/'));return g.handleNavigation(na.toString());}function ia(na){return ha(na)||ga(na);}function ja(){var na=Date.now();if((x>0)&&(na-aa>=u)){aa=na;r.loadFromEndpoint('WebEgoPane','pagelet_ego_pane',{pid:9,data:[y,++ba]},{bundle:false});}}q.subscribe(function(){var na=Date.now();if(na-aa>=u-v)setTimeout(ja,v);});function ka(){var na=Date.now();if((x>0)&&(na-ca>=w)){ca=na;r.loadFromEndpoint('CanvasShowcaseSliderPagelet','pagelet_canvas_showcase',{pid:129,data:[y,++da]},{bundle:false});}}function la(na,oa,pa,qa,ra){x=pa;aa=Date.now();ba=0;ca=Date.now();da=0;if(y&&y!==na)ja();y=na;z=oa;var sa=n(t);g.setConfig(ra);if(sa)h.add(sa,'load',function(){g.setNavigationEnabled(false);});if(ra&&ra.displayShowcase)setInterval(ka,w);g.setInformAppOnLayerChange(!qa);g.setNavigationEnabled(false);s.registerHandler(ia);}var ma={setup:la};e.exports=ma;},null);
__d("swfobject",["AsyncRequest","Bootloader","CSS","copyProperties","htmlSpecialChars"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();if(typeof l=="undefined")var l={};if(typeof l.util=="undefined")l.util={};if(typeof l.SWFObjectUtil=="undefined")l.SWFObjectUtil={};l.SWFObject=function(n,o,p,q,r,s,t,u,v,w){if(!document.getElementById)return;this.DETECT_KEY=w?w:'detectflash';this.skipDetect=l.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];this.fallback_html='';this.fallback_js_fcn=function(){};if(n)this.setAttribute('swf',n);if(o)this.setAttribute('id',o);if(p)this.setAttribute('width',p);if(q)this.setAttribute('height',q);this.installedVer=l.SWFObjectUtil.getPlayerVersion();if(r){if(!(r instanceof Array))r=[r];var x;r.forEach(function(aa){x=new l.PlayerVersion(aa.toString().split('.'));if(x.major==this.installedVer.major){this.setAttribute('version',x);return;}else if(!this.getAttribute('version')||x.major<this.getAttribute('version').major)this.setAttribute('version',x);}.bind(this));}if(!window.opera&&document.all&&this.installedVer.major>7)if(!l.unloadSet){l.SWFObjectUtil.prepUnload=function(){var aa=function(){},ba=function(){};window.attachEvent("onunload",l.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",l.SWFObjectUtil.prepUnload);l.unloadSet=true;}if(s)this.addParam('bgcolor',s);var y=t?t:'high';this.addParam('quality',y);this.setAttribute('useExpressInstall',false);this.setAttribute('doExpressInstall',false);var z=(u)?u:window.location;this.setAttribute('xiRedirectUrl',z);this.setAttribute('redirectUrl','');if(v)this.setAttribute('redirectUrl',v);};l.SWFObject.ieWorkaroundApplied=false;l.SWFObject.ensureIEWorkaroundAttached=function(){if(!l.SWFObject.ieWorkaroundApplied&&document.attachEvent){l.SWFObject.ieWorkaroundApplied=true;document.attachEvent('onpropertychange',l.SWFObject.onDocumentPropertyChange);}};l.SWFObject.onDocumentPropertyChange=function(event){if(event.propertyName=="title"){var n=document.title;if(n!=null&&n.indexOf('#!')!=-1){n=n.substring(0,n.indexOf('#!'));document.title=n;}}};j(l.SWFObject.prototype,{useExpressInstall:function(n){this.xiSWFPath=!n?"/swf/expressinstall.swf":n;this.setAttribute('useExpressInstall',true);},setAttribute:function(n,o){this.attributes[n]=o;},getAttribute:function(n){return this.attributes[n]||"";},addParam:function(n,o){this.params[n]=o;},getParams:function(){return this.params;},addVariable:function(n,o){this.variables[n]=o;},getVariable:function(n){return this.variables[n]||"";},getVariables:function(){return this.variables;},getVariablePairs:function(){var n=[],o,p=this.getVariables();for(o in p)n[n.length]=o+"="+p[o];return n.join('&');},getSWFHTML:function(){var n,o,p;if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute('swf',this.xiSWFPath);}o={type:'application/x-shockwave-flash',src:this.getAttribute('swf'),width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;',id:this.getAttribute('id'),name:this.getAttribute('id')};var q=this.getParams();for(var r in q)o[r]=q[r];p=this.getVariablePairs();if(p)o.flashvars=p;n=m('embed',o,null);}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute('swf',this.xiSWFPath);}o={id:this.getAttribute('id'),classid:'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;'};var s=m('param',{name:'movie',value:this.getAttribute('swf')},null),q=this.getParams();for(var r in q)s+=m('param',{name:r,value:q[r]},null);p=this.getVariablePairs();if(p)s+=m('param',{name:'flashvars',value:p},null);n=m('object',o,s);}return n;},write:function(n){if(this.getAttribute('useExpressInstall')){var o=new l.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(o)&&!this.installedVer.versionIsValid(this.getAttribute('version'))){this.setAttribute('doExpressInstall',true);this.addVariable("MMredirectURL",escape(this.getAttribute('xiRedirectUrl')));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}var p=(typeof n=='string')?document.getElementById(n):n;if(!p)return false;i.addClass(p,'swfObject');p.setAttribute('data-swfid',this.getAttribute('id'));if(this.skipDetect||this.getAttribute('doExpressInstall')||this.installedVer.versionIsValid(this.getAttribute('version'))){l.SWFObject.ensureIEWorkaroundAttached();p.innerHTML=this.getSWFHTML();return true;}else{if(this.getAttribute('redirectUrl')!="")document.location.replace(this.getAttribute('redirectUrl'));var q=this.getAttribute('version').major+'.'+this.getAttribute('version').minor+'.'+this.getAttribute('version').release+'.'+this.getAttribute('version').build,r=this.installedVer.major+'.'+this.installedVer.minor+'.'+this.installedVer.release+'.'+this.installedVer.build;this.fallback_js_fcn(r,q);p.innerHTML=this.fallback_html;}return false;}});l.SWFObjectUtil.getPlayerVersion=function(){var n=new l.PlayerVersion([0,0,0,0]),o;if(navigator.plugins&&navigator.mimeTypes.length){for(var p=0;p<navigator.plugins.length;p++)try{var r=navigator.plugins[p];if(r.name=='Shockwave Flash'){o=new l.PlayerVersion(r.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+(r|d)|\s+b[0-9]+)/,".").split("."));if(typeof n=='undefined'||o.major>n.major||(o.major==n.major&&(o.minor>n.minor||(o.minor==n.minor&&(o.release>n.release||(o.release==n.release&&o.build>n.build))))))n=o;}}catch(q){}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var s=1,t=3;while(s)try{t++;s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+t);n=new l.PlayerVersion([t,0,0]);}catch(u){s=null;}}else{try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(v){try{var s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");n=new l.PlayerVersion([6,0,21]);s.AllowScriptAccess="always";}catch(w){if(n.major==6)return n;}try{s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(x){}}if(s!=null)n=new l.PlayerVersion(s.GetVariable("$version").split(" ")[1].split(","));}return n;};l.PlayerVersion=function(n){this.major=n[0]!=null?parseInt(n[0],10):0;this.minor=n[1]!=null?parseInt(n[1],10):0;this.release=n[2]!=null?parseInt(n[2],10):0;this.build=n[3]!=null?parseInt(n[3],10):0;};l.PlayerVersion.prototype.versionIsValid=function(n){if(this.major<n.major)return false;if(this.major>n.major)return true;if(this.minor<n.minor)return false;if(this.minor>n.minor)return true;if(this.release<n.release)return false;if(this.release>n.release)return true;if(this.build<n.build)return false;return true;};l.util={getRequestParameter:function(n){var o=document.location.search||document.location.hash;if(n==null)return o;if(o){var p=o.substring(1).split("&");for(var q=0;q<p.length;q++)if(p[q].substring(0,p[q].indexOf("="))==n)return p[q].substring((p[q].indexOf("=")+1));}return "";}};l.SWFObjectUtil.cleanupSWFs=function(){var n=document.getElementsByTagName("OBJECT");for(var o=n.length-1;o>=0;o--){n[o].style.display='none';for(var p in n[o])if(typeof n[o][p]=='function')n[o][p]=function(){};}};if(!document.getElementById&&document.all)document.getElementById=function(n){return document.all[n];};l.spawn_flash_update_dialog=function(){new g().setURI('/ajax/flash_update_dialog.php').setMethod('GET').setReadOnly(true).send();};l.showFlashErrorDialog=function(n,o){h.loadModules(["ErrorDialog"],function(p){p.show(n,o);});};function m(n,o,p){var q=/^[A-Za-z0-9\-]+$/;if(!n.match(q))throw new Error('Invalid tag '+n);var r='<'+n;for(var s in o){if(!s.match(q))throw new Error('Invalid attr '+s);r+=' '+s+'="'+k(o[s])+'"';}if(p===null){return r+'/>';}else return r+'>'+p+'</'+n+'>';}e.exports=a.deconcept||l;},null);
__d("SoundPlayer",["Arbiter","URI","createArrayFromMixed","swfobject"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=b('swfobject').SWFObject,k={},l=null,m=false,n='so_sound_player',o='/swf/SoundPlayer.swf?v=1',p='10.0.22.87',q=null;function r(z){var aa=h(z);if(!aa.getDomain())return h().setPath(aa.getPath()).toString();return z;}function s(z){var aa=h(z).getPath();if(/\.mp3$/.test(aa))return 'audio/mpeg';if(/\.og[ga]$/.test(aa))return 'audio/ogg';return '';}function t(){if(!q){var z=document.createElement('audio');if(!z||!z.canPlayType)return null;z.setAttribute('preload','auto');document.body.appendChild(z);q=z;}return q;}function u(){var z=document[n]||window[n];if(z)if(!z.playSound&&z.length)z=z[0];return (z&&z.playSound&&z.loopSound)?z:null;}function v(){return m;}function w(z,aa,ba){l={path:z,sync:aa,loop:ba};}function x(){m=true;if(l){var z=u();if(l.loop){z.loopSound(l.path,l.sync);}else z.playSound(l.path,l.sync);}}var y={init:function(z){z=i(z);var aa;for(var ba=0;ba<z.length;++ba){aa=z[ba];if(k[aa])return;}var ca=t();for(ba=0;ca&&ba<z.length;++ba){aa=z[ba];if(ca.canPlayType(aa)){k[aa]=true;return;}}k['audio/mpeg']=true;if(u())return;try{g.registerCallback(x,['sound/player_ready','sound/ready']);var ea=document.createElement('div');ea.id='sound_player_holder';document.body.appendChild(ea);var fa=new j(o,n,'1px','1px',[p],'#ffffff');fa.addParam('allowscriptaccess','always');fa.addParam('wmode','transparent');fa.addVariable('swf_id',n);fa.fallback_html=' ';fa.write(ea.id);window[n]=fa;g.inform('sound/player_ready');}catch(da){}},play:function(z,aa){z=i(z);var ba=t(),ca,da;for(var ea=0;ba&&ea<z.length;++ea){ca=z[ea];da=s(ca);if(!ba.canPlayType(da))continue;y.init([da]);ba.src=r(ca);if(aa){ba.setAttribute('loop','');}else ba.removeAttribute('loop');ba.play();return;}for(ea=0;ea<z.length;++ea){ca=r(z[ea]);da=s(ca);if(da!='audio/mpeg')continue;y.init([da]);var fa=u();if(!v()){w(ca,true,aa);return;}else if(fa){if(aa){fa.loopSound(ca,true);}else fa.playSound(ca,true);return;}}},stop:function(z){z=i(z);for(var aa=0;aa<z.length;++aa){var ba=r(z[aa]),ca=t(),da=u();if(ca&&ca.src==ba){ca.pause();ca.removeAttribute('src');}else da&&da.stopSound(ba);}}};e.exports=y;},null);
__d("SoundSynchronizer",["SoundPlayer","WebStorage","createArrayFromMixed"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j='fb_sounds_playing3';function k(){var o=h.getLocalStorage();if(o)try{var q=o[j];if(q){q=JSON.parse(q);if(Array.isArray(q))return q;}}catch(p){}return [];}function l(o){var p=h.getLocalStorage();if(p){var q=k();q.push(o);while(q.length>5)q.shift();try{p[j]=JSON.stringify(q);}catch(r){}}}function m(o){return k().some(function(p){return p===o;});}var n={play:function(o,p,q){o=i(o);p=p||(o[0]+Math.floor(Date.now()/1000));if(m(p))return;g.play(o,q);l(p);},isSupported:function(){return !!h.getLocalStorage();}};e.exports=n;},null);
__d("SoundRPC",["Event","SoundSynchronizer"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(k,l,m){h.play(k,l,m);}var j={playLocal:i,playRemote:function(k,l,m,n){var o={paths:l,sync:m,loop:n};k.postMessage(JSON.stringify(o),'*');},supportsRPC:function(){return !!window.postMessage;},_listen:function(){g.listen(window,'message',function(k){if(!/\.facebook.com$/.test(k.origin))return;var l=JSON.parse(k.data||'{}');i(l.paths,l.sync,l.loop);});}};e.exports=j;},null);
__d("Sound",["SoundInitialData","SoundPlayer","SoundRPC","SoundSynchronizer","URI","UserAgent_DEPRECATED","isFacebookURI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=null,o={init:function(s){if(!n)h.init(s);},play:function(s,t,u){if(n){i.playRemote(n.contentWindow,s,t,false);}else i.playLocal(s,t,u);},stop:function(s){if(!n)h.stop(s);}},p=new k(location.href);if(p.getSubdomain()&&p.getSubdomain()!=='www')p.setSubdomain('www');var q=p.getDomain();function r(){if(l.ie()<9)return false;if(g.RPC_DISABLED)return false;return j.isSupported()&&i.supportsRPC();}if(m(p)&&location.host!==q&&r()){n=document.createElement('iframe');n.setAttribute('src','//'+q+'/sound_iframe.php');n.style.display='none';document.body.appendChild(n);}e.exports=o;},null);
__d("Token",["CSS","DataStore","DOM","Locale","UnicodeBidi","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o){"use strict";this.info=n;this.paramName=o;}m.prototype.getInfo=function(){"use strict";return this.info;};m.prototype.getText=function(){"use strict";return this.info.text;};m.prototype.getValue=function(){"use strict";return this.info.uid;};m.prototype.isFreeform=function(){"use strict";return !!this.info.freeform;};m.prototype.setSelected=function(n){"use strict";g.conditionClass(this.getElement(),'uiTokenSelected',n);return this;};m.prototype.getElement=function(){"use strict";if(!this.element)this.setElement(this.createElement());return this.element;};m.prototype.setElement=function(n){"use strict";h.set(n,'Token',this);this.element=n;return this;};m.prototype.isRemovable=function(){"use strict";return g.hasClass(this.element,'removable');};m.prototype.getTextDirection=function(){"use strict";var n=k.isDirectionRTL(this.getText()),o=j.isRTL();if(n&&!o)return 'rtl';if(!n&&o)return 'ltr';return null;};m.prototype.createElement=function(n,o){"use strict";var p=this.paramName,q=this.getText(),r=this.getValue(),s=i.create('a',{href:'#','aria-label':l._("Remove {item}",[l.param("item",q)]),className:'remove uiCloseButton uiCloseButtonSmall'});if(n)g.addClass(s,'uiCloseButtonSmallGray');var t=i.create('input',{type:'hidden',value:r,name:p+'[]',autocomplete:'off'}),u=i.create('input',{type:'hidden',value:q,name:'text_'+p+'[]',autocomplete:'off'}),v={className:'removable uiToken'},w=this.getTextDirection();if(w!==null)v.dir=w;var x=i.create('span',v,[q,t,u,s]);if(n)g.addClass(x,'uiTokenGray');if(o){var y=i.create('i',{className:o});i.prependContent(x,y);}return x;};e.exports=m;},null);
__d("WeakToken",["CSS","Token"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(){"use strict";if(h!==null)h.apply(this,arguments);}k.prototype.createElement=function(){"use strict";var l=j.createElement.call(this,true,'UFIWeakReferenceIcon');g.addClass(l,'uiTokenWeakReference');return l;};e.exports=k;},null);
__d("Tokenizer",["Arbiter","ArbiterMixin","CSS","DataStore","DOM","DOMQuery","Event","Focus","Input","Keys","Parent","StickyPlaceholderInput","Style","TextMetrics","Token","UserAgent_DEPRECATED","WeakToken","copyProperties","createObjectFrom","emptyFunction","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();var ba=20,ca=aa(h);for(var da in ca)if(ca.hasOwnProperty(da))fa[da]=ca[da];var ea=ca===null?null:ca.prototype;fa.prototype=Object.create(ea);fa.prototype.constructor=fa;fa.__superConstructor__=ca;function fa(ga,ha,ia){"use strict";this.element=ga;this.typeahead=ha;this.input=ha.getCore().getElement();if(ia)this.init(ia.tokenarea,ia.param_name,ia.initial_info,ia.options);j.set(this.element,'Tokenizer',this);}fa.prototype.init=function(ga,ha,ia,ja){"use strict";this._handleEvents=this.handleEvents.bind(this);this.init=z;this.setTokenarea(ga);this.paramName=ha;if(!this.placeholder)this.placeholder=this.input.getAttribute('data-placeholder')||this.input.getAttribute('placeholder')||'';x(this,ja||{});this.initEvents();this.initTypeahead();this.reset(ia);this.initBehaviors();setTimeout(this.adjustWidth.bind(this),0);g.inform('Tokenizer/init',this,g.BEHAVIOR_PERSISTENT);this.inform('init',{tokens:this.getTokens()});};fa.prototype.reset=function(ga){"use strict";this.tokens=[];this.unique={};if(ga){this.populate(ga);}else k.empty(this.tokenarea);this.updateTokenarea();};fa.prototype.populate=function(ga){"use strict";var ha=[];this.tokens=this.getTokenElements().map(function(ia,ja){var ka=ga[ja];ha.push(this._tokenKey(ka));return this.createToken(ka,ia);},this);this.unique=y(ha,this.tokens);};fa.prototype.setTokenarea=function(ga){"use strict";var ha=!this.tokenarea;if(ga!==this.tokenarea){if(this.tokenarea){k.remove(this.tokenarea);for(var ia in this._tokenareaListeners)this._tokenareaListeners[ia].remove();}this._tokenareaListeners=m.listen(ga,{click:this._handleEvents,keydown:this._handleEvents});this.tokenarea=ga;}if(!ha)this.reset();};fa.prototype.getElement=function(){"use strict";return this.element;};fa.prototype.getTypeahead=function(){"use strict";return this.typeahead;};fa.prototype.getInput=function(){"use strict";return this.input;};fa.prototype.initBehaviors=function(){"use strict";this.behaviors=this.behaviors||[];if(this.behaviors instanceof Array){this.behaviors.forEach(function(ia){ia.behavior(this,ia.config);}.bind(this));}else for(var ga in (this.behaviors||{})){var ha=window.TokenizerBehaviors&&window.TokenizerBehaviors[ga];ha.call(null,this,this.behaviors[ga]);}};fa.prototype.initTypeahead=function(){"use strict";var ga=this.typeahead.getCore();ga.resetOnSelect=true;ga.setValueOnSelect=false;ga.preventFocusChangeOnTab=true;if(this.inline){var ha=this.typeahead.getView();i.addClass(ha.getElement(),'uiInlineTokenizerView');}this.typeahead.subscribe('select',function(ia,ja){return this.handleSelect(ja);}.bind(this));this.typeahead.subscribe('blur',this.handleBlur.bind(this));};fa.prototype.handleBlur=function(event){"use strict";this.inform('blur',{event:event});this.updatePlaceholder();};fa.prototype.handleSelect=function(ga){"use strict";var ha=ga.selected;if('uid' in ha){this.updateInput();this.addToken(this.createToken(ha));}};fa.prototype.initEvents=function(){"use strict";var ga=v.firefox()<4?'keypress':'keydown';m.listen(this.input,'paste',this.paste.bind(this));m.listen(this.input,ga,this.keydown.bind(this));};fa.prototype.handleEvents=function(event){"use strict";var ga=event.getTarget(),ha=ga&&this.getTokenElementFromTarget(ga);if(!ha)return;if(event.type!='keydown'||m.getKeyCode(event)==p.RETURN)this.processEvents(event,ga,ha);};fa.prototype.processEvents=function(event,ga,ha){"use strict";if(q.byClass(ga,'remove')){var ia=ha.nextSibling;ia=ia&&l.scry(ha.nextSibling,'.remove')[0];var ja=this.getTokenFromElement(ha);ja=this.addTokenData(ja,ga);this.removeToken(ja);this.focusOnTokenRemoval(event,ia);event.kill();}};fa.prototype.focusOnTokenRemoval=function(event,ga){"use strict";n.set(event.type=='keydown'&&ga||this.input);};fa.prototype.addTokenData=function(ga,ha){"use strict";return ga;};fa.prototype.keydown=function(event){"use strict";this.inform('keydown',{event:event});var ga=m.getKeyCode(event),ha=this.input;if(this.inline&&ga==p.BACKSPACE&&o.isEmpty(ha)){var ia=this.getLastToken();if(ia&&ia.isRemovable())this.removeToken(ia);}this.updateInput();};fa.prototype.paste=function(event){"use strict";this.inform('paste',{event:event});this.updateInput(true);};fa.prototype.focusInput=function(){"use strict";n.set(this.input);};fa.prototype.updateInput=function(ga){"use strict";if(!this.inline)return;setTimeout(function(){this.adjustWidth(this.input.value);if(ga)this.input.value=this.input.value;}.bind(this),20);r.setPlaceholderText(this.input,'');this.inform('resize');};fa.prototype.setPlaceholder=function(ga){"use strict";this.placeholder=ga;if(this.stickyPlaceholder)r.setPlaceholderText(this.input,ga);this.updatePlaceholder();};fa.prototype.updatePlaceholder=function(){"use strict";if(!this.inline||this.input.value)return;var ga=!this.tokens.length,ha='';if(ga||this.stickyPlaceholder){this.adjustWidth(this.placeholder);ha=this.placeholder;}else this.adjustWidth(this.input.value);r.setPlaceholderText(this.input,ha);};fa.prototype.adjustWidth=function(ga){"use strict";if(!this.inline||!this._getIsInDOM())return;if(!ga&&this.input.value==='')ga=this.placeholder;var ha=ba;if(ga!==this.placeholder||!this.getTokens().length||this.stickyPlaceholder){var ia=s.getFloat(this.getElement(),'width'),ja=this._getMetrics().measure(ga);ha=ja.width+this._getWidthOffset()+10;ha=(ha>=ia)?ia:ha;}s.set(this.input,'width',ha+'px');this.inform('resize');g.inform('reflow');};fa.prototype.getToken=function(ga){"use strict";return this.unique[ga]||null;};fa.prototype.getTokens=function(){"use strict";return this.tokens||[];};fa.prototype.getTokenElements=function(){"use strict";return l.scry(this.tokenarea,'span.uiToken');};fa.prototype.getTokenElementFromTarget=function(ga){"use strict";return q.byClass(ga,'uiToken');};fa.prototype.getTokenFromElement=function(ga){"use strict";return j.get(ga,'Token');};fa.prototype.getTokenValues=function(){"use strict";if(!this.tokens)return [];return this.tokens.map(function(ga){return ga.getValue();});};fa.prototype.getFirstToken=function(){"use strict";return this.tokens[0]||null;};fa.prototype.getLastToken=function(){"use strict";return this.tokens[this.tokens.length-1]||null;};fa.prototype.hasMaxTokens=function(){"use strict";return this.maxTokens&&this.maxTokens<=this.tokens.length;};fa.prototype.createToken=function(ga,ha){"use strict";var ia=this.getToken(this._tokenKey(ga));if(!ia)ia=ga.weak_reference?new w(ga,this.paramName):new u(ga,this.paramName);ha&&ia.setElement(ha);return ia;};fa.prototype.addToken=function(ga){"use strict";if(this.hasMaxTokens())return;var ha=this._tokenKey(ga.getInfo());if(ha in this.unique)return;this.unique[ha]=ga;this.tokens.push(ga);this.insertToken(ga);this.updateTokenarea();this.inform('addToken',ga);this.inform('changeTokens');g.inform('Form/change',{node:this.element});};fa.prototype.insertToken=function(ga){"use strict";k.appendContent(this.tokenarea,ga.getElement());};fa.prototype.removeToken=function(ga){"use strict";if(!ga)return;var ha=this.tokens.indexOf(ga);if(ha<0)return;this.tokens.splice(this.tokens.indexOf(ga),1);delete this.unique[this._tokenKey(ga.getInfo())];k.remove(ga.getElement());this.updateTokenarea();this.inform('removeToken',ga);this.inform('changeTokens');g.inform('Form/change',{node:this.element});};fa.prototype.removeAllTokens=function(){"use strict";this.reset();this.inform('changeTokens');this.inform('removeAllTokens');};fa.prototype.updateTokenarea=function(){"use strict";var ga=this.typeahead.getCore(),ha=this.getTokenValues();if(this.excludeDuplicates){this._exclusions||(this._exclusions=ga.getExclusions());ga.setExclusions(ha.concat(this._exclusions));}ga.setEnabled(!this.hasMaxTokens());this.updateTokenareaVisibility();this.updatePlaceholder();this.inform('resize');g.inform('reflow');};fa.prototype.updateTokenareaVisibility=function(){"use strict";i.conditionShow(this.tokenarea,this.tokens.length!==0);};fa.prototype._tokenKey=function(ga){"use strict";return ga.uid+(ga.freeform?':':'');};fa.prototype._getWidthOffset=function(){"use strict";if(this._widthOffset===null){var ga=this.input.clientWidth,ha=s.getFloat(this.input,'width');if(ga==ha){this._widthOffset=s.getFloat(this.input,'paddingLeft')+s.getFloat(this.input,'paddingRight');}else this._widthOffset=0;}return this._widthOffset;};fa.prototype._getMetrics=function(){"use strict";if(!this._metrics)this._metrics=new t(this.input,this.inline);return this._metrics;};fa.prototype._getIsInDOM=function(){"use strict";return this._isInDOM||(this._isInDOM=l.contains(document.body,this.input));};fa.getInstance=function(ga){"use strict";var ha=q.byClass(ga,'uiTokenizer');return ha?j.get(ha,'Tokenizer'):null;};fa.init=function(ga,ha){"use strict";ga.init(ha.tokenarea,ha.param_name,ha.initial_info,ha.options);};x(fa.prototype,{inline:false,maxTokens:null,excludeDuplicates:true,placeholder:'',_widthOffset:null,_metrics:null});e.exports=fa;},null);
__d("MusicButtonStore",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={},h={addButton:function(i,j){g[i]=j;return j;},getButton:function(i){return g[i];},getButtons:function(){return g;},removeButton:function(i){g[i]&&g[i].resetLoadingTimers();delete g[i];}};e.exports=h;},null);
__d("MusicConstants",["URI"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={DEBUG:false,CONFIG:{PARTNER_TIMEOUT:8000},LIVE_LISTEN_MIN_SPOTIFY_VERSION:'spotify-0.6.6.0.g5a9eaca5',enableDebug:function(){this.DEBUG=true;},sameURLs:function(i,j){var k=/\/$/;if(i&&j){i=g(i);j=g(j);return i.getDomain()==j.getDomain()&&i.getPath()==j.getPath();}return false;},greaterOrEqualToMinimumVersion:function(i,j){var k=/(?:\d+\.)+/,l=i.match(k)[0].split('.').slice(0,-1),m=j.match(k)[0].split('.').slice(0,-1);if(l.length!==m.length)return false;for(var n=0;n<m.length;n++)if(+l[n]<+m[n]){return false;}else if(+l[n]>+m[n])return true;return true;},sanitizeForProviders:function(i){var j={};for(var k in i)if(this.ALLOWED_EXTERNAL_CONTEXT_PARAMS[k])j[k]=i[k];return j;},OP:{RESUME:'RESUME',PAUSE:'PAUSE',PLAY:'PLAY',VERSION:'VERSION'},STATUS_CHANGE_OP:{STATUS:'STATUS',LOGIN:'LOGIN',REINFORM:'REINFORM'},STATUS_CHANGE_EVENT:{playing:'PLAY_STATE_CHANGED',track:'TRACK_CHANGED'},DIAGNOSTIC_EVENT:{ALL_PAUSED:'ALL_PAUSED',ALL_OFFLINE:'ALL_OFFLINE',OFFLINE:'OFFLINE',ONLINE:'ONLINE',SEARCHING:'SEARCHING',HIT:'HIT',MISS:'MISS',RESIGN:'RESIGN',IFRAME_POLLING:'IFRAME_POLLING',RELAUNCH:'RELAUNCH',STATE_CHANGE:'STATE_CHANGE',WRONG_VERSION:'WRONG_VERSION',SERVICE_ERROR:'SERVICE_ERROR',INCORRECT_ONLINE_STATE:'INCORRECT_ONLINE_STATE',LOG_SEND_OP:'LOG_SEND_OP',REQUEUE_OP:'REQUEUE_OP'},ALLOWED_STATUS_PARAMS:{playing:'playing',track:'track',context:'context',client_version:'client_version',start_time:'start_time',expires_in:'expires_in',open_graph_state:'open_graph_state'},ALLOWED_EXTERNAL_CONTEXT_PARAMS:{uri:true,song:true,radio_station:true,album:true,playlist:true,musician:true,song_list:true,offset:true,title:true,request_id:true,listen_with_friends:true,needs_tos:true},LIVE_LISTEN_OP:{NOW_LEADING:'NOW_LEADING',NOW_LISTENING:'NOW_LISTENING',END_SESSION:'END_SESSION',SONG_PLAYING:'SONG_PLAYING',LISTENER_UPDATE:'LISTENER_UPDATE',QUEUE_SESSION:'QUEUE_SESSION',PLAY_ERROR:'PLAY_ERROR',SESSION_UPDATED:'SESSION_UPDATED',QUEUING_SESSION:'QUEUING_SESSION'},MUSIC_BUTTON:{ACTIVATE:'ACTIVATE'},ERROR:{1:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM',2:'SERVICE_UNAVAILABLE_WITHOUT_PREMIUM_OR_WAIT',3:'SERVICE_UNAVAILABLE_BILLING_ISSUE',4:'SERVICE_UNAVAILABLE_TECHNICAL_ISSUE',5:'AUDIO_AD_PLAYING',99:'SERVICE_TEMPORARILY_UNAVAILABLE',101:'SONG_UNAVAILABLE_WITHOUT_PURCHASE',102:'SONG_UNAVAILABLE_WITHOUT_PREMIUM',103:'SONG_UNAVAILABLE_INDEFINITELY'}};e.exports=a.MusicConstants||h;},null);
__d("MusicEvents",["Arbiter"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();e.exports=a.MusicEvents=new g();},null);
__d("MusicButton",["BanzaiODS","Bootloader","copyProperties","CSS","DOM","MusicButtonStore","MusicConstants","MusicEvents","Parent","BanzaiScuba","Tooltip","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){b.__markCompiled&&b.__markCompiled();var t=function(u,v,w,x,y,z){this.provider=u;this.buttonElem=v;this.url=w;this.context=x||{};this.mediaType=y;this.setState(this.STATES.OFFLINE);this.tooltip=z||'';n.subscribe(m.MUSIC_BUTTON.ACTIVATE,this.processClick.bind(this));};i(t,{tracksetableTypes:[]});i(t.prototype,{SHOW_LOADING_TIMEOUT:500,HIDE_LOADING_TIMEOUT:m.CONFIG.PARTNER_TIMEOUT,RECENTLY_ONLINE_TIMEOUT:6000,STATES:{PLAYING:'music_playing',PAUSED:'music_paused',LOADING:'music_loading',DISABLED:'music_disabled',OFFLINE:'music_offline'},setState:function(u){if(u!==this.STATES.LOADING){this.resetLoadingTimers();this.previousState=this.state||u;}if(u===this.STATES.PLAYING){q.set(this.buttonElem,this.tooltip);}else q.set(this.buttonElem,'');var v=this.buttonElem.parentNode;this.state&&j.removeClass(v,this.state);this.state=u;j.addClass(v,this.state);},isTracksetable:function(u){return t.tracksetableTypes.indexOf(this.mediaType)!==-1;},handleIncomingEvent:function(u,v){clearTimeout(this._showLoadingTimer);if(v&&v.provider&&v.provider!=this.provider)return;switch(u){case m.DIAGNOSTIC_EVENT.ONLINE:case m.STATUS_CHANGE_EVENT.track:case m.STATUS_CHANGE_EVENT.playing:var w=v&&v.track&&v.track.uri,x=v&&v.context&&v.context.uri;if(v&&v.playing&&(m.sameURLs(w,this.url)||m.sameURLs(x,this.url))){this.setState(this.STATES.PLAYING);}else if(this.state===this.STATES.LOADING&&(this.previousState===this.STATES.PAUSED||this.previousState===this.STATES.OFFLINE)){clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=s(this.setState.bind(this,this.STATES.PAUSED),this.RECENTLY_ONLINE_TIMEOUT);}else if(!this._attemptingPlayTimer)this.setState(this.STATES.PAUSED);break;case m.DIAGNOSTIC_EVENT.OFFLINE:this.setState(this.STATES.OFFLINE);break;case m.DIAGNOSTIC_EVENT.ALL_OFFLINE:this.setState(this.STATES.OFFLINE);break;}},processClick:function(u,v){if(v!=this.buttonElem){if(this.state===this.STATES.LOADING)this.previousState&&this.setState(this.previousState);return;}var w=new p('music_play_button_click',null,{addBrowserFields:true,addPredictedGeographyFields:true,addUser:true});w.addNormal('uses_bridge','1');w.addNormal('state',this.state);w.addNormal('provider',this.provider);w.addNormal('class','MusicButton');w.addNormal('insights_source',this.context.appear_source_log_str);w.addDenorm('url',this.url);w.post();if(this.state!=this.STATES.PLAYING){g.bumpEntityKey('music_play_button','music_play_button_click');g.bumpEntityKey('music_play_button','music_play_button_click.'+this.provider);var x=o.byClass(this.buttonElem,"_4--s");if(x){j.addClass(x,"_4--t");setTimeout(j.removeClass.bind(null,x,"_4--t"),3000);}}var y=this.isTracksetable()&&o.byClass(this.buttonElem,'music_trackset_container'),z=[];if(y){var aa=y.getAttribute('data-trackset-title'),ba=this.provider,ca=k.scry(y,'.music_button');for(var da=0;da<ca.length;da++){var ea=l.getButton([ca[da].id]);if(ea&&ea.provider==ba&&ea.isTracksetable())z.push(ea.url);}}if(!a.Music)this.showLoading(true);h.loadModules(["Music"],function(fa){var ga=(y&&z.length>1)?fa.playPauseSongList(this.provider,this.url,z,aa,this.context):fa.playPauseSong(this.provider,this.url,this.context);this.showLoading(!ga);}.bind(this));},showLoading:function(u){this.resetLoadingTimers();this._hideLoadingTimer=s(this._timeout.bind(this,u),this.HIDE_LOADING_TIMEOUT);this._showLoadingTimer=s(this.setState.bind(this,this.STATES.LOADING),this.SHOW_LOADING_TIMEOUT);},resetLoadingTimers:function(){clearTimeout(this._hideLoadingTimer);clearTimeout(this._showLoadingTimer);clearTimeout(this._attemptingPlayTimer);this._attemptingPlayTimer=null;},destroy:function(){this.resetLoadingTimers();this.buttonElem=null;},_timeout:function(u){a.Music&&a.Music.reInform([this.provider]);if(!u&&this.state===this.STATES.LOADING)this.setState(this.STATES.PAUSED);}});e.exports=t;},null);
__d("MusicButtonManager",["Event","DOM","KeyedCallbackManager","Layer","MusicButton","MusicButtonStore","MusicConstants","MusicEvents","Parent","$","copyProperties","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=new i(),t=null,u={},v=0;function w(da){var ea=da.getTarget(),fa=o.byClass(ea,'music_button');fa=fa||(!(da.getModifiers&&da.getModifiers().any)&&x(ea));if(!fa)return;return y(fa,da);}function x(da){var ea=o.byClass(da,'music_button_trigger')&&o.byClass(da,'music_button_trigger_group');if(ea){var fa=h.scry(ea,'.music_button');if(fa.length)return fa[0];}return null;}function y(da,event){event&&event.stop();n.inform(m.MUSIC_BUTTON.ACTIVATE,da);return false;}function z(da){a.Music&&a.Music.reInform(da);}function aa(da,ea){var fa=l.getButtons();for(var ga in fa)if(fa[ga].noGC||r(ga)){fa[ga].handleIncomingEvent(da,ea);}else l.removeButton(ga);}var ba={init:function(da){if(t)return;t=true;k.tracksetableTypes=da||[];g.listen(document.body,'click',w);n.subscribe([m.STATUS_CHANGE_EVENT.playing,m.STATUS_CHANGE_EVENT.track,m.DIAGNOSTIC_EVENT.OFFLINE,m.DIAGNOSTIC_EVENT.ALL_OFFLINE,m.DIAGNOSTIC_EVENT.ONLINE],aa);},add:function(da,ea,fa,ga,ha,ia){t||ba.init();var ja=ea.id,ka=l.getButton(ja);if(ka)return ka;ka=l.addButton(ja,new k(da,ea,fa,q({button_id:ja},ga),ha,ia));var la=o.byClass(ea,'uiOverlay');if(la){ka.noGC=true;var ma=j.subscribe('destroy',function(na,oa){if(h.contains(oa.getRoot(),ea)){l.removeButton(ja);j.unsubscribe(ma);}});}if(da&&!u[da])u[da]=setTimeout(function(){var na=Object.keys(u);na.length&&z(na);u={};},0);return ka;},addButton:function(da,ea,fa,ga,ha,ia){if(!r(ea))return;var ja=p(ea);return ba.add(da,ja,fa,ga,ha,ia);},asyncAddMusicButton:function(da,ea){da.setAttribute('id','music_button_'+v++);ca(da,ea);},tryAddButtonInDOM:function(da,ea){var fa=r(da);fa&&ca(fa,ea);},addMusicData:function(da,ea,fa,ga,ha,ia){s.setResource(da,{provider:ea,uri:fa,context:ga,media_type:ha,tooltip:ia});}};function ca(da,ea){var fa=h.find(da,'a.button_anchor').getAttribute('href');s.executeOrEnqueue(fa,function(ga){return ba.add(ga.provider,da,ga.uri,ga.context,ga.media_type,ea?ga.tooltip:'');});}e.exports=a.MusicButtonManager||ba;},null);
__d("PhotoStore",["Arbiter","PhotoStoreCore"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();g.subscribe('update-photos',function(i,j){h.updateData(j);});e.exports=h;},null);
__d("PhotoViewState",["ArbiterMixin","PhotoStore","PhotoUtils","SpotlightViewerLoggingEvents","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=l(g);for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(q,r,s,t,u){"use strict";this._viewer=q;this._setID=r;this._updateCallback=t;this._position=s||0;this._preloaded={};this._reverse=u;}p.prototype._fetchCallback=function(q){"use strict";if(!this._viewer.isOpen())return;this._preload(q);this._log(j.DATA_FETCH_COMPLETE);};p.prototype._preload=function(q){"use strict";i.preload(this._viewer,q,function(r){this._preloaded[i.getFBIDFromData(r)]=true;}.bind(this));};p.prototype._preloadPhotosInRange=function(q,r){"use strict";var s=[];for(var t=q;t<=r;++t){var u=h.getByIndexImmediate(this._setID,t);if(u&&!this._isPreloaded(u))s.push(u);}this._preload(s);};p.prototype._isPreloaded=function(q){"use strict";return this._preloaded[i.getFBIDFromData(q)];};p.prototype.getPosition=function(){"use strict";return this._position;};p.prototype.isValidMovement=function(q){"use strict";if(!h.hasBeenCreated(this._setID))return false;if(h.hasLooped(this._setID))return true;var r=this._position+q,s=h.getAvailableRange(this._setID),t=s.offset+s.length-1;return r>=s.offset-1&&r<=t+1;};p.prototype.getRelativeMovement=function(q){"use strict";return h.getIndexForID(this._setID,q)-this._position;};p.prototype.moveCursor=function(q){"use strict";if(!this.isValidMovement(q))return false;this._position+=q;return true;};p.prototype._page=function(q){"use strict";if(!this.moveCursor(q))return;this._log(j.PAGE_BEGIN);var r=h.getByIndexImmediate(this._setID,this._position);if(!r){this.inform('photo_fetch');this._log(j.PHOTO_FETCH);}else if(!this._isPreloaded(r))this._preload([r]);h.getByIndex(this._setID,this._position,this._updateCallback);this._loadMoreIfNecessary(q>0,p.BUFFER_SIZE);this._log(j.PAGE_COMPLETE);};p.prototype.loadMoreForwardIfNecessary=function(q){"use strict";var r=h.getAvailableRange(this._setID),s=r.offset+r.length-1,t=this._position+q;if(t>s&&!h.hasLooped(this._setID)){var u=h.getCursorByIndexImmediate(this._setID,s);h.fetchForward(this._setID,u,q,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(this._position+1,t);};p.prototype.loadMoreBackwardIfNecessary=function(q){"use strict";var r=h.getAvailableRange(this._setID),s=this._position-q;if(s<r.offset&&!h.hasLooped(this._setID)){var t=h.getCursorByIndexImmediate(this._setID,r.offset);h.fetchBackward(this._setID,t,q,this._fetchCallback.bind(this));}else this._preloadPhotosInRange(s,this._position-1);};p.prototype._loadMoreIfNecessary=function(q,r){"use strict";if(q){this.loadMoreForwardIfNecessary(r);}else this.loadMoreBackwardIfNecessary(r);};p.prototype.displayFirst=function(){"use strict";if(!this._viewer.isOpen())return;h.setPreFetchCallback(this._setID,function(){this._log(j.DATA_FETCH_BEGIN);}.bind(this));var q=function(r){if(!this._isPreloaded(r))this._preload([r]);this._updateCallback(r);}.bind(this);h.getByIndex(this._setID,this._position,q);if(this._reverse){this.loadMoreBackwardIfNecessary(p.BUFFER_SIZE);}else this.loadMoreForwardIfNecessary(p.BUFFER_SIZE);};p.prototype.backward=function(){"use strict";this._page(this._reverse?1:-1);};p.prototype.forward=function(){"use strict";this._page(this._reverse?-1:1);};p.prototype._log=function(q){"use strict";this._viewer.log(q);};k(p,{BUFFER_SIZE:4});e.exports=p;},null);
__d("SpotlightViewer",["React","ReactLayeredComponentMixin","Spotlight.react","cx"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=g.createClass({displayName:"SpotlightViewer",mixins:[h],renderLayers:function(){if(!this.props.open)return null;var l="_n3";if(this.props.className)l+=' '+this.props.className;return {photoLayer:g.createElement(i,{onBeforeHide:this.props.onBeforeHide,onHide:this.props.onHide,rootClassName:this.props.rootClassName,shown:this.props.open},g.createElement("div",{className:l,onClick:this.props.onClick},this.props.children))};},render:function(){return (g.createElement("div",null));}});e.exports=k;},null);
__d("SpotlightViewerBottomBarGroup",["React","cx"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=g.createClass({displayName:"SpotlightViewerBottomBarGroup",render:function(){var j=this.props.itemmargin||'right',k=((j=='left'?"marginLeft":'')+(j=='right'?' '+"marginRight":'')+(' '+"_4_8i"));return (g.createElement("div",{className:k},this.props.children));}});e.exports=i;},null);
__d("SpotlightViewerBottomBarLink",["Link.react","React","cx"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=h.createClass({displayName:"SpotlightViewerBottomBarLink",render:function(){return (h.createElement(g,h.__spread({},this.props,{className:"_4_8j _4_8k"}),this.props.children));}});e.exports=j;},null);
__d("SpotlightViewerClose",["React","TooltipLink.react","cx","fbt","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=g,m=l.PropTypes,n=g.createClass({displayName:"SpotlightViewerClose",propTypes:{position:m.oneOf(['left','right'])},getDefaultProps:function(){return {position:'right'};},render:function(){var o=(this.props.position=='left')?"_5wx3":"_5wx4",p=g.createElement("span",null,j._("Press Esc to close"));return (g.createElement(h,{className:k("_4-o9 _50-m _51an",o),onClick:this.props.onClick,tooltip:p}));}});e.exports=n;},null);
__d("SpotlightViewerImage",["React","cx"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=g.createClass({displayName:"SpotlightViewerImage",render:function(){return (g.createElement("img",{className:"_4-od",src:this.props.src,style:{width:this.props.dimensions.x,height:this.props.dimensions.y}}));}});e.exports=i;},null);
__d("SpotlightViewerCoreMixin",["PhotoLogger","PhotoStore","PhotoUtils","PhotoViewState","React","SpotlightViewerImage","SpotlightViewerLoggingEvents"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n={_displayFirstPhoto:function(){h.executePostCreate(this.props.setid,this.viewState.displayFirst.bind(this.viewState));},_getInitialPosition:function(){var o;if(!this.props.clearcache)o=h.getIndexForID(this.props.setid,this.props.photoid);if(o===(void 0)){h.clearSetCache(this.props.setid);o=0;}return o;},__displayPhoto:function(){var o=this._getInitialPosition();this.viewState=new j(this,this.props.setid,o,this._updatePhoto,this.props.reverse);this.inform('open');this._displayFirstPhoto();},componentWillMount:function(){this._logger=new g(this.getViewerID());this.log(m.OPEN_BEGIN);this.__displayPhoto();},componentDidMount:function(){this._enableSubscriptions&&this._enableSubscriptions();this.log(m.OPEN_COMPLETE);},isOpen:function(){return this.state.open;},close:function(){if(!this.isOpen())return;this.log(m.CLOSE_BEGIN);this.setState({open:false},function(){this.inform('close');this.log(m.CLOSE_COMPLETE);});},componentWillUnmount:function(){this.viewState=null;},_onClickViewport:function(o){o?this.viewState.forward():this.viewState.backward();},_getMedia:function(o,p){return (k.createElement(l,{ref:"image",src:o.uri,dimensions:p.imageDimensions}));},_getCurrentFBID:function(){return i.getFBIDFromData(this.state.photoData);},_updatePhoto:function(o){this.log(m.PHOTO_CHANGE_BEGIN);this.setState({photoData:o},function(){this.inform('photo_change',this.state.photoData);this.log(m.PHOTO_CHANGE_COMPLETE);});},getLogger:function(){return this._logger;},log:function(o){this._logger&&this._logger.logEvent(o);}};e.exports=n;},null);
__d("SpotlightViewerStageResizer",["Event","SubscriptionsHandler","Vector"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=520;function k(l,m){"use strict";this._subscriptionsHandler=new h();this._subscriptionsHandler.addSubscriptions(g.listen(window,'resize',this._resetStageDimensions.bind(this)));this._dimensions=l;this._minHeight=m.minHeight||j;this._minWidth=m.minWidth||j;this._resetStageDimensions();}k.prototype.destroy=function(){"use strict";this._dimensions=null;this._subscriptionsHandler.release();};k.prototype._resetStageDimensions=function(){"use strict";this._currentStageDimensions=new i(this._minWidth,this._minHeight);};k.prototype.getImageAndStageDimensions=function(l){"use strict";var m=this._dimensions.getBestFitDimensionsFromPhoto(l,this._dimensions.getMaxStageDimensions()),n=this._dimensions.getStageDimensions(m);this._currentStageDimensions=new i(Math.max(n.x,this._minWidth,this._currentStageDimensions.x),Math.max(n.y,this._minHeight,this._currentStageDimensions.y));var o=this._dimensions.getImageDimensionsForStage(m,this._currentStageDimensions);return {stageDimensions:this._currentStageDimensions,imageDimensions:o};};k.prototype.getCurrentStageDimensions=function(){"use strict";return this._currentStageDimensions;};e.exports=k;},null);
__d("SpotlightViewerDimensionMixin",["SpotlightViewerStageResizer","PhotoViewerDimensions"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={getInitialState:function(){this._dimensions=new h({verticalPadding:this.props.verticalPadding,horizontalPadding:this.props.horizontalPadding});this._resizer=new g(this._dimensions,{minHeight:this.props.minHeight,minWidth:this.props.minWidth});return {maxStageDimensions:this._dimensions.getMaxStageDimensions()};},componentWillUnmount:function(){this._resizer&&this._resizer.destroy();this._resizer=null;this._dimensions&&this._dimensions.destroy();this._dimensions=null;},getMedia:function(){if(this.state.photoData){var j=this._resizer.getImageAndStageDimensions(this.state.photoData),k=this._dimensions.getBestFitImageFromPhoto(this.state.photoData,this.state.maxStageDimensions);return this._getMedia(k,j);}else return null;},getDimensions:function(){return this._dimensions;},getStageDimensions:function(){if(this.state.photoData){return this._resizer.getImageAndStageDimensions(this.state.photoData).stageDimensions;}else return this._dimensions.getMaxStageDimensions();},getImageDimensions:function(){if(!this.state.photoData)return null;return this._resizer.getImageAndStageDimensions(this.state.photoData).imageDimensions;},onResize:function(){this.setState({maxStageDimensions:this._dimensions.getMaxStageDimensions()});}};e.exports=i;},null);
__d("SpotlightViewerThumbnailMixin",["PhotoStore","Vector"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={_getInitialPhotoData:function(){var j=g.getIndexForID(this.props.setid,this.props.photoid),k=g.getByIndexImmediate(this.props.setid,j);return k?k:this._getThumbnailPhotoData();},_getThumbnailPhotoData:function(){if(!this.props.dimensions||!this.props.thumbsrc)return null;var j={id:this.props.photoid};for(var k=0;k<this.props.dimensions.length;++k){var l=h.deserialize(this.props.dimensions[k]);j['image'+k]={width:l.x,height:l.y,uri:this.props.thumbsrc};}return j;}};e.exports=i;},null);
__d("SpotlightViewport",["Locale","Parent","React","Vector","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=i,n=m.PropTypes,o=i.createClass({displayName:"SpotlightViewport",propTypes:{stageDimensions:n.object.isRequired},PAGE_TO_PREV_PERCENTAGE:.2,sections:{NONE:null,FORWARD:1,BACKWARD:2},getInitialState:function(){return {currentActiveSection:this.sections.NONE,active:true};},_onMouseMove:function(event){var p=j.getEventPosition(event.nativeEvent),q=j.getElementPosition(i.findDOMNode(this)),r,s=p.x-q.x,t=s/this.props.stageDimensions.x;if(g.isRTL()){r=t>(1-this.PAGE_TO_PREV_PERCENTAGE);}else r=t<this.PAGE_TO_PREV_PERCENTAGE;if(r){this.setState({currentActiveSection:this.sections.BACKWARD});}else this.setState({currentActiveSection:this.sections.FORWARD});},_onClick:function(event){var p=this.state.currentActiveSection==this.sections.FORWARD,q=event.target;if(!h.byClass(q,"_51an"))this.props.onClick&&this.props.onClick(p);},_onMouseEnter:function(){this.setState({active:true});},_onMouseLeave:function(){this.setState({active:false});},render:function(){var p=(("_4-of")+(!this.state.active&&!this.props.active?' '+"_50-l":'')+(this.state.currentActiveSection===this.sections.BACKWARD?' '+"_516a":'')+(this.state.currentActiveSection===this.sections.FORWARD?' '+"_516b":'')+(this.props.showLoadingIndicator?' '+"_51jp":''));if(this.props.className)p=l(p,this.props.className);var q={};if(this.props.stageDimensions)q={height:this.props.stageDimensions.y,widht:this.props.stageDimensions.x};return (i.createElement("div",{className:p,style:q,onClick:this._onClick,onMouseMove:this._onMouseMove,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},this.props.children,i.createElement("div",{className:"_4-og"},i.createElement("span",{className:"_4-oh"}),this.props.media,i.createElement("div",{className:"_4-oi"}))));}});e.exports=o;},null);
__d("PluginLoginButton",["Arbiter","DOMEvent","DOMEventListener","DOMQuery","PlatformDialogClient","Plugin","PluginReturn","PluginResize","CSS","PlatformWidgetEndpoint"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q={redirect:function(r){window.parent.location.replace(r);},submit:function(r){r.submit();},registration:function(r,s){i.add(r,'click',q.redirect.bind(null,s));},connect:function(r){i.add(r,'click',q.submit.bind(null,j.find(r,'^form')));},logout:function(r){i.add(r,'click',q.submit.bind(null,j.find(r,'^form')));},oauth:function(r,s,t,u,v,w,x,y){g.subscribe(l.RELOAD,function(event,z){var aa=p.plugins('login_button');m.reload(aa+(z.crossFrame?'':'?ret=perms'));});this.action(r,function(event){new h(event).kill();var z={scope:t,response_type:'none',redirect_uri:u,seen_revocable_perms_nux:v,ref:w,auth_type:x,default_audience:y};k.popup('oauth',s,z);});},nux:function(r,s,t,u){t.style.width=Math.max(r.offsetWidth,200)+'px';function v(){return Math.max(u?u:r.offsetWidth,o.shown(t)?t.offsetWidth:0);}function w(){return Math.max(r.offsetHeight+(o.shown(t)?t.offsetHeight:0),s.offsetHeight);}(new n(v,w,'resize.iframe',true)).resize().auto();},registerNuxClose:function(r,s){i.add(r,'click',o.hide.bind(null,s));},action:function(r,s){i.add(r,'click',s);i.add(r,'keydown',function(t){t=new h(t);var u=t.event.which||t.event.keyCode;if(u===32||u===13)s(t);});}};e.exports=q;},null);
__d("DirectionalDockingElement",["ArbiterMixin","CSS","DOM","DOMDimensions","Event","Run","Scroll","Style","SubscriptionsHandler","ViewportBounds","getElementPosition","mixin","queryThenMutateDOM","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u,v=[],w=true,x=false,y='unfixed',z='fixed_top',aa='fixed_middle',ba=r(g);for(var ca in ba)if(ba.hasOwnProperty(ca))ea[ca]=ba[ca];var da=ba===null?null:ba.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=ba;function ea(fa){"use strict";this.$DirectionalDockingElement0=fa;this.$DirectionalDockingElement1=0;if(!u){var ga=s.bind(null,function(){for(var ha=0,ia=v.length;ha<ia;ha++)v[ha].$DirectionalDockingElement2();},function(){for(var ha=0,ia=v.length;ha<ia;ha++)v[ha].$DirectionalDockingElement3();},'DirectionalDockingElement');u=new o();u.addSubscriptions(k.listen(window,'scroll',ga),k.listen(window,'resize',ga));l.onLeave(function(){while(v.length)v.pop().destroy();u.release();u=null;});}v.push(this);this.$DirectionalDockingElement4=p.getTop();this.$DirectionalDockingElement5=z;n.set(this.$DirectionalDockingElement0,'width',j.getElementDimensions(this.$DirectionalDockingElement0).width+'px');this.$DirectionalDockingElement6=i.create('div');n.set(this.$DirectionalDockingElement6,'position','relative');i.replace(this.$DirectionalDockingElement0,this.$DirectionalDockingElement6);i.appendContent(this.$DirectionalDockingElement6,this.$DirectionalDockingElement0);this.update();}ea.prototype.$DirectionalDockingElement2=function(){"use strict";var fa=-q(this.$DirectionalDockingElement6).y;if(fa!==this.$DirectionalDockingElement7){this.$DirectionalDockingElement8=fa>this.$DirectionalDockingElement7?x:w;this.$DirectionalDockingElement7=fa;}this.$DirectionalDockingElement9=j.getElementDimensions(this.$DirectionalDockingElement0);this.$DirectionalDockingElementa=h.hasClass(document.documentElement,'tinyViewport');this.$DirectionalDockingElementb=m.getTop(document.body)+document.documentElement.clientHeight>document.documentElement.scrollHeight;};ea.prototype.$DirectionalDockingElementc=function(fa,ga){"use strict";if(this.$DirectionalDockingElementd!==fa||this.$DirectionalDockingElemente!==ga){n.apply(this.$DirectionalDockingElement0,{position:fa,top:ga+'px'});this.$DirectionalDockingElementd=fa;this.$DirectionalDockingElemente=ga;}};ea.prototype.$DirectionalDockingElementf=function(){"use strict";this.$DirectionalDockingElement5=z;this.$DirectionalDockingElementc('fixed',this.$DirectionalDockingElement4);};ea.prototype.$DirectionalDockingElementg=function(){"use strict";this.$DirectionalDockingElement5=aa;this.$DirectionalDockingElementc('fixed',this.$DirectionalDockingElement1);};ea.prototype.$DirectionalDockingElementh=function(){"use strict";this.$DirectionalDockingElement5=y;this.$DirectionalDockingElementc('absolute',this.$DirectionalDockingElementi);};ea.prototype.$DirectionalDockingElement3=function(){"use strict";var fa=this.$DirectionalDockingElement9.height;if(fa!==this.$DirectionalDockingElementj){n.set(this.$DirectionalDockingElement6,'height',fa+'px');this.$DirectionalDockingElementj=fa;this.inform('changedheight');}if(this.$DirectionalDockingElement5===z){this.$DirectionalDockingElementi=this.$DirectionalDockingElement7+this.$DirectionalDockingElement4;}else if(this.$DirectionalDockingElement5===aa)this.$DirectionalDockingElementi=this.$DirectionalDockingElement7+this.$DirectionalDockingElement1;if(this.$DirectionalDockingElementb)return;if(this.$DirectionalDockingElement7+this.$DirectionalDockingElement4<=0||this.$DirectionalDockingElementa){this.$DirectionalDockingElementi=0;this.$DirectionalDockingElementh();return;}if(this.$DirectionalDockingElement8===x&&this.$DirectionalDockingElement7+this.$DirectionalDockingElement1>=this.$DirectionalDockingElementi){this.$DirectionalDockingElementg();}else if(this.$DirectionalDockingElement8===w&&this.$DirectionalDockingElement7+this.$DirectionalDockingElement4<=this.$DirectionalDockingElementi){this.$DirectionalDockingElementf();}else this.$DirectionalDockingElementh();};ea.prototype.update=function(){"use strict";this.$DirectionalDockingElement2();this.$DirectionalDockingElement3();};ea.prototype.destroy=function(){"use strict";if(v.indexOf(this)===-1)return;t(v,this);if(this.$DirectionalDockingElement6&&this.$DirectionalDockingElement6.parentNode){i.remove(this.$DirectionalDockingElement6);this.$DirectionalDockingElement6=null;}};ea.prototype.setOffset=function(fa){"use strict";this.$DirectionalDockingElement1=fa;this.update();return this;};e.exports=ea;},null);
__d("DockingElement",["ArbiterMixin","CSS","DOM","DOMDimensions","Event","Run","Style","SubscriptionsHandler","getElementPosition","mixin","queryThenMutateDOM","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s,t=[],u=p(g);for(var v in u)if(u.hasOwnProperty(v))x[v]=u[v];var w=u===null?null:u.prototype;x.prototype=Object.create(w);x.prototype.constructor=x;x.__superConstructor__=u;function x(y){"use strict";this.$DockingElement0=y;this.$DockingElement1=0;if(!t.length){var z=q.bind(null,function(){for(var aa=0,ba=t.length;aa<ba;aa++)t[aa].getRect();},function(){for(var aa=0,ba=t.length;aa<ba;aa++)t[aa].updateWithCache();},'DockingElement');s=new n();s.addSubscriptions(k.listen(window,'scroll',z),k.listen(window,'resize',z));l.onLeave(function(){while(t.length)t.pop().destroy();});}t.push(this);this.update();}x.prototype.getRect=function(){"use strict";var y=this.$DockingElement2?this.getPlaceholder():this.$DockingElement0;this.$DockingElement3=o(y);this.$DockingElement4=j.getElementDimensions(y);this.$DockingElement5=h.hasClass(document.documentElement,'tinyViewport');};x.prototype.updateWithCache=function(){"use strict";var y=this.$DockingElement1,z=this.getPlaceholder();if(!this.$DockingElement5&&this.$DockingElement3.y<=y){if(!this.$DockingElement2){if(!this.$DockingElement6){i.insertAfter(this.$DockingElement0,z);this.$DockingElement6=true;}h.addClass(this.$DockingElement0,'fixed_elem');h.show(z);this.$DockingElement2=true;}var aa;if(this.$DockingElement7!==y){aa={};aa.top=y+'px';this.$DockingElement7=y;}var ba=this.$DockingElement4.width;if(ba!==this.$DockingElement8){aa=aa||{};aa.width=ba+'px';this.$DockingElement8=ba;}aa&&m.apply(this.$DockingElement0,aa);var ca=this.$DockingElement4.height;if(ca!==this.$DockingElement9){m.set(z,'height',ca+'px');this.$DockingElement9=ca;this.inform('changedheight');}}else if(this.$DockingElement2){m.apply(this.$DockingElement0,{top:'',width:''});h.removeClass(this.$DockingElement0,'fixed_elem');h.hide(z);this.$DockingElement2=false;this.$DockingElement8=null;this.$DockingElement7=null;}};x.prototype.update=function(){"use strict";this.getRect();this.updateWithCache();};x.prototype.getPlaceholder=function(){"use strict";if(!this.$DockingElementa)this.$DockingElementa=i.create('div');return this.$DockingElementa;};x.prototype.destroy=function(){"use strict";if(t.indexOf(this)===-1)return;r(t,this);if(this.$DockingElementa&&this.$DockingElementa.parentNode){i.remove(this.$DockingElementa);this.$DockingElementa=null;}if(!t.length){s.release();s=null;}};x.prototype.setOffset=function(y){"use strict";this.$DockingElement1=y;this.update();return this;};e.exports=x;},null);
__d("StickyRHC",["Arbiter","DirectionalDockingElement","DockingElement","DOMQuery","DOMDimensions","Event","Run","SubscriptionsHandler","ViewportBounds","$","csx","ge","getElementPosition","removeFromArray","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){b.__markCompiled&&b.__markCompiled();var v=35,w=[],x;function y(ca,da){if(!da||!da.dom_id){w.forEach(z);return;}var ea=p(da.dom_id);for(var fa=0;fa<w.length;fa++)if(j.contains(w[fa].getRoot(),ea)){z(w[fa]);return;}}function z(ca){var da=ca.getRoot(),ea=ca.updateOffset.bind(ca),fa=j.scry(da,'img.img');fa.forEach(function(ga){if(ga.complete||ga.getAttribute('height')||(typeof ga.naturalHeight!=='undefined'&&ga.naturalHeight!==0))return;var ha=function(){ea();ia.remove();ja.remove();ka.remove();},ia=l.listen(ga,'load',ha),ja=l.listen(ga,'error',ha),ka=l.listen(ga,'abort',ha);});ea();}function aa(){w.forEach(function(ca){ca.updateOffset();});}function ba(ca,da){"use strict";this.$StickyRHC0=ca;this.$StickyRHC1=da?new h(ca):new i(ca);this.$StickyRHC2=0;this.$StickyRHC1.subscribe('changedheight',this.updateOffset.bind(this));this.updateOffset();z(this);if(!w.length){x=new n();x.addSubscriptions(g.subscribe('header_loaded',aa),g.subscribe('netego_loaded',y),l.listen(window,'resize',u(aa)));}m.onLeave(this.destroy.bind(this));w.push(this);}ba.getInstances=function(){"use strict";return w;};ba.prototype.getRoot=function(){"use strict";return this.$StickyRHC0;};ba.prototype.destroy=function(){"use strict";this.$StickyRHC1.destroy();t(w,this);if(!w.length){x.release();x=null;}};ba.prototype.updateOffset=function(){"use strict";var ca=j.scry(this.$StickyRHC0,"._4-u2"),da=j.scry(this.$StickyRHC0,"._4-u3"),ea=j.scry(this.$StickyRHC0,"._5eh2"),fa=j.scry(this.$StickyRHC0,'.uiHeader'),ga=j.scry(this.$StickyRHC0,'.ego_unit'),ha=[].concat(ca,da,ea,fa,ga),ia=[];ha.forEach(function(sa){ia.push(s(sa).y);});ia.sort(function(sa,ta){return sa-ta;});var ja=s(this.$StickyRHC0).y,ka=k.getElementDimensions(this.$StickyRHC0).height;ka+=this.$StickyRHC2;var la=o.getTop(),ma=k.getViewportDimensions().height-la;ma-=v;if(typeof this.$StickyRHC3==='undefined'){var na=r('pageFooter');this.$StickyRHC3=na?k.getElementDimensions(na).height:0;}ma-=this.$StickyRHC3;var oa=ma-ka;if(ka<ma){oa=la;}else for(var pa=0,qa=ia.length;pa<qa;pa++){var ra=ia[pa]-ja;if(ka-ra<ma){oa=la-ra;break;}}this.$StickyRHC1.setOffset(oa+this.$StickyRHC2);};ba.prototype.setOffset=function(ca){"use strict";this.$StickyRHC2=ca;this.updateOffset();};ba.prototype.getOffset=function(ca){"use strict";return this.$StickyRHC2;};e.exports=ba;},null);
__d("legacy:adware-scanner",["AdwareScaner"],function(a,b,c,d){b.__markCompiled&&b.__markCompiled();a.AdwareScaner=b('AdwareScaner');},3);
__d("ProgressBarBase",["emptyFunction","requestAnimationFrame","removeFromArray","arrayContains"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=[];function l(m,n){"use strict";this._min=m||0;this._max=n||100;this._initialPosition=0;this._position=0;this._initialVelocity=0;this._velocity=0;this._acceleration=0;this.useAcceleration=true;this._targetPosition=0;this._targetTime=0;this._startTime=null;this._onComplete=g;}l.prototype.setPosition=function(m){"use strict";m=this._normalizePosition(m);this._initialPosition=m;this._position=m;this.updateMeter(this._position);this.stop();return this;};l.prototype.setCompleteHandler=function(m){"use strict";this._onComplete=m||g;return this;};l.prototype.setTarget=function(m,n){"use strict";this._stopAnimating();this._clearOnCompleteTimeout();this._targetPosition=m;var o=this._normalizePosition(m);this._targetTime=n;this._initialVelocity=this._velocity;this._initialPosition=this._position;if(this.useAcceleration){this._acceleration=2*(o-this._initialPosition-this._initialVelocity*n)/(n*n);}else{this._acceleration=0;this._velocity=this._initialVelocity=(o-this._initialPosition)/n;}if(this._position>=o){this._onComplete();}else this._start();return this;};l.prototype.setNoAcceleration=function(m){"use strict";this.useAcceleration=!m;return this;};l.prototype._clearOnCompleteTimeout=function(){"use strict";a.clearTimeout(this._onCompleteTimeout);};l.prototype.stop=function(){"use strict";this._clearOnCompleteTimeout();this._velocity=0;this._initialVelocity=0;this._acceleration=0;this._stopAnimating();return this;};l.prototype._start=function(){"use strict";this._startTime=Date.now();this._onCompleteTimeout=a.setTimeout(function(){this.setPosition(this._targetPosition);this._onComplete();}.bind(this),this._targetTime);this._startAnimating();return this;};l.prototype._loop=function(){"use strict";var m=Date.now()-this._startTime;this._position=(.5*this._acceleration*m*m)+(this._initialVelocity*m)+this._initialPosition;var n=this._velocity;this._velocity=this._acceleration*m+this._initialVelocity;var o=n<0!==this._velocity<0;if(this._position>this._normalizePosition(this._targetPosition)||o){this.setPosition(this._targetPosition);this._onComplete();}else this.updateMeter(this._position);};l.prototype.updateMeter=function(m){"use strict";throw "Unimplemented function: updateMeter";};l.prototype._normalizePosition=function(m){"use strict";return Math.min(Math.max((m-this._min)/(this._max-this._min),0),1);};l.prototype._startAnimating=function(){"use strict";if(!j(k,this)){k.push(this);if(k.length===1)h(l.prototype._requestAnimationFrameCallback);}};l.prototype._stopAnimating=function(){"use strict";i(k,this);};l.prototype._requestAnimationFrameCallback=function(){"use strict";k.forEach(function(m){m._loop();});if(k.length)h(l.prototype._requestAnimationFrameCallback);};l.setPosition=function(m,n){"use strict";m.setPosition(n);};l.setTarget=function(m,n,o){"use strict";m.setTarget(n,o);};e.exports=l;},null);
__d("ProgressBar",["ProgressBarBase","CSS","Style","cx","csx","DOM"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();for(var m in g)if(g.hasOwnProperty(m))o[m]=g[m];var n=g===null?null:g.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=g;function o(p,q,r){"use strict";g.call(this,q,r);this._root=p;this._meter=l.find(p,"div._5e4k");this._meter2=l.scry(p,"div._5e2g")[0];}o.prototype.getRoot=function(){"use strict";return this._root;};o.prototype.updateMeter=function(p){"use strict";var q=Math.min(Math.max(p,0),1);h.conditionClass(this._meter,"_5e2d",q<=0);h.conditionClass(this._meter,"_5e4j",q>=1);q=q*100+'%';i.set(this._meter,'width',q);if(this._meter2){i.set(this._meter2,'left',q);i.set(this._meter2,'width',q);}};o.prototype.changeLabel=function(p){"use strict";var q=l.scry(this._root,"span._5e2h");q.forEach(function(r){l.setContent(r,p);});return this;};e.exports=o;},null);
__d("FormSubmitOnChange",["Event","copyProperties","submitForm"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k){"use strict";this._form=k;}j.prototype.enable=function(){"use strict";this._listener=g.listen(this._form.getRoot(),'change',this._submit.bind(this));};j.prototype.disable=function(){"use strict";this._listener.remove();this._listener=null;};j.prototype._submit=function(){"use strict";i(this._form.getRoot());};h(j.prototype,{_listener:null});e.exports=j;},null);
__d("StickyArea",["CSS","DOM","DOMQuery","Event","Run","Style","ViewportBounds","cx","getNormalizedClientRect","getOverlayZIndex","removeFromArray","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=[],t=null,u=null,v=null,w=r.acrossTransitions(x,1000);function x(){s.sort(function(da,ea){var fa=da.getNode(),ga=ea.getNode();if(fa.compareDocumentPosition){return 3-(fa.compareDocumentPosition(ga)&6);}else return fa.sourceIndex-ga.sourceIndex;});}function y(da,ea,fa){var ga=da.getPlaceholder(),ha=da.getNode(),ia=l.get(ha,'float'),ja=da.getData();if(ja.placeholderWidth!==ea||ja.placeholderHeight!==fa||ja.placeholderFloat!==ia){l.apply(ga,{'float':ia,height:fa+'px',width:ea+'px'});ja.placeholderHeight=fa;ja.placeholderWidth=ea;}if(ha.nextSibling!==ga)h.insertAfter(ha,ga);}function z(da,ea){var fa=da.getData();if(fa.fixed!==ea){l.apply(da.getNode(),fa.styles);g.conditionShow(da.getPlaceholder(),ea);fa.fixed=ea;}}function aa(da,ea){if(!da){return 0;}else if(ea.right<=da.rect.left||ea.left>=da.rect.right){return aa(da.prev,ea);}else return da.bottom;}function ba(){var da=0,ea=s.length,fa=100;function ga(ha,ia){var ja=fa;while(da<ea){var ka=s[da],la=ka.getNode();if(ia&&!i.contains(ia,la))break;fa=Math.max(ja,ka.getZIndex());var ma=ka.getData(),na=la.parentNode,oa=ma.styles;for(var pa in oa)oa[pa]='';z(ka,false);var qa=la.offsetHeight,ra=la.offsetWidth,sa=o(la),ta=aa(ha,sa)+ka.getOffset();if(sa.top<=ta){oa.width=ra+'px';var ua=parseInt(l.get(na,'padding-bottom'),10),va=o(na);if(va.bottom-ua>ta+qa){var wa=parseInt(l.get(la,'margin-left'),10);oa.position='fixed';oa.bottom='auto';oa.top=ta+'px';oa.left=sa.left-wa+'px';}else{if(!ma.parent||na!==ma.parent){if(l.get(na,'position')==='static')l.set(na,'position','relative');ma.parent=na;}oa.position='absolute';oa.top='auto';oa.bottom=ua+'px';var xa=parseInt(l.get(na,'border-left-width'),10);oa.left=(sa.left-va.left-xa)+'px';}y(ka,ra,qa);z(ka,true);}da++;ga({bottom:ta+qa,prev:ha,rect:sa},na);l.set(la,'z-index',fa++);}}ga(null,null);}function ca(da,ea,fa){"use strict";this._node=da;this._data={fixed:false,placeholderFloat:null,placeholderHeight:null,placeholderWidth:null,styles:{}};this._offset=fa;g.addClass(da,"_k");if(!ea)k.onLeave(this.destroy.bind(this));if(!s.length){t=j.listen(window,'scroll',function(){w();ba();});u=j.listen(window,'resize',function(){w();ba();});v=m.subscribe('change',function(){w();ba();});}s.push(this);ca.reflow();}ca.prototype.destroy=function(){"use strict";q(s,this);if(!s.length){t.remove();t=null;u.remove();u=null;}if(this._placeholder)h.remove(this._placeholder);var da=0;for(var ea in this._data.styles){this._data.styles[ea]='';da++;}if(da)l.apply(this._node,this._data.styles);};ca.prototype.getData=function(){"use strict";return this._data;};ca.prototype.getNode=function(){"use strict";return this._node;};ca.prototype.getOffset=function(){"use strict";return this._offset||0;};ca.prototype.getPlaceholder=function(){"use strict";if(!this._placeholder)this._placeholder=h.create('div');return this._placeholder;};ca.prototype.getZIndex=function(){"use strict";if(!this._zIndex)this._zIndex=p(this._node);return this._zIndex;};ca.prototype.setOffset=function(da){"use strict";this._offset=da;};ca.reflow=r.acrossTransitions(function(){x();ba();},100);e.exports=ca;},null);
__d("ClearableTypeahead",["Event"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={resetOnCloseButtonClick:function(i,j){g.listen(j,'click',function(){var k=i.getCore();k.getElement().focus();k.reset();});}};e.exports=h;},null);
__d("TypeaheadRegulateMemorializedUsers",["TokenizeUtil","copyProperties"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(j){"use strict";this._typeahead=j;}i.prototype._filter=function(j,k){"use strict";if(j.type!=='user'||!j.memorialized)return true;var l=g.parse(j.text).tokens;if(l.length===1&&g.isExactMatch(k,j.text))return true;var m=this._typeahead.getData().getTextToIndex(j),n=g.parse(k).tokens;return (n.length>1&&g.isQueryMatch(k,m));};i.prototype.enable=function(){"use strict";this._filterRegistry=this._typeahead.getData().addFilter(this._filter.bind(this));};i.prototype.disable=function(){"use strict";this._filterRegistry.remove();this._filterRegistry=null;};h(i.prototype,{_filterRegistry:null});e.exports=i;},null);
__d("legacy:RegulateMemorializedUsersTypeaheadBehavior",["TypeaheadRegulateMemorializedUsers"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.regulateMemorializedUsers=function(h){h.enableBehavior(g);};},3);
__d("TypeaheadShowLoadingIndicator",["CSS","copyProperties"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(j){"use strict";this._typeahead=j;}i.prototype.enable=function(){"use strict";this._subscription=this._typeahead.subscribe('loading',function(j,k){g.conditionClass(this._typeahead.getElement(),'typeaheadLoading',k.loading);g.conditionClass(this._typeahead.getView().getElement(),'typeaheadViewLoading',k.loading);}.bind(this));};i.prototype.disable=function(){"use strict";this._typeahead.unsubscribe(this._subscription);this._subscription=null;};h(i.prototype,{_subscription:null});e.exports=i;},null);
__d("legacy:ShowLoadingIndicatorTypeaheadBehavior",["TypeaheadShowLoadingIndicator"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.showLoadingIndicator=function(h){h.enableBehavior(g);};},3);
__d("SearchTypeaheadRenderer",["BadgeHelper","DOM","fbt","MusicButtonManager","TokenizeUtil","TypeaheadFacepile","URI","WWWBase"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();var o=' \u00B7 ';function p(q,r){var s=[],t=q.photos||q.photo;if(t){if(t instanceof Array){t=l.render(t);}else t=h.create('img',{alt:'',src:t});s.push(t);if(q.song){s.push(h.create('span',{className:'playButton'}));s.push(h.create('span',{className:'playLoader'}));}}var u;if(q.text){var v=q.alias,w=this.value,x=q.text;u=[x];if(v&&k.isQueryMatch(w,v)&&!k.isQueryMatch(w,x))u.push(h.create('span',{className:'alias'},[' \xB7 '+v]));if(q.is_verified){u.push(g.renderBadge('xsmall','verified'));}else if(q.is_work_user)u.push(g.renderBadge('xsmall','work'));s.push(h.create('span',{className:'text'},u));}if(q.category){var y=[q.category];if(q.is_external)y.push(h.create('span',{className:'arrow'}));var z=q.message?'preCategory':'category';s.push(h.create('span',{className:z},y));}if(q.message)s.push(h.create('span',{className:'category'},[q.message]));var aa=q.subtextOverride||q.subtext;if(aa){var ba=[aa];if(q.saved_context){var ca=h.create('span',{className:'saved'},[q.saved_context]);ba.unshift(ca,o);}s.push(h.create('span',{className:'subtext'},ba));}var da=q.classNames||q.type||'',ea=q.is_external?'_blank':'',fa=!q.song&&q.path||'';if(fa){if(!(/^https?\:\/\//).test(fa))fa=n.uri+fa.substr(1);fa+=(fa.indexOf('?')>0?'&':'?')+'ref=ts&fref=ts';}var ga=h.create('a',{href:fa,rel:'ignore',target:ea},s);if(q.song){ga.id='mb_'+(Math.random()*1e+06|0);setTimeout(j.addButton.bind(null,q.song.provider,ga.id,q.song.url,q.song.context,q.song.media_type),0);ga.onclick=this.ignoreClick;}var ha=null;if(q.uid==='recent'&&q.type==='header'){var ia=new m('/profile.php');ia.setQueryData({sk:'allactivity',log_filter:'search'});ha=h.create('a',{href:ia,className:'recentSearchEditLink'},i._("EDIT"));ga.setAttribute('class','recentSearchHeaderLink');da=da+' recentHeader';}var ja=h.create('li',{className:da},[ga,ha]);if(q.text){ja.setAttribute('title',q.text);ja.setAttribute('aria-label',q.text);}return ja;}p.className='search';e.exports=p;},null);